<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>Managing Server Certificates</h1>
    <p>To enable TLS/SSL-encryption, you must set the TLS/SSL server certificate file that the Solace PubSub+ event broker is to use. This server certificate is presented to clients during TLS/SSL handshakes. The server certificate must be an x509v3 certificate and include a private key. The server certificate and key use an RSA algorithm for private key generation, encryption and decryption, and they both must be encoded with a Privacy Enhanced Mail (PEM) format.</p>
    <p>The single server certificate file set for the event broker can have a maximum chain depth of three (that is, the single certificate file can contain up to three certificates in a chain that can be used for the certificate verification).</p>
    <p>The TLS/SSL certificate file to be used must be located in the <code>/usr/sw/jail/certs</code> directory on the event broker file system when the certificate is to be configured. </p>
    <p>To use a TLS/SSL server certificate, you must perform the following steps:</p>
    <ul>
      <li>Load one or more server certificate files to the event broker. See <MadCap:xref href="#Loading-Server-Certs">Loading Server Certificate Files</MadCap:xref>.</li>
      <li>Set the server certificate file to be used for SSL communications. See <MadCap:xref href="#Setting">Setting Server Certificates To Use</MadCap:xref>.</li>
      <li>Configure the CA certificates that the event broker uses for outgoing TLS connections and to verify connecting clients. See <MadCap:xref href="TLS-SSL-Message-Encryption-Overview.htm#Certific">Certificate Authorities</MadCap:xref>.</li>
    </ul>
    <h2 class="with-rule"><a name="Loading-Server-Certs"/>Loading Server Certificate Files</h2>
    <p>To load a server certificate on an event broker, enter the following command:</p>
    <p class="Code">solace# copy sftp://[&lt;username&gt;@]&lt;ip-addr&gt;/&lt;remote-pathname&gt; /certs/&lt;certificate-file&gt;</p>
    <p><u>Where</u>:</p>
    <p><code>&lt;username&gt;</code> is the SFTP username if a username is required to access the remote certificate file.</p>
    <p><code>&lt;ip-addr&gt;</code> is the address of the SFTP server where the remote certificate file is stored.</p>
    <p><code>&lt;remote-pathname&gt;</code> is the path to the certificate file from the server root directory.</p>
    <p><code>&lt;certificate-file&gt;</code> is the filename to use for the certificate on the event broker.</p>
    <p>For more information on how to add files to the event broker file system, see <MadCap:xref href="../Admin/Managing-Event-Broker-Files.htm">Managing Solace Router Files</MadCap:xref>.</p>
    <h2 class="with-rule"><a name="Setting"/>Setting Server Certificates To Use</h2>
    <p>To set a server certificate for the event broker to use, enter the following commands:</p>
    <p class="Code">solace(configure)# ssl<br/>solace(configure/ssl)# server-certificate &lt;filename&gt;</p>
    <p><u>Where</u>:</p>
    <p><code>&lt;filename&gt;</code> is the filename of the certificate. This file must be located in the <code>/usr/sw/jail/certs</code> directory on the event broker. Once a certificate is configured, a copy of it is saved internally. The file in the <code>certs</code> directory is no longer required.</p>
    <p>The no version of this command, <code>no server-certificate</code>, clears the server‑certificate that is set for the event broker.</p>
    <div class="Note">
      <ul>
        <li>To maintain private key security and to prevent unauthorized users from copying private keys from the event broker, Solace strongly recommends that only password‑protected private keys are used for the server certificate.</li>
        <li>The certificate file that is used can be changed after clients have established TLS/SSL connections to the event broker. Any clients that already have established secure connections using the previous certificate are not affected. However, once they disconnect, they cannot reestablish a connection with the previous certificate.</li>
        <li>If you want to replace the server certificate that was previously set with a new one, use the same command to set the new server certificate. Only one server certificate can be set for the event broker.</li>
        <li>For PEM encoded certificates, the maximum  size is 32 kilobytes.  This limit applies to the total certificate  including all components (certificate, certificate chain, private key, subject alternative names, etc).</li>
        <li>For DER encoded certificates (a binary encoded version of the PEM format), the maximum  size is 24 kilobytes.</li>
      </ul>
    </div>
    <MadCap:snippetBlock src="../Resources/Snippets/Not-Config-Synced.flsnp"/>
  </body>
</html>
