<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>TLS/SSL Service Connections</h1>
    <p>This section provides the general steps that are required to enable TLS/SSL-encrypted communication links for the following use cases:</p>
    <ul>
      <li>
        <u>Publishing and Receiving Messages</u>
      </li>
      <p>By default, when a client messaging application connects to an event broker, that connection is unsecured. However, a client application can optionally establish a TLS/SSL-encrypted connection to an event broker. For information on the basic steps required to establish a secure connection for clients to publish and/or receive messages, see <MadCap:xref class="Heading_And_Page" href="#managing_tls_ssl_service_1762742558_317045">Configuring TLS/SSL Encryption for Publishing and Receiving Messages</MadCap:xref>.</p>
      <li>
        <u>Message VPN Bridges</u>
      </li>
      <p>Messages may travel between Message VPNs by way of Message VPN bridges. See <MadCap:xref class="Heading_And_Page" href="#managing_tls_ssl_service_1762742558_348505">Configuring TLS/SSL Encryption for Message VPN Bridges</MadCap:xref>. For more information on Message VPN bridges, see <MadCap:xref href="../Features/VPN/Managing-Message-VPN-Bridges.htm">Managing Message VPN Bridges</MadCap:xref>.</p>
      <li>
        <u>Replication Config-Sync Bridges</u>
      </li>
      <p>Event brokers in a replication configuration can use Config-Sync to ensure that the configurations of replicated Message VPNs are synchronized. When enabled, the replication feature creates a special bridge to transfer Config-Sync commands. See <MadCap:xref class="Heading_And_Page" href="#managing_tls_ssl_service_1762742558_359372">Configuring TLS/SSL Encryption for Replication Config-Sync Bridges</MadCap:xref>. For more information on replication and Config-Sync, see <MadCap:xref href="../Features/DR-Replication/Configuring-Data-Center-Replication.htm">Configuring Replication</MadCap:xref>.</p>
      <li>
        <u>Message VPN Replication Bridges</u>
      </li>
      <p>Message VPNs that use replication synchronize all messages received on one Message VPN to a separate standby Message VPN. Messages that are synchronized travel over a Message VPN replication bridge. See <MadCap:xref class="Heading_And_Page" href="#managing_tls_ssl_service_1762742558_333631">Configuring TLS/SSL Encryption for Message VPN Replication Bridges</MadCap:xref>.<p>For more information on Message VPN replication, see <MadCap:xref href="../Features/DR-Replication/Configuring-Data-Center-Replication.htm">Configuring Replication</MadCap:xref>.</p></p>
      <li>
        <u>SEMP Requests</u>
      </li>
      <p>Solace Element Management Protocol (SEMP) is protocol that you can use to manage and monitor event brokers.  For information on the basic steps required to establish secure connection for either the current RESTful SEMP API or the <a href="../Admin/SEMP/Using-Legacy-SEMP.htm" class="link-internal">Legacy SEMP</a> API, see <MadCap:xref class="Heading_And_Page" href="#managing_tls_ssl_service_1762742558_317096">Configuring TLS/SSL Encryption for SEMP Service</MadCap:xref>.</p>
      <li>
        <u>Multi-Node Routing Links</u>
      </li>
      <p>Multi-Node Routing (MNR) allows multiple event brokers to be networked together so that Direct messages published from clients connected to one event broker can be delivered to clients connected to the other event brokers. TLS/SSL encryption can be applied to the MNR linksʼ data channels for appliances running Solace PubSub+ version 8.2 or higher.<p>For information on the basic steps required to use TLS/SSL encryption on the data connections between neighboring appliances, see <MadCap:xref href="../Features/MNR/Managing-Multi-Node-Routing-Links.htm#Config-Encrypt">Configuring Neighbor Link Encryption</MadCap:xref>.</p></p>
      <li>
        <u>HA Config-Sync</u>
      </li>
      <p>TLS/SSL encryption can be applied to secure the config-sync communication between event brokers in an HA group. Refer to <MadCap:xref href="../Features/HA-Redundancy/Configuring-HA-Groups.htm#Step">Step 4: Enable Config-Sync</MadCap:xref> for instructions on configuring in a software event broker HA group, and <MadCap:xref href="../Features/HA-Redundancy/Enable-G-Msg-HA-Appliance.htm">Enabling Guaranteed Messaging for HA Appliances</MadCap:xref> for instructions applicable to appliances.</p>
      <li>
        <u>HA Mate-Link</u>
      </li>
      <p>TLS/SSL encryption can be applied to secure the mate link between software event brokers in an HA group. Refer to <MadCap:xref href="../Features/HA-Redundancy/Configuring-HA-Groups.htm#Configur3">Step 3: Enable Guaranteed Messaging</MadCap:xref> on the <MadCap:xref href="../Features/HA-Redundancy/Configuring-HA-Groups.htm">HA Group Configuration</MadCap:xref> page for configuration instructions.        </p>
    </ul>
    <h2 class="with-rule"><a name="managing_tls_ssl_service_1762742558_317045"/>TLS/SSL Encryption Configuration for Publishing / Receiving Messages</h2>
    <p>The following configuration steps are required to use TLS/SSL-encrypted communications between an  event broker and a client application  for publishing and receiving messages:</p>
    <ol>
      <li>Set and configure the server certificate for the  event broker.<p>See <MadCap:xref href="Managing-Server-Certs.htm">Managing Server Certificates</MadCap:xref>.</p></li>
      <li>Optionally, configure the cipher suite list for message backbone connections to the  event broker.<p>See <MadCap:xref href="Configuring-Cipher-Suites-for-Inbound-Connections.htm">Configuring Cipher Suites for Inbound Connections</MadCap:xref>.</p></li>
      <li>Configure a TLS/SSL service listen port as one of the service ports to be used by the event broker.
        <p>Depending on the service you are using, refer to one of the following:</p><p>AMQP—<MadCap:xref href="../Services/AMQP-on-VPN-Management.htm#set-vpn-listen-ports">Set Message VPN AMQP Listen Ports</MadCap:xref>.</p><p>MQTT—<MadCap:xref href="../Services/Managing-MQTT-Messaging.htm#managing_mqtt_messaging_1203392003_440579">Setting Listen Ports</MadCap:xref>.</p><p>REST—<MadCap:xref href="../Services/Managing-REST-Service.htm#Set-Listen">Setting Listen Ports</MadCap:xref>.</p><p>SMF—<MadCap:xref href="../Services/Managing-Services.htm#SMF-Port">Setting SMF Listen Ports</MadCap:xref>.</p><p>Web Transport—<MadCap:xref href="../Services/Managing-Services.htm#Web-Transport-Port">Setting Web Transport Listen Ports</MadCap:xref>.</p></li>
      <li>Ensure that TLS/SSL over SMF service is enabled on the Message VPN to be used by clients.<p>See <MadCap:xref href="../Features/VPN/Configuring-VPNs.htm#Config-Services">Configuring Services</MadCap:xref>.</p></li>
      <li>
        <p>Start the service.</p>
        <p>See <MadCap:xref href="../Services/Managing-Services.htm">Services</MadCap:xref>.</p>
      </li>
    </ol>
    <p>If you are configuring TLS/SSL for the Solace Message Format (SMF) service, perform the following additional steps:</p>
    <ol>
      <li>
        <p>If you want to only use encryption to protect the clientsʼ credentials, but for performance reasons you do not want to encrypt the data transmitted after clients are authenticated and authorized, you must enable SSL connection downgrades on the Message VPN to be used by clients.</p>
        <p>See <MadCap:xref href="Enabling-TLS-Downgrade.htm">Enabling TLS/SSL Connection Downgrades on VPNs</MadCap:xref>.</p>
      </li>
      <li>
        <p>Configure the TLS/SSL-related Session properties required for the client connections to the  event broker.
			</p>
        <p>See <MadCap:xref MadCap:unresolvedLink="import-link:creating_client_sessions_1483641185_58151" href="../API/API-Developer-Guide/Creating-Client-Sessions.htm">Creating Client Sessions</MadCap:xref> for Solace messaging APIs or <MadCap:xref MadCap:unresolvedLink="import-link:establishing_connections_2505829065_65295" href="../API/Solace-JMS-API/Establishing-Connections.htm">Establishing Connections</MadCap:xref> for the Solace JMS messaging API.</p>
      </li>
    </ol>
    <h2 class="with-rule"><a name="managing_tls_ssl_service_1762742558_348505"/>TLS/SSL Encryption Configuration for VPN Bridges</h2>
    <p>TLS/SSL can be configured on a Message VPN bridge after the bridge has been created. Establishing TLS/SSL encryption on a Message VPN bridge requires different steps depending on whether the bridge is unidirectional or bidirectional, and whether the bridge uses basic or client certificate authentication.</p>
    <p>If you are configuring TLS/SSL encryption on an existing bridge, you must create a new remote Message VPN when following the appropriate steps below. </p>
    <p>If you want a bridge connection to an existing remote Message VPN to use SSL encryption, you must delete and recreate the bridge, setting the <code>connect-via</code> parameter for the remote Message VPN to use the TLS/SSL port of the remote event broker.</p>
    <p>For an example of the CLI commands required to create Message VPN bridges, see <MadCap:xref href="../Features/VPN/Message-VPN-Bridge-Setup-Examples.htm">Message VPN Bridge Setup Examples</MadCap:xref>.</p>
    <p class="Note">TLS/SSL to plain-text, or plain-text compressed, downgrades are not supported.</p>
    <h3>Uni-Directional VPN Bridge Configuration</h3>
    <p>After the bridge has been established, follow these steps to enable encryption on the bridge.</p>
    <ol>
      <li>Shut down the Message VPN bridge.      <p class="Code">solace1(configure/bridge)# shutdown</p></li>
      <li>Upload and configure the SSL server certificate on the remote event broker. The trusted CA certificate set on the local event broker must match the certificate set on the remote event broker.   
        <p>See <MadCap:xref href="Managing-Server-Certs.htm">Managing Server Certificates</MadCap:xref>.</p></li>
      <li>Optionally, configure the server certificate validation settings. These settings will be used to validate the server certificate on the remote event broker during the SSL handshake.   
        <p>See <MadCap:xref href="Configuring-Server-Cert-Validation.htm">Configuring Server Certificate Validation Settings</MadCap:xref>.</p></li>
      <li>Configure the TLS/SSL settings (trusted common name list and cipher suite list) to be used for the Message VPN bridge. See <MadCap:xref href="../Features/VPN/Configuring-VPN-Bridges.htm#Encrypt">Enabling TLS/SSL Encryption for Bridge Connections</MadCap:xref>.    <p>The trusted common name should match the common name in the server certificate configured in Step 2.</p></li>
      <li>Select the authentication scheme for the bridge.      <p>See <MadCap:xref href="../Features/VPN/Configuring-VPN-Bridges.htm#Config-Remote-Auth">Configuring Remote Authentication</MadCap:xref>.</p></li>
      <li>Configure a new remote Message VPN with the <code>connect-via</code> parameter set to use the SSL port of the remote event broker. The remote Message VPN authentication parameters must be configured to allow SSL connections. See <MadCap:xref href="../Features/VPN/Configuring-VPN-Bridges.htm#Config-Remote-VPNs">Configuring Remote Message VPNs</MadCap:xref>.</li>
      <li>Configure the remote Message VPN to use SSL.</li>
      <p class="Code">solace1(configure/bridge/remote/message-vpn)# ssl</p>
      <li>Start the remote Message VPN.        <p class="Code">solace1(configure/bridge/remote/message-vpn)# no shutdown</p></li>
      <li>Start the Message VPN bridge.
			<p class="Code">solace1(configure/bridge)# no shutdown</p><p>A unidirectional Message VPN bridge with TLS/SSL encryption and compression has been established on the new remote Message VPN.</p></li>
    </ol>
    <h3>Bi-Directional VPN Bridge Configuration</h3>
    <p>To establish a bi-directional Message VPN bridge that uses encryption, repeat the steps above to configure another bridge of the same name using the same Message VPNs but in reverse order.</p>
    <p>That is, the second bridge must be created in the Message VPN that was previously specified as the remote Message VPN, and the remote Message VPN of the second bridge must be the Message VPN that was previously specified as the local Message VPN.</p>
    <p>If the bi-directional bridge is not a loopback bridge (that is, if it is connecting two different  event brokers), and the second bridge was configured using the <code>connect-via</code> parameter, an SSL server certificate must be configured on the local event broker of the second bridge, which was the remote event broker of the first bridge.</p>
    <h2 class="with-rule"><a name="managing_tls_ssl_service_1762742558_359372"/>TLS/SSL Encryption Configuration for Replication Config-Sync Bridges</h2>
    <p>The following configuration steps can be used to enable TLS/SSL-encrypted communications on  event brokers over replication Config-Sync bridges.</p>
    <p>When replication and Config-Sync are enabled on paired event brokers, configuration changes are synchronized from one event broker to the other using a replication Config-Sync bridge.</p>
    <p>Because the <code>ssl</code> parameter used on the replication Config-Sync bridge is not synchronized with Config-Sync, it is necessary to enable TLS/SSL on the replication Config-Sync bridge on both event brokers before encrypted configuration synchronization will work properly.</p>
    <p>For more information on replication and Config-Sync, see <MadCap:xref href="../Features/DR-Replication/Configuring-Data-Center-Replication.htm">Configuring Replication</MadCap:xref> and <MadCap:xref href="../Features/Config-Sync/Configuring-Config-Sync.htm">Using Config-Sync</MadCap:xref>.</p>
    <ol>
      <li>Shut down the replication Config-Sync bridge.
            <p class="Code">solace1(configure)# replication config-sync bridge<br/>solace1(configure/replication/config-sync/bridge)# shutdown</p></li>
      <li>Upload and configure the SSL server certificate on the remote event broker and the matching trusted CA certificate on the local event broker.
            <p>See <MadCap:xref href="Managing-Server-Certs.htm">Managing Server Certificates</MadCap:xref>.</p></li>
      <li>Optionally, configure the server certificate validation settings for replication Config-Sync bridges.
            <p>See <MadCap:xref href="Configuring-Server-Cert-Validation.htm">Configuring Server Certificate Validation Settings</MadCap:xref>.</p></li>
      <li>Choose and configure an authentication scheme for the bridge.
            <p>See <MadCap:xref href="../Features/DR-Replication/Replication-Sys-Level-Settings.htm#Auth-Schemes">Setting Authentication Schemes</MadCap:xref>.</p></li>
      <li>Configure the replication Config-Sync bridge to use TLS/SSL.</li>
      <p class="Code">solace1(configure)# replication config-sync bridge<br/>solace1(configure/replication/config-sync/bridge)# ssl</p>
      <li>Enable the replication Config-Sync bridge.
            <p class="Code">solace1(configure)# replication config-sync bridge<br/>solace1(configure/replication/config-sync/bridge)# no shutdown</p></li>
      <li>Repeat steps 1 through 6 on the mate event broker to create a bi-directional replication Config-Sync bridge.</li>
    </ol>
    <p>SSL-encrypted communications are now enabled for the replication Config-Sync bridge that connects the  event brokers.</p>
    <h2 class="with-rule"><a name="managing_tls_ssl_service_1762742558_333631"/>TLS/SSL Encryption Configuration for Replication Bridges</h2>
    <p>The following configuration steps can be used to enable TLS/SSL-encrypted communications on  event brokers through Message VPN replication bridges.</p>
    <p> Event brokers using replication and Config-Sync use different bridges for Message VPN replication and configuration replication.</p>
    <p>This procedure requires that replication be set up between event brokers. See <MadCap:xref href="../Features/DR-Replication/Configuring-Data-Center-Replication.htm">Configuring Replication</MadCap:xref> for more information on setting up replication.</p>
    <p>Before beginning this procedure, the replication must be shutdown.</p>
    <ol>
      <li>Choose a client username that will be used for bridge authentication. This must be a valid client username on the replicated Message VPN.</li>
      <li>For the chosen client username, configure the client profile to allow bridge connections. This parameter will be automatically set on the mate event broker through Config-Sync.
            <p>See <MadCap:xref href="Configuring-Client-Profiles.htm#allow-bridge-connections">Allowing Bridge Connections</MadCap:xref>.</p></li>
      <li>Upload and configure the TLS/SSL server certificate. The trusted CA certificate that is set on an event broker must match the certificate set on its mate event broker.
            <p>See <MadCap:xref href="Managing-Server-Certs.htm">Managing Server Certificates</MadCap:xref>.</p></li>
      <li>Optionally, configure the server certificate validation settings for Message VPN replication bridges.
            <p>See <MadCap:xref href="Configuring-Server-Cert-Validation.htm">Configuring Server Certificate Validation Settings</MadCap:xref>.</p></li>
      <li>Optionally, configure TLS/SSL settings (trusted common name list and cipher suite list) for Message VPN replication bridges.
            <p>See <MadCap:xref href="../Features/DR-Replication/Replication-Sys-Level-Settings.htm#Config-SSL">Configuring TLS/SSL for Replication</MadCap:xref>.</p></li>
      <li>Choose an authentication scheme for the bridge.
            <p>See <MadCap:xref href="../Features/DR-Replication/Replication-Sys-Level-Settings.htm#Auth-Schemes">Setting Authentication Schemes</MadCap:xref>.</p></li>
      <li>Configure the chosen authentication scheme:
			
			<ul><li>If you are using basic authentication, specify the client username to be used for authentication.<p class="Code">solace1(configure/message-vpn)# replication bridge authentication basic<br/>solace1(...plication/bridge/authentication/basic)# client-username &lt;name&gt;</p></li><li>If you are using client certificate authentication, specify the certificate to be used for authentication.<p class="Code">solace1(configure/message-vpn)# replication bridge authentication client-certificate<br/>solace1(...dge/authentication/client-certificate)# certificate-file &lt;filename&gt;</p><p class="Note">The common name in the client certificate is used as the client username to log on to the remote Message VPN, and so it must match a valid user on the remote event broker. The remote Message VPN must have client certificate authentication enabled and follow the client certificate rules that are configured on the local Message VPN.</p></li></ul></li>
      <li>Configure the replication bridge to use TLS/SSL encryption.</li>
      <p class="Code">solace1(configure)# message-vpn &lt;local-message-vpn&gt;<br/>solace1(configure/msg-vpn)# replication bridge ssl</p>
      <li>Enable replication.
            <p class="Code">solace1(configure/msg-vpn)# no replication shutdown</p></li>
      <li>Repeat steps 2 through 9 on the event broker of the remote Message VPN to create a bi-directional Message VPN replication bridge.</li>
    </ol>
    <h2 class="with-rule"><a name="managing_tls_ssl_service_1762742558_317096"/>TLS/SSL Encryption Configuration for SEMP Service</h2>
    <p>The following configuration steps are required to use TLS/SSL-encrypted communications between an  event broker and a management application using SEMP request over HTTP service:</p>
    <ol>
      <li>Set the server certificate for the  event broker.
			<p>See <MadCap:xref href="Managing-Server-Certs.htm">Managing Server Certificates</MadCap:xref>.</p></li>
      <li>Optionally, configure the cipher suite list for management connections to the  event broker.<p>See <MadCap:xref href="Configuring-Cipher-Suites-for-Inbound-Connections.htm">Configuring Cipher Suites for Inbound Connections</MadCap:xref>.</p></li>
      <li>Configure a TLS/SSL service listen port as one of the service ports to be used by the  event broker.
            <p>See <MadCap:xref href="../Services/Managing-Services.htm#SEMP-Port">Setting a SEMP Listen Port</MadCap:xref>.</p></li>
      <li>Enable SEMP service.            <p>See <MadCap:xref href="../Services/Managing-Services.htm#Enable-SEMP">Enabling SEMP Service</MadCap:xref>.</p></li>
      <li>Before establishing a connection from the management application to the event broker, an HTTPS URL scheme with the appropriate port must be used.        </li>
    </ol>
  </body>
</html>
