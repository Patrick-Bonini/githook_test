<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" MadCap:conditions="Default.ConnectorSpecific">
  <head>
    <link href="../../../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
    <link href="../../../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
    <title/>
  </head>
  <body>
    <h1>Getting Started With the <MadCap:variable name="Manifest-Products-Connectors.pubsub_self_contained_connector_for_google_pubsub"/></h1>
    <p MadCap:conditions="Default.HideFromAllOutput">Writer's Note: Most of the content is the same, but there are blocks that indicate the specific connector. We've specified the parts in the connector with the Connector-specific condition. Please check closely. We could use generic content instead of the name, but since it's a Getting Started, we should be explicit. If only we had folder-specific variables like in DITA!</p>
    <p>Presuming you’re using the default <code>application.yml</code> file provided within the download, follow one of the quick starts below to connect a <MadCap:variable name="Product-Names.pubsub_brand_only"/> event broker and a <MadCap:conditionalText MadCap:conditions="Default.ConnectorSpecific"><MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-product-name" MadCap:conditions="Default.ConnectorSpecific"/> broker</MadCap:conditionalText> . The quick starts use default credentials as examples to get started with two workflows enabled, <b>workflow 0</b> and <b>workflow 1</b>.</p>
    <p>Where:</p>
    <ul>
      <li>
        <p><b>Workflow 0</b> consumes messages from the <MadCap:variable name="Variables.CompanyName"/> <MadCap:variable name="Product-Names.pubsub_brand_only"/> queue, <code>Solace/Queue/0</code> and publishes them to the  <MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-product-name" MadCap:conditions="Default.ConnectorSpecific"/> producer destination, <code>producer-destination</code>.</p>
      </li>
      <li>
        <p><b>Workflow 1</b> consumes  messages from the<MadCap:conditionalText MadCap:conditions="Default.ConnectorSpecific"><MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-product-name"/></MadCap:conditionalText> subscription, consumer destination,<code> consumer-destination-sub</code>  and publishes them to the to the <MadCap:variable name="Variables.CompanyName"/> <MadCap:variable name="Product-Names.pubsub_brand_only"/> topic, <code>Solace/Topic/1</code>.</p>
      </li>
    </ul>
    <p>A workflow is the configuration of a flow of messages from a source to a target. The connector supports <MadCap:conditionalText MadCap:conditions="Default.ConnectorSpecific">up to 20 individual, concurrent workflows</MadCap:conditionalText> per instance.</p>
    <p class="Note">The connector does not provision queues that do not exist.</p>
    <h2>Prerequisites</h2>
    <ul>
      <li>
        <p>
          <a href="https://solace.com/products/event-broker/" target="_blank" class="link-offsite"><MadCap:variable name="Variables.CompanyName"/> <MadCap:variable name="Product-Names.pubsub_brand_only"/> event broker</a>
        </p>
        <ul>
          <li>
            <p>If you are using <MadCap:variable name="Manifest-Products-Connectors.pubsub_self_contained_connector_for_google_pubsub"/>, <MadCap:conditionalText MadCap:conditions="Default.ConnectorSpecific">version 2.2.2</MadCap:conditionalText> and later, you must use an  <MadCap:variable name="Product-Names.pubsub_brand_only"/> event broker running version 10.2.1 or later.</p>
          </li>
        </ul>
      </li>
      <li>
        <p MadCap:conditions="Default.ConnectorSpecific">
          <a href="https://cloud.google.com/pubsub" class="link-offsite" target="_blank"><MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-product-name"/> (GCP) broker</a>
        </p>
      </li>
    </ul>
    <h2>Quick Start Common Steps</h2>
    <p>These are the steps that are required to run all quick-start examples:</p>
    <ol start="1">
      <li>
        <p>Decide <MadCap:conditionalText MadCap:conditions="Default.ConnectorSpecific">which <a href="https://cloud.google.com/pubsub/docs/authentication#client-libraries" target="_blank" class="link-offsite"><MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-product-name"/>  authentication</a> </MadCap:conditionalText>mechanism will be used and accordingly have <code>application_default_credentials.json</code> or the service account key JSON, etc. available for use.</p>
      </li>
      <li>
        <p>Update the provided <code>samples/config/application.yml</code> with the values for your deployment.</p>
      </li>
    </ol>
    <h2><a name="_bookmark4"/>Quick Start: Running the Connector Using the Command Line</h2>
    <p>Run:</p>
    <pre xml:space="preserve">  java -jar <MadCap:conditionalText MadCap:conditions="Default.ConnectorSpecific"> <MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-package-name"/>-&lt;version&gt;.jar</MadCap:conditionalText> --spring.config.additionallocation=file:samples/config/      </pre>
    <p>Where <code>&lt;version&gt;</code> is the version of the connector you are using, such as <MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-latest-version"/>.</p>
    <p>By default, this command will detect any Spring Boot config files as per <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config.files" target="_blank" class="link-offsite">Spring Boot's default location</a>. </p>
    <p MadCap:conditions="Default.ConnectorSpecific">For more info, see <a href="GCP-PubSub-Configuration.htm" target="_blank" class="link-internal">Configure Locations to Find Spring Property Files</a>.</p>
    <p class="Note" MadCap:conditions="Default.ConnectorSpecific">By default, the <MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-product-name"/> client library looks for the authentication credentials as per the <a href="https://cloud.google.com/docs/authentication/application-default-credentials#order" class="link-offsite">Application Default Credentials (ADC) Search Order</a>. For more information, see <MadCap:xref href="GCP-PubSub-Configuring-Connection-Details.htm#gcp-connection-details">[%=Manifest-Products-Connectors.connector-gcppubsub-product-name%] Connection Details</MadCap:xref>.</p>
    <h2>Quick Start: Running the Connector Using the <code>start.sh</code> Script</h2>
    <MadCap:snippetBlock src="../../../../Resources/Snippets/API/Connectors/common/getting-started-generic-start-cmd-v2.0.0.flsnp"/>
    <p>The script shows you all errors at the same time:</p>
    <pre xml:space="preserve"><MadCap:variable name="Manifest-Products-Connectors.pubsub_self_contained_connector_for_google_pubsub_long" MadCap:conditions="Default.ConnectorSpecific"/>

Connector startup failed:

Following folder doesn't exists on your filesystem:     'dummy_folder'		
Following folder doesn't exists on your filesystem:     'dummy_folder'
Following file doesn't exists on your filesystem:       'dummy_file.jar'</pre>
    <p>In situations where you have don't provide a parameter, the script runs with the predefined values as follows:</p>
    <p class="Note"><a name="name-of-this-connector-jar"/>The default name for the JAR file is <MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-package-name" MadCap:conditions="Default.ConnectorSpecific"/><code MadCap:conditions="Default.ConnectorSpecific">-<MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-latest-version"/>.jar</code>.</p>
    <MadCap:snippetBlock src="../../../../Resources/Snippets/API/Connectors/common/getting-started-parameters-v2.0.0.flsnp"/>
    <p>The script also provides more help information from command line when you use the <code>-h</code> option. For more configuration examples of starting the connector together with <MadCap:variable name="Manifest-Products-Connectors.connector_manager_short"/>, see the examples provided in the <MadCap:variable name="Manifest-Products-Connectors.connector_manager_short"/> archive.</p>
    <h2>Quick Start: Running the Connector as a Container</h2>
    <p>The following steps show how to use a sample docker compose file has been packaged for your convenience:</p>
    <ol>
      <li MadCap:conditions="Default.ConnectorSpecific">
        <p>Add volume mapping in the sample <code>docker-compose.yml</code> for <code>application_default_credentials.json</code> from the local path to the <code>/app/external/gcp/config/application_default_credentials.json</code> target path.</p>
        <pre xml:space="preserve" MadCap:conditions="Default.ConnectorSpecific">solace-pubsub-connector-gcppubsub:
  volumes:
    - type: bind 
      source: /path/to/local/gcloud/application_default_credentials.json
      target: /app/external/gcp/config/application_default_credentials.json   
      read_only: true</pre>
      </li>
      <li>
        <p>Change to the <code>docker</code> directory:</p>
        <pre>cd samples/docker</pre>
        <p>This directory contains both the <code>docker-compose.yml</code> file as well as a <code>.env</code> file that contains environment secrets required for the container’s health-check.</p>
      </li>
      <li>
        <p>Run the connector:</p>
        <pre>docker-compose up -d</pre>
        <p>This sample docker compose file:</p>
        <ul>
          <li>
            <p>Exposes the connector’s <code>8090</code> web port to <code>8090</code> on the host.</p>
          </li>
          <li>
            <p>Connects to a  <MadCap:variable name="Product-Names.pubsub_brand_only"/> event broker and the <MadCap:variable name="Manifest-Products-Connectors.connector-gcppubsub-product-name" MadCap:conditions="Default.ConnectorSpecific"/> broker exposed on a host using default ports.</p>
          </li>
          <li>
            <p>Mounts the <code>samples/config</code> directory.</p>
          </li>
          <li>
            <p>Mounts the previously defined <code>libs</code> directory.</p>
          </li>
          <li>
            <p>Creates a <code>healthcheck</code> user with read-only permissions.</p>
            <ul>
              <li>
                <p>The default username and password for this user can be found within the <code>.env</code> file.</p>
              </li>
              <li>
                <p>This configuration overrides any users you have defined in your <code>application.yml</code>. See <MadCap:xref href="Security.htm">Security</MadCap:xref> for more information.</p>
              </li>
            </ul>
          </li>
          <li>
            <p>Uses the connector’s management health endpoint as the container’s health check.</p>
          </li>
        </ul>
      </li>
    </ol>
    <p MadCap:conditions="Default.ConnectorSpecific">For more info about how to use and configure this container, see <MadCap:xref href="GCP-container-configuration.htm">Modifying the Container Configuration</MadCap:xref>.</p>
  </body>
</html>
