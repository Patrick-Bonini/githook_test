<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>Publishing Messages in Transactions</h1>
    <p>To publish messages in a transaction, a <code>MessageProducer</code> must be acquired from the transacted Session. To then publish messages in transactions, call <code>MessageProducer.send(...)</code>.</p>
    <p>In a transaction, the event broker stages the published messages, and they are not delivered to their destinations on the event broker until the client issues a commit. If the commit is successful, the messages are delivered to their destinations and the staging information is removed.</p>
    <h2 class="with-rule"><a name="using_transacted_sessions_286557732_301975"/>How the Behavior of Endpoint Message Discard Affects Transactions</h2>
    <p>When a message that was published in a transaction cannot be spooled successfully to any of its destination endpoints on a commit, the message is discarded. In this case,  the endpoint's <code>reject-msg-to-sender-on-discard</code> property determines how the endpoint handles the discarded message.</p>
    <ul>
      <li>If the <code>reject-msg-to-sender-on-discard</code> property for the endpoint is enabled, a client commit response is returned to the client, the message is discarded, and the commit fails. In this case, the message cannot be spooled to other endpoints that it may have been destined for. </li>
      <li>If the <code>reject-msg-to-sender-on-discard</code> property for the endpoint is not enabled, the message is "silently" discarded (that is, the endpoint discards the message but returns a commit success response to the client), and the commit completes. In this case, the message can be spooled to other endpoints that it may have been destined for.</li>
    </ul>
    <p class="Note" MadCap:autonum="&lt;b&gt;: Â &lt;/b&gt;">When provisioning a Queue, by default the <code>reject-msg-to-sender-on-discard</code> property is enabled; when provisioning a Topic Endpoint, by default the property is not enabled.</p>
    <p>For more information on the <code>reject-msg-to-sender-on-discard</code> endpoint property and the conditions that can cause an endpoint not to spool and then to discard a message, see:</p>
    <ul>
      <li><MadCap:xref href="../../Messaging/Guaranteed-Msg/Configuring-Queues.htm#Message-Discard-Handling">Configuring Message Discard Handling</MadCap:xref> for queues</li>
      <li><MadCap:xref href="../../Messaging/Guaranteed-Msg/Configuring-DTEs.htm#Configur30">Configuring Message Discard Handling</MadCap:xref> for topic endpoints, which are used to support durable subscription names</li>
    </ul>
  </body>
</html>
