<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>Publishing Messages in XA Transactions</h1>
    <p>To publish messages in a transaction branch to a queue or topic destination, a <code>MessageProducer </code>must be created in the XA Session to establish a producer flow.</p>
    <p>To create a message producer, call <code>XASession.createProducer(Destination destination)</code> in the obtained XA Session.</p>
    <p>To then publish messages in the XA Session, call <code>MessageProducer.send(...)</code>.</p>
    <p>When messages are published in an XA Session after <code>XAResource.start(...)</code> is called, the event broker stages the published messages and assigns them to the transaction branch. However, the messages are not delivered to their destinations on the event broker until <code>XAResource.commit(...)</code> is called. A successful commit will deliver the messages to their destinations and remove the staging information.</p>
    <p>When messages are published in an XA Session before <code>XAResource.start(...)</code> is called, they are handled in same way as messages that are published in a regular Session. That is, they are not "transacted" messages.</p>
    <h2 class="with-rule"><a name="Message-Discards"/>How Endpoint Message Discards Affect XA Transactions</h2>
    <p>When a message that was published in a transaction branch cannot be spooled successfully to any of its destination endpoints on a commit, the message is discarded. In this case, the endpoint's <code>reject-msg-to-sender-on-discard</code> property determines whether the commit is successful.</p>
    <p>The message discard behavior for a regular Session-based transaction and an XA Session-based transaction are the same. For more information, refer to <MadCap:xref href="Publishing-Messages-in-T.htm#using_transacted_sessions_286557732_301975">How the Behavior of Endpoint Message Discard Affects Transactions</MadCap:xref>.</p>
  </body>
</html>
