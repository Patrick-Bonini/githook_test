<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>MQTT Messaging Management</h1>
    <MadCap:snippetBlock src="../Resources/Snippets/MQTT-intro.flsnp"/>
    <h2 class="with-rule"><a name="Enabling"/>Enabling and Disabling the MQTT Service</h2>
    <p>For information on how to enable and disable the MQTT service, refer to <MadCap:xref href="Managing-Services.htm#MQTT-Service">MQTT Service Management</MadCap:xref>.</p>
    <h2 class="with-rule"><a name="managing_mqtt_messaging_1203392003_440559"/>Managing the MQTT Service</h2>
    <p>MQTT service on a Solace PubSub+ event broker can be configured on a per-Message VPN level.</p>
    <p>You can configure the following settings for MQTT service.</p>
    <ul>
      <li>
        <MadCap:xref href="#managing_mqtt_messaging_1203392003_440579">Setting Listen Ports</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#managing_mqtt_messaging_1203392003_440596">Setting the Maximum Number of MQTT Connections</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#managing_mqtt_messaging_1203392003_440605">Enabling/Disabling MQTT Connections</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Request-Client-Cert">Configuring When to Request a Client Certificate from an MQTT Client</MadCap:xref>
      </li>
    </ul>
    <h3><a name="managing_mqtt_messaging_1203392003_440579"/>Setting Listen Ports</h3>
    <p>You must configure a TCP port number for MQTT clients to use when connecting to a Message VPN. Separate ports can be configured for each transport type that MQTT clients can use. The possible transport types are: plain-text, TLS/SSL, WebSocket, and WebSocket Secure.</p>
    <p>To set a listen port for MQTT connections to the given Message VPN, enter the following commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# listen-port &lt;port&gt; [ssl] [web]</p>
    <p><u>Where</u>:</p>
    <p><code>&lt;port&gt;</code> is the port number from 1 to 65535. This port must not be in use for any other service. Note that if the <code>ssl</code> and/or <code>web</code> parameters are not included with the command, the port will use a plain text transport.</p>
    <p><code>[ssl]</code> specifies that the given port uses TLS/SSL encryption.</p>
    <p><code>[web]</code> specifies that the given port uses WebSockets.</p>
    <p><code>[ssl]</code> and <code>[web]</code> together specify that the given port uses WebSockets Secure.</p>
    <p>The no version of this command, <code>no listen port</code>, removes the currently configured port number.</p>
    <div class="Note">
      <ul>
        <li>Enter the command a separate time for each transport type that you want to configure.</li>
        <li>To change a port number, the MQTT connection must be shutdown (refer to <MadCap:xref href="#managing_mqtt_messaging_1203392003_440605">Enabling/Disabling MQTT Connections</MadCap:xref>).</li>
      </ul>
    </div>
    <h3><a name="managing_mqtt_messaging_1203392003_440596"/>Setting the Maximum Number of MQTT Connections</h3>
    <p>To set the maximum number of MQTT clients that can simultaneously connect to the given Message VPN, enter the following commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# max-connections &lt;value&gt;</p>
    <p><u>Where</u>:</p>
    <p><code>&lt;value&gt;</code> is the maximum number of simultaneous connections permitted</p>
    <p>The no version of this command, <code>no max-connections</code>, resets the value to the maximum limit supported by the event broker.</p>
    <p class="Note">
            This parameter can be set to a value that is higher than the maximum number of simultaneous connections permitted by the event broker, but the connection limit for the event broker will still be enforced.<![CDATA[  ]]></p>
    <h3><a name="managing_mqtt_messaging_1203392003_440605"/>Enabling and Disabling MQTT Connections</h3>
    <p>Within a Message VPN, the MQTT service for the given Message VPN can be enabled or disabled according to the specific transport type that is used. By default, MQTT service is not enabled for a Message VPN.</p>
    <p>The following transports can be enabled and disabled for MQTT service:</p>
    <ul>
      <li>
        <MadCap:xref href="#managing_mqtt_messaging_1203392003_440624">Plain-Text</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#managing_mqtt_messaging_1203392003_440631">TLS</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#managing_mqtt_messaging_1203392003_440638">WebSocket</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#managing_mqtt_messaging_1203392003_440645">WebSocket Secure</MadCap:xref>
      </li>
    </ul>
    <h4><a name="managing_mqtt_messaging_1203392003_440624"/>Plain-Text</h4>
    <p>To enable MQTT connections using TCP plain-text transport for the given Message VPN, enter the following commands: 
			<p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# no plain-text shutdown</p></p>
    <p>To disable MQTT connections using TCP plain-text transport for the given Message VPN, enter the following commands: 
			<p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# plain-text shutdown</p><p>Disabling plain-text connections will disconnect any clients currently connected to the configured plain-text listen port.</p></p>
    <h4><a name="managing_mqtt_messaging_1203392003_440631"/>TLS</h4>
    <p>To enable MQTT connections using Transport Layer Security (TLS) / Secure Sockets Layer (SSL) transport for the given Message VPN, enter the following commands: 
			<p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# no ssl shutdown</p></p>
    <p>To disable MQTT connections using Transport Layer Security (TLS) / Secure Sockets Layer (SSL) transport for the given Message VPN, enter the following commands: 
			<p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# ssl shutdown</p><p>Disabling TLS/SSL connections will disconnect any clients currently connected to the configured TLS/SSL listen port.</p></p>
    <h4><a name="managing_mqtt_messaging_1203392003_440638"/>WebSocket</h4>
    <p>To enable MQTT connections using Websocket transport for the given Message VPN, enter the following commands: 
			<p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# no websocket shutdown</p></p>
    <p>To disable MQTT connections using Websocket transport for the given Message VPN, enter the following commands: 
			<p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# websocket shutdown</p><p>Disabling Websocket connections will disconnect any clients currently connected to the configured Websocket listen port.</p></p>
    <h4><a name="managing_mqtt_messaging_1203392003_440645"/>WebSocket Secure</h4>
    <p>To enable MQTT connections using Websocket Secure transport for the given Message VPN, enter the following commands: 
			<p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# no websocket-secure shutdown</p></p>
    <p>To disable MQTT connections using Websocket Secure transport for the given Message VPN, enter the following commands:
			<p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# websocket-secure shutdown</p><p>Disabling Websocket Secure connections will disconnect any clients currently connected to the configured Websocket Secure listen port.</p></p>
    <h3><a name="Request-Client-Cert"/>Configuring When to Request a Client Certificate from an MQTT Client</h3>
    <p>By default, PubSub+ event brokers  request client certificates from MQTT clients connecting via a TLSÂ port if client certificate authentication is enabled in a given Message VPN. Because many popular web browsers handle the request for a client certificate poorly, this can result in  clients running in web browsers being unable to connect over the WebSockets secure (WSS) protocol. If you have clients connecting from a web browser using WSS and other clients in the same Message VPN that need to authenticate using client certificates, you may want to prevent the broker from requesting a client certificate from incoming web clients. </p>
    <p>To configure when the broker requests a client certificate from incoming MQTT clients connecting via a TLS port, enter the following CONFIG commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service mqtt<br/>solace(configure/message-vpn/service/mqtt)# authentication<br/>solace(...ssage-vpn/service/mqtt/authentication)# client-certificate<br/>solace(...qtt/authentication/client-certificate)# request-client-certificate {always | never | when-enabled-in-message-vpn}<br/></p>
    <p><u>Where</u>:</p>
    <p><code>always</code> configures the broker to always request a client certificate regardless of whether client certificate authentication is enabled in the Message VPN. For more information, see <MadCap:xref href="../Security/Configuring-Client-Authentication.htm#managing_client_authentication_and_authorization_21734666_340052">Enabling Client Certificate Authentication For Clients</MadCap:xref>.</p>
    <p><code>never</code> configures the broker to never request a client certificate regardless of whether client certificate authentication is enabled in the Message VPN. This setting is useful if you don't want the broker to request a client certificate from your WebSocket secure clients, but you still want to use client certificate authentication for other types of clients (such as bridges).</p>
    <p><code>when-enabled-in-message-vpn</code> configures the broker to request  a client certificate only if client certificate authentication is enabled in the Message VPN. This is the default setting. </p>
    <p>The no version of command, <code>no request-client-certificate</code>, resets the value to the default.</p>
  </body>
</html>
