<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>Managing AMQP Service on VPNs</h1>
    <p>You can perform the following AMQP configurations for each Message VPN that AMQP clients will connect to:</p>
    <ul>
      <li>
        <MadCap:xref href="#set-vpn-listen-ports">Set Message VPN AMQP Listen Ports</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Set-Max-Connects">Set the Maximum Number of AMQP Connections</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Enable-Disable-VPN-Service">Enable/Disable AMQP Service for VPNs</MadCap:xref>
      </li>
    </ul>
    <p>You can also configure an <a href="Managing-Services.htm#Setting" class="link-internal">AMQP global listen port </a>that is shared between many Message VPNs. When a global AMQP TLS/SSL port is configured, all AMQP TLS/SSL clients can connect to the global port. As a result, per-Message VPN ports are not required and the configuration is much simpler.</p>
    <p class="Note">If authentication is turned off for the VPN, the event broker signals to connecting AMQP clients that it supports anonymous authentication. AMQP libraries like Apache Qpid respond to this by not sending credentials even if the application has specified them. As a result, clients authenticate using the VPN's default client username, and the VPN's default client username must be enabled to allow clients to connect.</p>
    <h2 class="with-rule"><a name="set-vpn-listen-ports"/>Set Message VPN AMQP Listen Ports</h2>
    <p>For AMQP clients that connect through per-Message VPN ports, separate listen ports for each Message VPN must be configured </p>
    <p>The AMQP service supports both plain-text and encrypted data transport. If you want to transport plain-text and TLS/SSL data, a separate port must be configured for each transport type (enter the command below for each transport type that you want to configure).</p>
    <p>To set a listen port for AMQP connections for a Message VPN, enter the following commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service amqp<br/>solace(configure/message-vpn/service/amqp)# listen-port &lt;port&gt; [ssl]<br/>solace(configure/message-vpn/service/amqp)# no shutdown<br/></p>
    <p><u>Where</u>:</p>
    <p><code>&lt;vpn-name&gt;</code> is the name of an existing Message VPN.</p>
    <p><code>&lt;port&gt;</code> is the port number from 1 to 65535. This port must not be in use for any other service. Note that if the <code>ssl</code> parameter is not included with the command, the port will use a plain text transport.</p>
    <p><code>[ssl]</code> specifies that the given port will use TLS/SSL transport.</p>
    <p>The no version of this command, <code>no listen-port ssl</code>, removes the currently configured port number.</p>
    <p class="Note">To change a port number, the AMQP service must be shutdown (refer to <MadCap:xref href="#Enable-Disable-VPN-Service">Enable/Disable AMQP Service for VPNs</MadCap:xref>).
        </p>
    <h2 class="with-rule"><a name="Set-Max-Connects"/>Set Maximum Number of AMQP Connections</h2>
    <p>To set the maximum number of AMQP clients that can simultaneously connect to a given Message VPN, enter the following commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service amqp<br/>solace(configure/message-vpn/service/amqp)# max-connections &lt;value&gt;</p>
    <p><u>Where</u>:</p>
    <p><code>&lt;vpn-name&gt;</code> is the name of an existing Message VPN.</p>
    <p><code>&lt;value&gt;</code> is the maximum number of simultaneous connections permitted</p>
    <p>The no version of this command, <code>no max-connections</code>, resets the value to the maximum limit supported by the event broker. </p>
    <p class="Note">This parameter can be set to a value that is higher than the maximum number of simultaneous connections permitted by the event broker, but the connection limit for the event broker will still be enforced.
        </p>
    <h2 class="with-rule"><a name="Enable-Disable-VPN-Service"/>Enable/Disable AMQP Service for VPNs</h2>
    <p>For each Message VPN, you can enable/disable the AMQP service for the plain-text or TLS/SSL ports. </p>
    <p>The ability to enable/disable the AMQP service for specific Message VPNs can be convenient if, for example, you do not want to disable AMQP service at the system level (<MadCap:xref href="Managing-Services.htm#AMQP-Service">Enabling System-Level AMQP Service</MadCap:xref>), which would disconnect all the AMQP clients on all Message VPNs.</p>
    <h3><a name="Enabling"/>Enabling AMQP Service</h3>
    <p>To enable the AMQP plain-text transport service for a Message VPN, enter the following commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service amqp<br/>solace(configure/message-vpn/service/amqp)# no plain-text shutdown</p>
    <p>To enable the AMQP TLS/SSL transport service for a Message VPN, enter the following commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service amqp<br/>solace(configure/message-vpn/service/amqp)# no ssl shutdown</p>
    <h3><a name="Disablin"/>Disabling AMQP Service</h3>
    <p>To disable the AMQP plain-text transport service for a Message VPN, enter the following commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service amqp<br/>solace(configure/message-vpn/service/amqp)# plain-text shutdown</p>
    <p>To disable the AMQP TLS/SSL transport service for a Message VPN, enter the following commands:</p>
    <p class="Code">solace(configure)# message-vpn &lt;vpn-name&gt;<br/>solace(configure/message-vpn)# service amqp<br/>solace(configure/message-vpn/service/amqp)# ssl shutdown</p>
    <p class="Note">Disabling the AMQP service on a Message VPN for a particular transport type will disconnect any AMQP clients currently connected to the Message VPN using that transport type. This includes AMQP clients using the global AMQP port and AMQP clients using the per-Message VPN listen port.</p>
  </body>
</html>
