<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head>
    <link href="../../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
    <link href="../../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
    <link href="../../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
  </head>
  <body>
    <h1><MadCap:concept term="Software"/>Rootful Podman with RHEL8 on AWS</h1>
    <p>This section walks you through the steps to set up a single PubSub+ <MadCap:variable name="Product-Names.broker_sw_short"/> container with Podman  on a Red Hat Enterprise Linux 8 instance in AWS Elastic Compute Cloud (EC2).</p>
    <ul>
      <li>
        <MadCap:xref href="#before-you-begin">Before You Begin</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#launch-a-host-and-install-podman">Step 1: Launch a Host and Install Podman</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#get-a-pubsub-software-event-broker">Step 2: Get a PubSub+ Software Event Broker</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#set-the-podman-create-options">Step 3: Set the Podman Create Options</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#create-the-container">Step 4: Create the Container</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#manage-the-pubsub-software-event-broker">Step 5: Manage the PubSub+ Software Event Broker</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#next-steps">Next Steps</MadCap:xref>
      </li>
    </ul>
    <h2 class="with-rule"><a name="before-you-begin"/>Before You Begin</h2>
    <p>It's assumed that you have an Amazon EC2 account.</p>
    <h3><a name="system-requirements"/>System Requirements</h3>
    <MadCap:snippetBlock src="../../../Resources/Snippets/System-Requirements-Container-Images.flsnp"/>
    <h2 class="with-rule"><a name="launch-a-host-and-install-podman"/>Step 1: Launch a Host and Install Podman</h2>
    <p>Use the AWS EC2 Dashboard’s Launch Instance wizard to create an Amazon Machine Image that you can use to run an event broker.</p>
    <ol>
      <li>On the main page of the EC2 Dashboard, select the <b>Launch Instance</b> button.
                <p><div class="thumbnail-container"><img src="../../../Resources/Images/SW-Broker-Setup/Container/Create-AWS-Instance.png" class="solacethumbnail" alt=""/></div></p><p>Follow the setup wizard and accept the recommended default settings except as noted in the following steps.</p></li>
      <li>In the <b>Choose an Amazon Machine Image (AMI)</b> step, search for <b>Red Hat Enterprise Linux 8</b> and then choose the official AWS distribution  from the AWS Marketplace.                <p><div class="thumbnail-container"><img src="../../../Resources/Images/SW-Broker-Setup/Container/AWS-RHEL-Choose-AMI.png" class="solacethumbnail" alt=""/></div></p></li>
      <li>In the <b>Choose an Instance Type</b> step, select an <b>Instance Type</b> according to the <MadCap:xref href="#system-requirements">System Requirements</MadCap:xref> section above.</li>
      <li>In the <b>Configure Instance Details</b> step, set <b>Subnet</b> to your availability zone.
                </li>
      <li>
        <p>In the <b>Add Storage</b> step, set the instance’s storage size and volume type.</p>
        <p>The amount of storage to attach to the instance depends on your application. Both SSD volume types, General Purpose and Provisioned IOPS, are supported.</p>
        <p>For test deployments, a minimum of 30 GB and Provisioned IOPS SSD are recommended.</p>
      </li>
      <li>
        <p>In the <b>Name and Tags</b> step, assign a name to your instance.</p>
        <p>You can add as many tags as required by your application.</p>
      </li>
      <li>
        <MadCap:snippetBlock src="../../../Resources/Snippets/container-inbound-rules.flsnp"/>
      </li>
      <li>After you have completed the launch wizard steps and logged into your host, install and configure Podman. Instructions can be found on the <a href="https://podman.io/getting-started/installation" class="link-offsite" target="_blank">Podman Installation Instructions</a> Web page.</li>
      <li>If you are using a t2.medium or t4g.medium instance type, you must create a swap file after the host is up. Enter the following commands:<pre xml:space="preserve">&gt;sudo mkdir /var/lib/solace
&gt;sudo dd if=/dev/zero of=/var/lib/solace/swap count=3072 bs=1MiB
&gt;sudo mkswap -f /var/lib/solace/swap
&gt;sudo chmod 0600 /var/lib/solace/swap
&gt;sudo swapon -f /var/lib/solace/swap
&gt;sudo grep -q 'solace\/swap' /etc/fstab || sudo sh -c 'echo "/var/lib/solace/swap  none swap sw  0  0" &gt;&gt; /etc/fstab'
</pre></li>
    </ol>
    <h2 class="with-rule"><a name="get-a-pubsub-software-event-broker"/>Step 2: Get a PubSub+ Software Event Broker</h2>
    <p>To get the event broker image:</p>
    <ol>
      <li>Navigate to the <a href="https://catalog.redhat.com/software/containers/solace/pubsubplus-standard/61f312870b230f6f012f5377" target="_blank" class="link-offsite">PubSub+ Software Event Broker</a> page of the Red Hat Ecosystem Catalog.</li>
      <li> Follow the instructions on the <b>Get this image</b> tab.</li>
    </ol>
    <div class="Note">
      <p>These steps download a <b>Solace PubSub+ Standard</b> container image. If you want to use <b>Solace PubSub+ Enterprise</b>, you must obtain the appropriate event broker package. If you have purchased a container image of Solace PubSub+ Enterprise, Solace will give you information for how to download the compressed tar archive package from a secure Solace server. <a href="../../../get-support.htm" class="link-internal">Contact Solace</a> for assistance.</p>
      <p>After you have downloaded the package, load the image. For details on the Podman command syntax, see <a target="_blank" class="link-offsite" href="https://docs.podman.io/en/latest/markdown/podman-load.1.html">podman load</a>. </p>
      <p>For example:</p>
      <p>
        <code>&gt;sudo podman load -i /tmp/solace-pubsub-enterprise-&lt;version&gt;-docker.tar.gz</code>
      </p>
    </div>
    <h2 class="with-rule"><a name="set-the-podman-create-options"/>Step 3: Set the Podman Create Options</h2>
    <p>There are many options that you can set with the <code>podman create</code> command that is used to create the event broker instance. In this example we will show one that sets up a simple configuration suitable for a test deployment that can be used to help you become familiar with Solace PubSub+.</p>
    <p>In this example:</p>
    <ul>
      <li>the <code>admin</code> Solace CLI user and an associated password are defined at container creation through the <code>username_admin_globalaccesslevel</code> and <code>username_admin_password</code> configuration keys. By default, in an event broker container, no Solace CLI users are defined, so setting these configuration keys allows the container to be administered through the Solace SolAdmin management tool without first entering the Solace CLI to create an <code>admin</code> user.</li>
      <li>the <a href="../../Configuring-Storage.htm#understanding-storage-group" class="link-internal">storage-group</a> volume (named <code>solace</code>) is mounted to <code>/var/lib/solace</code> in the container.  Podman automatically creates the volume if it does not already exist. The <code>storage-group</code> requires at least 5.1 GB of storage space. See <MadCap:xref href="../../System-Resource-Requirements.htm">System Resource Requirements</MadCap:xref> and <MadCap:xref href="../../Container-Tasks/Config-Container-Storage.htm">Managing Storage for Container Images</MadCap:xref> for more information.</li>
      <li>the container is created in rootful mode. For details about the difference between rootful and rootless containers, see <MadCap:xref href="../../Container-Tasks/rootless-containers.htm">Rootless Containers</MadCap:xref>.</li>
      <li>the values of the <code>&lt;repository&gt;</code> and <code>&lt;tag&gt;</code> depend on the event broker image you loaded in the previous section. For example:<ul><li>if you pulled the <code>latest</code> PubSub+ Standard image from the Red Hat Ecosystem Catalog, the <code>&lt;repository&gt;</code> is <code>registry.connect.redhat.com/solace/pubsubplus-standard</code> and the <code>&lt;tag&gt;</code> is <code>latest</code></li><li> if you obtained and loaded the PubSub+ Standard Edition, the value of <code>&lt;repository&gt;</code> is <code>solace-pubsub-standard</code> and <code>&lt;tag&gt;</code> is the version you downloaded, for example <code>9.13.1.36</code>.</li></ul></li>
    </ul>
    <p>To set the <code>podman create</code> options:</p>
    <ol>
      <li>
        <p>Log in to the Red Hat Connect registry using <code>sudo</code>:</p>
        <pre>&gt;sudo podman login registry.connect.redhat.com</pre>
      </li>
      <li>Create the <code>podman-create</code> script, replacing <code>&lt;repository&gt;</code> and <code>&lt;tag&gt;</code> with the appropriate values:
<pre class="Code" xml:space="preserve">&gt;sudo tee ./podman-create &lt;&lt;-EOF
#!/bin/bash
sudo podman create \
--network=host \
--uts=host \
--shm-size=1g \
--ulimit core=-1 \
--ulimit memlock=-1 \
--ulimit nofile=2448:42192 \
--env 'username_admin_globalaccesslevel=admin' \
--env 'username_admin_password=admin' \
--name=solace \
-v solace:/var/lib/solace:z \
&lt;repository&gt;:&lt;tag&gt;
</pre><p>For production deployments, there are use-case dependent factors that impact the options and configuration key settings in the <code>podman create</code> command. For more information, see <MadCap:xref href="../../System-Resource-Requirements.htm">System Resource Requirements</MadCap:xref></p></li>
      <li>Make the <code>podman-create</code> script executable:
                <pre class="Code" xml:space="preserve">&gt;sudo chmod +x ./podman-create</pre></li>
    </ol>
    <h2 class="with-rule"><a name="create-the-container"/>Step 4: Create the Container</h2>
    <p style="font-weight: normal;">Create and run the event broker container on your host.</p>
    <ol>
      <li>Create the container:
                <pre>&gt;./podman-create</pre><p>After <code>podman-create</code> finishes, a long identifier is displayed that looks something like this:</p><pre>1cb8dba3c07b6970b1e22c1067fde76010259e50a8548c3f2f202a6e9ce4e345</pre><p>This is the ID for the event broker container you have just created.</p></li>
      <li>Start the event broker:
                <pre>&gt;sudo podman start solace</pre><p>You can use the <code>podman ps</code> command to check on the status of the event broker.</p><pre>&gt;sudo podman ps</pre><p>The <code>STATUS</code> column associated with the event broker shows whether the container is running and for how long.</p></li>
    </ol>
    <h2 class="with-rule"><a name="manage-the-pubsub-software-event-broker"/>Step 5: Manage the  Software Event Broker</h2>
    <MadCap:snippetBlock src="../../../Resources/Snippets/container-manage-broker-podman.flsnp"/>
    <h2 class="with-rule"><a name="next-steps"/>Next Steps</h2>
    <MadCap:snippetBlock src="../../../Resources/Snippets/SW-broker-setup-next-steps.flsnp"/>
  </body>
</html>
