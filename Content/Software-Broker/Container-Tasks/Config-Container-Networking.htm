<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head>
    <link href="../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
  </head>
  <body>
    <h1><MadCap:concept term="Software"/>Container Networking</h1>
    <p>The <MadCap:variable name="Product-Names.pubsub_brand_only"/> <MadCap:variable name="Product-Names.broker_sw_short"/> can run as either a rootful or rootless container. Because unprivileged users cannot create networking interfaces on the host, whether the container is running as a root or a non-root user is the most important consideration for networking. This determines the networking mode that cannot be used.  Other factors that influence networking are the number of clients that need to connect to the container, whether containers need to communicate with each other, and what security constraints there are in the environment.</p>
    <p>The following sections describes the networking modes that are supported by <MadCap:variable name="Manifest-Products-Connectors.connector-solacemsgproc-product-name"/> <MadCap:variable name="Product-Names.broker_sw_short"/> containers and provides some links to additional information that may be helpful: </p>
    <p class="Caution"><MadCap:variable name="Variables.CompanyName"/> does not support the use of  <code>HTTP_PROXY</code> or <code>HTTPS_PROXY</code> environment variables in  <MadCap:variable name="Product-Names.pubsub_brand_only"/> <MadCap:variable name="Product-Names.broker_sw_short"/> containers. Do not use these variables in your <MadCap:variable name="Product-Names.pubsub_brand_only"/> <MadCap:variable name="Product-Names.broker_sw_short"/> containers.</p>
    <ul>
      <li>
        <MadCap:xref href="#rootful">Rootful Mode</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#rootless">Rootless Mode</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#summary">Summary</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#next-steps">Next Steps</MadCap:xref>
      </li>
    </ul>
    <h2 class="with-rule"><a name="rootful"/>Rootful Mode</h2>
    <p>Rootful mode is the default for most container runtimes , and in this mode, most container runtimes (including Docker and Podman) create a bridge network by default. The container runtime  creates an interface for the container on an internal bridge network, which is then connected to other networks (or the Internet) using Network Address Translation (NAT). Unless otherwise specified, all containers in the host connect to that bridge network. With bridge networking, you have to provide a mapping of the ports between the containers and the host. </p>
    <p class="Note">Because the containers all connect to the same network, you must configure your port mappings so that they don't collide in the host port space.</p>
    <p>Another option for rootful containers is host networking. For this network mode, you specify the <code>--network=host</code> flag when you start the container. All container ports are exposed on the host. Host mode removes network isolation between the container and the host, and uses the host’s networking directly. </p>
    <p>Because it doesn't require network address translation (NAT), host mode networking can optimize performance when a container needs to handle a large range of ports.</p>
    <h2 class="with-rule"><a name="rootless"/>Rootless Mode</h2>
    <p>For rootless Podman, the default network configuration  is <code>slirp4netns</code>. The <code>slirp4netns</code>package provides user-mode networking for non-root users. It creates a tunnel from the host into the container to forward traffic. With <code>slirp4netns</code>, containers are completely isolated from each other. There is no virtual network, so in order to communicate with each other, containers can use port mappings with the host system, or they can be put into a Pod where they share the same network namespace.</p>
    <p>Podman supports two port handlers:</p>
    <ul>
      <li>
        <p><code>port_handler=rootlesskit</code>: Use <code>rootlesskit</code> for port forwarding. This is the default port handler.</p>
        <p class="Note">We recommend using  the <code>slirp4netns</code> port handler, which is not the default (that is, you must specify <code>port_handler=slirp4netns</code> when you create the container). This is because  the PubSub+ event broker requires knowledge of source IP addresses, but <code>rootlesskit</code> changes the source IP address of incoming packets to an IP address in the container network namespace (usually 10.0.2.100).</p>
      </li>
      <li><code>port_handler=slirp4netns</code>: Use the <code>slirp4netns</code> port forwarding. This port handler preserves the correct source IP address.</li>
    </ul>
    <MadCap:snippetBlock src="../../Resources/Snippets/Podman-slirp4netns-port-handler-known-issue.flsnp"/>
    <p>Podman also supports host mode (<code>--net=host</code>) with rootless containers. Note that with a rootless container running with host network mode, subsequent <code>podman exec</code> commands to that container will not join the host network namespace because it is owned by root.</p>
    <h2 class="with-rule"><a name="summary"/>Summary of Supported Networking Options </h2>
    <p>The following table lists the networking options for rootful and rootless mode that are supported by <MadCap:variable name="Manifest-Products-Connectors.connector-solacemsgproc-product-name"/> <MadCap:variable name="Product-Names.broker_sw_short"/> containers.</p>
    <table style="width: 100%;margin-left: 0;margin-right: auto;mc-table-style: url('../../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <thead>
        <tr class="TableStyle-Table_Num-Head-Header1">
          <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Mode</th>
          <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Supported Network-Driver</th>
          <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Details</th>
        </tr>
      </thead>
      <tbody>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1" rowspan="2">Rootful</td>
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>bridge</code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>The default network mode for most runtimes in rootful mode, including Docker and Podman.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>host</code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>Removes network isolation between the container and the host, and uses the host’s networking directly.</p>
            <p>Support is provided for only one physical interface per container.</p>
            <p>For best performance, use of the <code>host</code> network driver is recommended wherever possible, especially in use cases with large numbers of client connections.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1" rowspan="2">Rootless</td>
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>host</code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>Removes network isolation between the container and the host, and uses the host’s networking directly.</p>
            <p>Note: The host mode gives the container full access to local system services such as D-bus and is therefore considered insecure.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
            <code>slirp4netns</code>
          </td>
          <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
            <p>Provides user-mode networking for unprivileged network namespaces. This is the default for rootless Podman.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <h2 class="with-rule"><a name="next-steps"/>Next Steps</h2>
    <p>For more information about container networking with Podman, see:</p>
    <ul>
      <li>
        <a href="https://github.com/containers/podman/blob/main/docs/tutorials/basic_networking.md" target="_blank" class="link-offsite">Basic Networking Guide for Podman</a>
      </li>
      <li><a href="https://www.redhat.com/sysadmin/container-networking-podman" target="_blank" class="link-offsite">Configuring container networking with Podman</a> (Red Hat documentation)</li>
      <li>
        <a href="https://github.com/containers/podman/blob/main/rootless.md" target="_blank" class="link-offsite">Shortcomings of Rootless Podman</a>
      </li>
    </ul>
    <p>For more information about container networking with Docker, see:</p>
    <ul>
      <li><a href="https://docs.docker.com/network/" target="_blank" class="link-offsite">Networking overview</a> (Docker documentation)
</li>
    </ul>
    <p>For a detailed discussion about rootless containers in general, see:</p>
    <ul>
      <li>
        <a href="https://rootlesscontaine.rs/" target="_blank" class="link-offsite">Rootless Containers</a>
      </li>
    </ul>
  </body>
</html>
