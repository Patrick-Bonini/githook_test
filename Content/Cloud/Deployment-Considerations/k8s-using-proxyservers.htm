<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head>
    </head>
  <body>
    <h1><MadCap:concept term="Cloud"/>Using HTTP/HTTPS Proxies</h1>
    <p><MadCap:variable name="Product-Names.cloud_product_firstuse"/> supports deployments where you require or want to use an <code>http</code> or <code>https</code> proxies.  You can use proxies to regulate your <MadCap:variable name="Product-Names.broker_cloud_short"/>'s access to the internet, or exclude them from public availability. You may need to use proxies to meet security requirements. <MadCap:variable name="Variables.CompanyName"/> supports proxies in most situations and  works with you to ensure that your security requirements are met with the proxy.</p>
    <p><MadCap:variable name="Variables.CompanyName"/> supports using proxies for any of your <a href="connectivity-model-k8s.htm#understand-types-of-connectivity" target="_blank" alt="link to understanding the types of connectivity to configure" class="link-internal">connectivity requirements</a>, however, when using proxies for <MadCap:variable name="Product-Names.operational_connectivity"/> between <MadCap:variable name="Product-Names.home_cloud_short"/> and the <MadCap:variable name="Product-Names.cloud_agent_short"/>, there are some limitations you must consider. For more information, see <MadCap:xref href="#operational-proxy">Using a Proxy for [%=Product-Names.operational_connectivity%] between [%=Product-Names.cloud_agent_short%] and [%=Product-Names.home_cloud_short%]</MadCap:xref>.</p>
    <p>See <MadCap:xref href="#proxies-use-cases">Use Cases</MadCap:xref> for some examples of why you may want to use a proxy.</p>
    <p>In environments where access to the Internet needs to be restricted, you can configure a proxy with the <code>http_proxy</code> or <code>https_proxy</code> properties of your Kubernetes cluster deployment.</p>
    <p>In simple terms, using HTTP/HTTPS proxies maintains security while providing convenience. Using an HTTP/HTTPS proxy you can:</p>
    <ul>
      <li>Control your <MadCap:variable name="Product-Names.broker_cloud_short"/>'s traffic.</li>
      <li>Hide the IP addresses of your <MadCap:variable name="Product-Names.broker_cloud_short"/> and achieve online anonymity.</li>
      <li>Work with the network restrictions of your environment.</li>
    </ul>
    <p>If you choose to use a proxy, you must let <MadCap:variable name="Variables.CompanyName"/> know at the time of deployment. This ensures that we generate a <code>values.yaml</code> file with the appropriate parameters for the Helm Chart. The customer must also provide details (URL, username, and password) of the HTTP/HTTPS proxy server to the <MadCap:variable name="Product-Names.cloud_agent_short"/> when deploying it. The example below shows components that may be required for a proxy: </p>
    <p>For any of you connectivity requirements, </p>
    <pre xml:space="preserve">
proxy:
    https_proxy: "http://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@&lt;PROXY_SERVER_FOR_HTTPS&gt;:&lt;PORT&gt;"
    http_proxy: "http://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@&lt;PROXY_SERVER_FOR_HTTP&gt;:&lt;PORT&gt;"</pre>
    <p>As an example, a customer whose proxy is at <code>proxyserver.customer.com:3341</code> with a username <code>user1234</code> and password <code>3444password3232</code> would have the following entry in the <code>values.yaml</code> file.</p>
    <pre xml:space="preserve">
datacenter:
  id: <MadCap:variable name="Variables.CompanyName"/>-abc-test
  region: us-east-1
  httpsProxy: 'http://user1234:3444password3232@proxyserver.customer.com:3341'</pre>
    <h2><a name="operational-proxy"/>Considerations When Using a Proxy for <MadCap:variable name="Product-Names.operational_connectivity"/> between <MadCap:variable name="Product-Names.cloud_agent_short"/> and <MadCap:variable name="Product-Names.home_cloud_short"/></h2>
    <p>If your security requires, <MadCap:variable name="Variables.CompanyName"/> can configure the <MadCap:variable name="Product-Names.operational_connectivity"/> between the <MadCap:variable name="Product-Names.cloud_agent_short"/> and <MadCap:variable name="Product-Names.home_cloud_short"/> to run <code.blue>through </code.blue>a proxy. <MadCap:variable name="Product-Names.operational_connectivity"/> carries the communications required to install the <MadCap:variable name="Product-Names.cloud_agent_short"/> and to install, operate, and monitor <MadCap:variable name="Product-Names.broker_cloud_short"/>s. For more information, see <MadCap:xref href="connectivity-model-k8s.htm" target="_blank" alt="Link to Connectivity Model for Kuberntes Deployments">Connectivity Model for Kubernetes Deployments</MadCap:xref>.</p>
    <p>When using a proxy for <MadCap:variable name="Product-Names.operational_connectivity"/>, you must be aware of the following considerations:</p>
    <ul>
      <li>
        <p><MadCap:variable name="Variables.CompanyName"/> supports only HTTP proxies. We tested support for HTTP proxies for <MadCap:variable name="Product-Names.operational_connectivity"/> using <a href="https://www.squid-cache.org/" target="_blank" alt="Link to squid-cache.org" class="link-offsite">Squid</a> and <a href="https://github.com/zevenet/zproxy/blob/master/README.md" target="_blank" alt="Link to Zproxy github repository" class="link-offsite">ZProxy</a>.</p>
      </li>
      <li>
        <p><MadCap:variable name="Variables.CompanyName"/> supports both authenticated and non-authenticated proxies</p>
      </li>
      <li>
        <p>When using a proxy, it must support: </p>
        <ul>
          <li>
            <p>
              <a href="https://www.rfc-editor.org/rfc/rfc9110#CONNECT" target="_blank" alt="Link to description of HTTP CONNECT" class="link-offsite">HTTP CONNECT</a>
            </p>
          </li>
          <li>
            <p>proxying to a non-443 port; in particular to port 55443</p>
          </li>
        </ul>
      </li>
      <li>
        <p>If your proxy supports SSL Inspection, you must disable the SSL Inspection for the regional hostname for the <MadCap:variable name="Product-Names.cloud_agent_short"/> to <MadCap:variable name="Product-Names.pubsub_brand_only"/> <MadCap:variable name="Product-Names.home_cloud_short"/> (for example, <code>production-ivmr.<MadCap:variable name="Manifest-Products-Links.CloudConsoleMessagingURL"/></code>). For a list of host names by region, see <MadCap:xref href="connectivity-model-k8s.htm#connection-details-kubernetes" target="_blank" alt="link to connection requiremnts">Connection Requirements for [%=Product-Names.cloud_product_titlecase%] Components</MadCap:xref>.</p>
      </li>
    </ul>
    <h2><a name="proxies-use-cases"/>Use Cases</h2>
    <p>There are numerous reasons you may decide to use a proxy. For deployments inside a private region, using a proxy is a simple method of controlling your services access to regions outside of your private region. The following use cases provide some examples where using a proxy can help manage <MadCap:variable name="Product-Names.broker_cloud_short"/> access to the public Internet:</p>
    <h3>Secure Access to Public Internet</h3>
    <p>Perhaps you decide to permit access to the public Internet for the <MadCap:variable name="Product-Names.broker_cloud_short"/>s for outbound traffic. A proxy might be useful for  outbound connections, such as RDPs (REST Destination Points). The <MadCap:variable name="Product-Names.broker_cloud_short"/> can be configured to originate from a static IP address. The proxy makes it easier for applications outside of your deployment to whitelist. Proxies are useful in situations where you don't use a NAT or where you don't have a static IP address.</p>
    <h3>Managing Connections to Outside Services</h3>
    <p>For deployments inside a <MadCap:variable name="Product-Names.customer-controlled_region"/>s, you can use a proxy as a method of controlling and managing access to services outside the <MadCap:variable name="Product-Names.customer-controlled_region"/> with <code>hostnames</code> instead of IP addresses. For example, you may have a requirement for the <MadCap:variable name="Product-Names.cloud_agent_short"/> to contact Datadog, which handles the monitoring data for <MadCap:variable name="Product-Names.broker_cloud_short"/>s. Because Datadog doesn't use static IP addresses, you can use a proxy to streamline the maintenance of connecting to Datadog and have the proxy determine whether a connection between the <MadCap:variable name="Product-Names.cloud_agent_short"/> and Datadog is allowed using a <code>hostname</code> instead of IP addresses.</p>
  </body>
</html>
