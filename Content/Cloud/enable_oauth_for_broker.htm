<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head>
    <link href="../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
  </head>
  <body>
    <h1>Configuring an <MadCap:variable name="Product-Names.broker_cloud_short_title"/> to Use OAuth Identity Provider Authorization</h1>
    <p>You can configure an <MadCap:variable name="Product-Names.broker_cloud_short"/> to use an OAuth protocols to authorize connecting client applications. This allows the applications and clients to use OAuth authorization protocols when connecting to the <MadCap:variable name="Product-Names.broker_cloud_short"/>.  You use both the <MadCap:variable name="Product-Names.console_ui_short"/> and <a href="using-broker-manager-cloud.htm" class="link-internal"><MadCap:variable name="Product-Names.pubsubmanager_long"/></a> to configure OAuth identity provider authentication for the <MadCap:variable name="Product-Names.broker_cloud_short"/>. This topic assumes that you are familiar with OAuth  and the configuration of your identity provider.</p>
    <p>Enable OAuth authentication for your <MadCap:variable name="Product-Names.broker_cloud_short"/> with these steps:</p>
    <ol>
      <li><![CDATA[
                    ]]><a href="#Enable" class="link-internal">Enable OAuth identity provider authorization</a><![CDATA[
                ]]></li>
      <li>
        <a href="#Adding" class="link-internal">Add the default profile to the <MadCap:variable name="Product-Names.broker_cloud_short"/></a>
      </li>
    </ol>
    <h2><a name="Enable"/>Enabling OAuth Identity Provider Authentication for <MadCap:variable name="Product-Names.broker_cloud_short_title"/>s</h2>
    <ol>
      <li>
        <MadCap:snippetBlock src="../Resources/Snippets/Cloud/Task_UI_Snippets/login_console.flsnp"/>
      </li>
      <li>Select <MadCap:variable name="Product-Names.cluster_mgr" style="font-weight: bold;"/><img src="../Resources/Images/Cloud/reusable-icons/navbar_cluster_manager.png" alt=""/> and select the <MadCap:variable name="Product-Names.broker_cloud_short"/> that you want to enable OAuth authentication for.</li>
      <li>On the <b>Manage</b> tab for the <MadCap:variable name="Product-Names.broker_cloud_short"/>, click <b>Authentication</b>.
            <div class="thumbnail-container"><img class="solacethumbnail" src="../Resources/Images/Cloud/oauth_enableauthentication.png" alt="Screenshot highlighting the Authentication tile"/></div></li>
      <li>Click the <b>OAuth Provider Authentication</b> toggle to enable OAuth Provider Authentication for the <MadCap:variable name="Product-Names.broker_cloud_short"/>. 
            <div class="thumbnail-container"><img class="solacethumbnail" src="../Resources/Images/Cloud/oauth_enable_oauthprovider.png" alt=""/></div></li>
      <li>Click <b>Save</b> and then click <b>OK</b> to confirm.</li>
      <li>Click <b>Back to Management</b></li>
      <li>To verify that OAuth provider authentication is enabled, click <b>Access Control</b>. 
            <div class="thumbnail-container"><img class="solacethumbnail" src="../Resources/Images/Cloud/oauth_accesscontrol.png" alt=""/></div><p><MadCap:variable name="Product-Names.pubsubmanager_short"/> opens in a new browser tab.</p></li>
      <li> On the <b>Settings</b> tab locate the <b>OAuth Authentication</b> toggle and ensure it is enabled. You will return to this window later to add the <b>Default Profile Name</b> as outlined in <MadCap:xref href="#Adding">Add the Default Profile to the [%=Product-Names.broker_cloud_short_title%]</MadCap:xref>.
            <div class="thumbnail-container"><img class="solacethumbnail" src="../Resources/Images/Cloud/oauth_selectorandprofile.png" alt=""/></div></li>
      <li>
        <p>To add an OAuth profile to the <MadCap:variable name="Product-Names.broker_cloud_short"/>, click the <b>OAuth Profile</b> tab.</p>
        <div class="thumbnail-container">
          <img class="solacethumbnail" src="../Resources/Images/Cloud/oauth_oauthprofiletab.png" alt=""/>
        </div>
      </li>
      <li> Click <b>+ OAuth Profile</b>. 
			</li>
      <li>Enter an <b>OAuth Profile Name</b> and click <b>Create</b>.</li>
      <li>Enter the appropriate details for the following OAuth profile settings:</li>
      <table style="width: 100%;margin-left: 0;margin-right: auto;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
        <col class="TableStyle-Table_Num-Column-Column1"/>
        <col class="TableStyle-Table_Num-Column-Column1"/>
        <thead>
          <tr class="TableStyle-Table_Num-Head-Header1">
            <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Configuration</th>
            <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>Enabled</code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>Enables or disables the OAuth profile</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>OAuth Client ID</code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The <code>OAuth client-id</code> identifies the client responsible for the OAuth request. Client IDs configured on the <MadCap:variable name="Product-Names.broker_cloud_short"/> must match with the OAuth Client ID.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>OAuth Role</code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>Select <code>Resource Server</code> if you want the <MadCap:variable name="Product-Names.broker_cloud_short"/> to handle authenticated requests after the connecting service has obtained an access token.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
              <code>Disconnect on Token Expiration</code>
            </td>
            <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
              <p>Enables or disables the disconnection of clients when their token expires. Changing this value does not affect existing clients.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>Issuer Identifier</code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>Enter the <code>URL</code> for the <code>issuer identifier</code>. This is the verifiable identifier for an issuer.</p>
              <p>This field is required. If left incomplete the profile will be inactive.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>EndPoints</code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>Leave all the fields in this section in their default state except the following two fields:<br/></p>
              <ul>
                <li><b>Introspection Endpoint</b>—If the OAuth Role is <code>Resource Server</code>, the introspection endpoint returns claims associated with the user identified by the access token. Enter the URL to your the OAuth introspection endpoint. Only <code>HTTPS</code> addresses are supported in this field.</li>
                <li><b>Introspection Request Timeout</b>—This is the maximum time in seconds that can pass before the introspection request times out. The field's default value is 1. <MadCap:variable name="Variables.CompanyName"/> recommends using a higher value during testing, and reducing the value until you find an appropriate setting.</li>
              </ul>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>Authorization Group Claims Name</code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>Enter the <code>&lt;access-level-group-claim-name&gt;</code>. The group claim name is the name of the claim that contains the groups that the event broker will use to authorize the user. Once all appropriate token verification has been performed, the event broker will determine the OAuth groups based on the <code>access-level-group-claim-name</code>.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
              <code>Username Claim Name</code>
            </td>
            <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
              <p>Enter the <code>&lt;username-claim-name&gt;</code>. The username claim name is the name of claim containing the username that the event broker verifies. You can configure a custom username-claim-name, which must be a string; for example, an email. Claims of other types such as number, boolean, object, array, etc., are not supported.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
              <code>Resource Server</code>
            </td>
            <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
              <p>Toggle the validation requirements on or off depending on your needs.  Generally, most of the options in this section are required by JSON Web Tokens instead of opaque OAuth2 tokens. However, completion of the <b>Required Scope</b> field may be necessary.</p>
              <ul>
                <li><b>Required Scope</b>—Enter a space-separated list of <code>scopes</code> that are required by the <code>scope</code> claim. If this field is left empty, no <code>scope</code> verification will be performed.</li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
      <li>Click <b>Apply</b>.</li>
    </ol>
    <h2><a name="Adding"/>Adding a Default OAuth Profile to the <MadCap:variable name="Product-Names.broker_cloud_short_title"/></h2>
    <p>After <a href="#Creating" class="link-internal">adding the OAuth profile to the <MadCap:variable name="Product-Names.broker_cloud_short"/></a>, you  can set it to be the default profile.</p>
    <ol>
      <li>If you don't have <MadCap:variable name="Product-Names.pubsubmanager_short"/> open, in <MadCap:variable name="Product-Names.cluster_mgr"/> select the <MadCap:variable name="Product-Names.broker_cloud_short"/> service you have <a href="#Enable" class="link-internal">enabled OAuth for</a> and click <b>Open <MadCap:variable name="Product-Names.pubsubmanager_long"/></b>.</li>
      <li>Click <b>Access Control</b>.
 </li>
      <li>On the <b>Client Authentication &gt; Settings</b> tab, click <b>Edit</b>.
				<div class="thumbnail-container"><img class="solacethumbnail" src="../Resources/Images/Cloud/oauth_editdefaultprofilename.png" alt="screenshot showing the settings described in the surrounding text."/></div></li>
      <li>Click <b>Default Profile Name</b> and select the <a href="#Creating" class="link-internal">profile you created</a> from the menu. If you have numerous profiles, you can use the search field to search the list. 
            	<div class="thumbnail-container"><img class="solacethumbnail" src="../Resources/Images/Cloud/oauth_popprofilenamefield.png" alt="Screenshot showing the settings described in the surrounding text."/></div></li>
      <li>Click <b>Apply</b>.</li>
      <li>To confirm that the profile is active, click the <b>OAuth Profile</b> tab and then click the name of the OAuth Profile.
            	</li>
      <li>Click the <b>Stats</b> tab and then click <b>Details</b>. <b>Yes</b> appears in the <b>Active</b> field when the profile is active.
            	<div class="thumbnail-container"><img class="solacethumbnail" src="../Resources/Images/Cloud/oauth_confirmactive.png" alt="Screenshot showing the settings described in the surrounding text."/></div></li>
    </ol>
  </body>
</html>
