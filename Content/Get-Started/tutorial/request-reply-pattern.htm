<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head>
    <link href="../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
  </head>
  <body>
    <h1><MadCap:concept term="Cloud;Software"/>Step 5: Try a Request-Reply Message Exchange Pattern</h1>
    <p>You've now completed <MadCap:xref href="pub-sub-pattern.htm">Step 4: Try a Publish-Subscribe / Fan-Out Message Exchange Pattern</MadCap:xref>.</p>
    <p>In step 5, you'll expand your EDA by setting up a request-reply message exchange.</p>
    <p class="with-rule"> With request-reply messaging, applications achieve two-way communication using separate point-to-point channels: one for requests, and another for replies. In a request-reply pattern, the applications are both producers and consumers.</p>
    <p>
      <img src="../../Resources/Images/Getting-Started/request-reply.png" alt="diagram illustrating the concepts described in the surrounding text"/>
    </p>
    <p>In the Solly's Coffee OMS we introduced in <a href="try-me-cli-tool.htm#Use_Case" target="_blank" class="link-internal">step 3</a>,  a <b>Third-Party App</b> sends a new order event as a request to the <b>Order Management</b> application whenever a user places an order. Upon receiving the request, the <b>Order Management</b> application replies with the <code>order-id</code> in the response. This interaction uses a request-reply message exchange, ensuring that the order confirmation is received synchronously.</p>
    <h2>Set Up a Request-Reply Message Exchange</h2>
    <p>In this exercise we'll set up two applications, Order Management and Third-Party App. After you complete these steps you'll have a message exchange pattern like the following animation:</p>
    <p>
      <img src="../../Resources/Images/Animated/rep-req-pattern.gif" alt="Animation showing a request-reply message exchange"/>
    </p>
    <p>To set up a request-reply message exchange, perform these steps:</p>
    <ol>
      <li>Open two command-line  terminal windows, one for each application.</li>
      <li>In terminal 1, set up the <b>Order Management</b> application with a subscription to the topic, <code>coffeeshop/order/details/v1/*/ca/&gt;</code> that replies to requests with a payload containing a status and orderId. <code>{ status: 'Accepted', orderID: '12738' }</code>.  Enter the following command:</li>
      <pre>stm reply --topic "coffeeshop/order/new/v1/*/ca/&gt;" --client-name "Order Management" --message "{status: 'Accepted', orderId: '12738'}"</pre>
      <p>You should see the following result:</p>
      <pre>ℹ  info      info: loading 'reply' command from configuration 'stm-cli-config.json'
…  waiting   connecting to broker [ws://localhost:8008, vpn: default, username: default, password: ******]
ℹ  info      info: client name: Order Management
✔  success   success: === Order Management successfully connected and ready to subscribe to request topic. ===
ℹ  info      info: subscribing to coffeeshop/order/new/v1/*/ca/&gt;
ℹ  info      info: press Ctrl-C to exit
✔  success   success: successfully subscribed to request topic: coffeeshop/order/new/v1/*/ca/&gt;
…  waiting   === ready to receive requests. ===</pre>
      <li>In terminal 2, set up the <b>Third-Party App</b> to send a request message with the topic, <code>coffeeshop/order/new/v1/mobile/ca/437/4334</code>. The application waits for a default time of 10 seconds to receive a reply before generating a time-out error.</li>
      <pre>stm request --topic "coffeeshop/order/new/v1/mobile/ca/437/4334" --client-name "Third Party App" --file order.json</pre>
      <p>You should see the following result:</p>
      <pre>ℹ  info      info: loading 'request' command from configuration 'stm-cli-config.json'
…  waiting   connecting to broker [ws://localhost:8008, vpn: default, username: default, password: ******]
ℹ  info      info: client name: Third Party App
✔  success   success: === Third Party App successfully connected and ready to send requests. ===
…  waiting   requesting...
✔  success   success: request sent on topic coffeeshop/order/new/v1/mobile/ca/437/4334
ℹ  info      info: Message Properties
Destination:                            [Topic coffeeshop/order/new/v1/mobile/ca/437/4334]
Class Of Service:                       COS1
DeliveryMode:                           DIRECT
ℹ  info      info: Message Payload (bytes): 659
✔  success   success: reply Received - [Topic coffeeshop/order/new/v1/mobile/ca/437/4334], type - TEXT
ℹ  info      info: Message Properties
Destination:                            [Topic #P2P/v:solbroker/mPuoLl8m/3rd Party App/_]
CorrelationId:                          #REQ1
Class Of Service:                       COS1
DeliveryMode:                           DIRECT
Reply Message
Binary Attachment:                      len=41
ℹ  info      info: Message Payload (bytes): 38
✔  success   success: disconnecting from Solace PubSub+ Event Broker...
✔  success   success: disconnected.
✔  success   success: exiting...</pre>
      <p><b>Third Party App</b> sends a request message to <b>Order Management</b> with a new order. <b>Order Management</b> replies to the request with a message of <code>{ status: 'Accepted', orderID: '12738' }</code>.</p>
      <li>Press Control+C (on Windows and Linux) or Command+C (on Mac), to stop the applications.
            </li>
    </ol>
    <h2 class="with-rule">Tutorial Steps</h2>
    <p>You've completed the fifth step in the tutorial. Click <MadCap:xref href="../Next-steps.htm">Next Steps</MadCap:xref> for suggestions to continue your Solace journey.</p>
    <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/Table_Num.css');border-left-style: solid;border-left-width: 1px;border-left-color: #e1e1e1;border-right-style: solid;border-right-width: 1px;border-right-color: #e1e1e1;border-top-style: solid;border-top-width: 1px;border-top-color: #e1e1e1;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #e1e1e1;margin-left: 0;margin-right: auto;" class="TableStyle-Table_Num" cellspacing="0">
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <thead>
        <tr class="TableStyle-Table_Num-Head-Header1">
          <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Step</th>
          <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="text-align: center;">
              <img src="../../Resources/Images/Cloud/reusable-icons/num1.png" alt="Step 1"/>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="font-weight: bold;">Set up Your First Event Broker - Complete</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="text-align: center;">
              <img src="../../Resources/Images/Cloud/reusable-icons/num2.png" alt="Step 2"/>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="font-weight: bold;">Solace EDA Basics - Complete</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="text-align: center;">
              <img src="../../Resources/Images/Cloud/reusable-icons/num3.png" alt="Step 3"/>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="font-weight: bold;">Set up the  <MadCap:variable name="Product-Names.try-me-cli"/> Tool - Complete</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyE-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="text-align: center;">
              <img src="../../Resources/Images/Cloud/reusable-icons/num4.png" alt="Step 4"/>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyD-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="font-weight: bold;">Try a Publish-Subscribe Message Exchange Pattern - Complete</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p style="text-align: center;">
              <img src="../../Resources/Images/Cloud/reusable-icons/num5.png" alt="Step 5"/>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p style="font-weight: bold;">Try a Request-Reply Message Exchange Pattern - Complete</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p style="text-align: center;">
              <img src="../../Resources/Images/Cloud/reusable-icons/num6.png" alt="Step 6"/>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p style="font-weight: bold;">Explore Consumer Scaling Patterns   - <a href="consumer-scaling-pattern.htm" class="link-internal">Next Lesson</a></p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyB-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="text-align: center;">
              <img src="../../Resources/Images/Cloud/reusable-icons/complete.png" alt=""/>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyA-Column1-Body1" style="background-color: #F7F8F9;">
            <p style="font-weight: bold;">Next Steps</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p>You can return to the main <a href="../Getting-Started-Try-Broker.htm" class="link-internal">Tutorial page</a> at any time.</p>
  </body>
</html>
