<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>Tuning Link Performance for WANs</h1>
    <p>Typically, links that are configured between Solace PubSub+ appliances—both for VPN bridge connections, and neighbor links for multiple-node routing—have performance parameters set by default through Command Line Interface (CLI) configuration commands that are ideal for connectivity over a Local Area Network (LAN) or high-speed Metropolitan Area Network (MAN).</p>
    <p>However, when deploying event brokers in a Wide Area Network (WAN), where long message round-trip times and high latencies are typical, Solace recommends tuning VPN bridge and neighbor link parameters to improve link performance over WANs. This is done using the following CLI command configuration options.</p>
    <p>The CLI command configuration options available for tuning either VPN bridge or neighbor link parameters to improve link performance over a WAN include:</p>
    <ul>
      <li><b>Enable Data Compression</b>—Enabling compression saves precious bytes on narrow WAN pipes, allowing a higher message rate over the WAN link.
        <p>To epitomize bandwidth use over a WAN, chose the <code>compressed-data</code> option when setting up:</p><ul><li>VPN bridge connections</li><li>multiple-node routing links between neighboring event brokers</li></ul><p>See <MadCap:xref href="../Features/MNR/Managing-Multi-Node-Routing-Links.htm">Managing Multi-Node Routing Links</MadCap:xref> and <MadCap:xref href="../Features/VPN/Configuring-VPN-Bridges.htm#Config-Remote-VPNs">Configuring Remote Message VPNs</MadCap:xref>, respectively, for command details on the <code>compressed-data</code> options.</p></li>
      <li><b>Configure Maximum TCP Window Sizes</b>—If the TCP maximum window size is set to less than the bandwidth-delay product of the bridge link, then the TCP connection operates below its maximum potential throughput. If the maximum window is set to less than about twice the bandwidth-delay product of the bridge link, then occasional packet loss will cause the TCP connection to operate below its maximum potential throughput as it handles the missing acknowledgments and retransmissions.<p>However, there are also problems with a TCP maximum window size that is set too large, so it is important to set this value appropriately for bridge connections. The ideal setting for the TCP maximum window size is approximately twice the bandwidth-delay product of the bridge link.</p><p>Therefore, duly configure the TCP maximum window size for the event broker that receives the inbound bridge connection, on the client profile assigned to the client username being used for that inbound bridge connection.</p><p>See <MadCap:xref href="../Services/Configuring-TCP-Settings.htm#Config-max-wdw">Configuring TCP Max Window Sizes</MadCap:xref> for command details.</p></li>
    </ul>
    <h2 class="with-rule"><a name="Bridging-Only"/>VPN Bridging-Specific Tuning Options</h2>
    <p>To improve link performance over a WAN include, you also perform the following tasks for tuning VPN bridge link parameters:</p>
    <ul>
      <li><b>Set Higher Guaranteed Messaging Window Sizes</b>—To maximize Guaranteed Messaging throughput over a WAN link, it is often necessary to increase the window size for Guaranteed messages to compensate for the long round-trip times over the WAN. The window size indicates how many outstanding Guaranteed messages can be sent over the Message VPN bridge  connection to the remote event broker, before an acknowledgment must be received by the sending event broker.
                <p>However, configuring an excessively large message spool window size on low-latency VPN bridge links can negatively impact network performance. Contact Solace for technical support before changing this parameter, as they can assist you in choosing the appropriate value for your network conditions.</p><p>See <MadCap:xref href="../Features/VPN/Configuring-VPN-Bridges.htm#Config-Msg-Window">Configuring Message Spool Window Sizes</MadCap:xref> for command details.</p></li>
      <li><b>Configure Client Egress Queues’ Message Bursts Levels</b>—To prevent transport congestion discards in an event broker, the egress per-client priority G-1 (Guaranteed 1) queue on the Message VPN bridge connection must always be able to accept a burst of messages as large as the Guaranteed Messaging window size.
                <p>Therefore, duly configure for the event broker that receives the inbound bridge connection, on the client profile assigned to the client username being used for that inbound bridge connection, the minimum number of messages that must be on the egress G-1 queue before the queue’s depth is checked against the maximum depth setting (thereby allowing the queue to absorb a burst of large messages that exceeds the number of allowed work units).</p><p>See <MadCap:xref href="../Messaging/Managing-Event-Delivery-Resources.htm#managing_msg_delivery_resources_2491525118_201457">Configuring Egress Queue Minimum Message Bursts</MadCap:xref> for command details.</p></li>
      <li><b>Configure Explicit Remote Topic Subscriptions</b>—Any topic subscriptions configured against a bridge link cause published messages matching that topic to be sent over the bridge link, even though there may not be any consumers for the message on the receiving event broker. Therefore, avoid wide-reaching wildcard subscriptions on bridge connections. Instead, use more explicit subscriptions that attract only the traffic that needs to be transported over the WAN. While this recommendation is good advice for any bridge link, it is especially important for WAN links, where bandwidth is at a premium.<p>See <MadCap:xref href="../Features/VPN/Configuring-VPN-Bridges.htm#remote-topic-sub">Configuring Remote Subscription Topics</MadCap:xref> for command details.</p></li>
    </ul>
    <h2 class="with-rule"><a name="MNR-Only"/>Multi-Node Routing-Specific Tuning Options </h2>
    <p>The following configuration practices may be used for tuning neighbor link parameters to improve link performance over a WAN.</p>
    <ul>
      <li><b>Limiting Subscription Exports</b>—
        To reduce bandwidth usage by the routing protocols, and ensure that messages are never sent to clients who should not be receiving messages from remote publishers, only enable the subscription export policy on those Message VPNs which need network-wide visibility. Leave all other Message VPNs at the default  setting of not export subscriptions.<p>Set the subscription export policy for a given Message VPN the same for all event brokers in the network.</p><p>See <MadCap:xref href="../Features/VPN/Configuring-VPNs.htm#Enable-Sub-Export">Enabling Subscription Exporting</MadCap:xref> for command details.</p></li>
    </ul>
  </body>
</html>
