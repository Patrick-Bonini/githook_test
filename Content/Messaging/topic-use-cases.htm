<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head>
    <link href="../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
  </head>
  <body>
    <h1><MadCap:concept term="Cloud;Appliance;Software"/>Topic Architecture Case Studies</h1>
    <p>The following case studies show how to apply topic architecture best practices:</p>
    <ul>
      <li>
        <MadCap:xref href="#use-case-event-sourcing">Case Study 1: Event-Driven Microservices, Choreography, and Event Sourcing</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#event-driven-asapio">Case Study 2: Event-Driven Integration with ASAPIO</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#use-case-iot">Case Study 3: IoT Devices—Command, Control, and Analytics</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#topic-bp-middle-office">Case Study 4: Data Ingestion and Distribution</MadCap:xref>
      </li>
    </ul>
    <h2><a name="use-case-event-sourcing"/>Case Study 1: Event-Driven Microservices, Choreography, and Event Sourcing</h2>
    <p>Implementing microservices breaks monolithic applications (services) into smaller, more manageable components (microservices). Making microservices event-driven makes them more efficient, performant, scalable, and robust.</p>
    <p>Two key attributes of event-driven microservices are:</p>
    <ul>
      <li><b>Choreography</b>, where microservices react to changes in their environment, in contrast to the orchestration approach, where the system relies on either tight linkages between microservices or a central orchestrator that, although it drives microservice interactions, is the main bottleneck that prevents scaling.</li>
      <li><b>Event sourcing</b> allows microservices to function and recover without needing atomic transactions for large units of work by capturing the system’s state within events rather than storing it in databases. You can achieve consistency in your system by replaying specific events, rather than managing the state of tightly-coupled services.</li>
    </ul>
    <p MadCap:conditions="SAP.SapHideFromOutput">To learn more about using event-driven microservices, see:</p>
    <ul MadCap:conditions="SAP.SapHideFromOutput">
      <li>
        <a href="https://solace.com/solutions/initiative/microservices/" target="_blank" class="link-offsite">Event-Driven Microservices</a>
      </li>
      <li>
        <a href="https://solace.com/blog/event-driven-microservices/" target="_blank" class="link-offsite">The Architect’s Guide to Event-Driven Microservices</a>
      </li>
    </ul>
    <p MadCap:conditions="SAP.SapHideFromOutput">To see an example of how to design a topic hierarchy for event-driven microservices, let's look at the "Sol-Beer" example in the <a href="https://solace.com/blog/messaging-patterns-for-event-driven-microservices/" target="_blank" class="link-offsite">Messaging Patterns for Event-Driven Microservices</a> blog post.</p>
    <p><MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">As the blog explains, the</MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="SAP.SapOnlyOutput">The</MadCap:conditionalText> removal of the point-to-point chaining of services has created a scenario very similar to the Middle Office example in the <a href="#topic-bp-middle-office" class="link-internal">Data Ingestion and Distribution case study</a>. Not only are all of the applications or services acting on the same event, but they also drive toward eventual consistency. The difference is that there could be follow-up events generated by services that gate, or otherwise affect other services. For example, the billing process may need to complete before the delivery vehicle can be dispatched. The following diagram shows the interrelationships between different topic domains, where some events can be processed independently but others are blocked. In our example, although you can't dispatch a delivery vehicle until after the billing clears, you can notify the delivery vehicles that there is an order being processed in their area.</p>
    <p>
      <img src="../Resources/Images/Topic-Architecture/messaging-patterns-event-driven-microservices.png" alt="Diagram showing the concepts described in the surrounding text."/>
    </p>
    <p>Let's see how a well-defined topic architecture enables both the flow of events through this system and the flexibility to expand the data set. Originally, the system delivered beer by car, but as business grows, the company could add other products, such as Scotch whiskey, or add new delivery modes such as delivery from a drone, so they need to plan for business growth.</p>
    <h3><a name="build-topic-root"/>Building the Topic Root</h3>
    <p>In this system, customer-generated events are injected into the event mesh by the Sol-Beer WebApp. A customer places an order and then wants to  be informed about updates to the status of their order, but they don't need details about logistics or inventory levels.</p>
    <p>We can start from the event topic template, <code><span class="topicdomain">Domain</span>/<span class="topicnoun">ObjectType</span>/<span class="topicverb">Verb</span>/<span class="topicproperty">Version</span>/<span class="topicproperty">Properties</span></code>. First, focusing on the event topic root, our application domain is Sol-Beer’s online store, so <code><span class="topicnoun">store</span></code> is appropriate as the <code>Domain</code>. One of the main functions of the store is to accept orders, so <code>order</code> may be an <code>ObjectType</code>. Within an order, a few actions are possible, including:  <code>created</code>, <code>updated</code>, and <code>canceled</code>. Because this is the first version of the store, the version is <code>v1</code>.Based on these elements, we have the following root topics:</p>
    <ul>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">order</span>/<span class="topicverb">created</span>/<span class="topicproperty">v1</span></code>
      </li>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">order</span>/<span class="topicverb">updated</span>/<span class="topicproperty">v1</span></code>
      </li>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">order</span>/<span class="topicverb">canceled</span>/<span class="topicproperty">v1</span></code>
      </li>
    </ul>
    <h3><a name="add-topci-properties"/>Adding Topic Properties</h3>
    <p>After building a topic root, you can consider various properties for each individual Object/Action combination. Potential properties that may be useful in this application include:</p>
    <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
      <col style="width: 20%;" class="TableStyle-Table_Num-Column-Column1"/>
      <col style="width: 80%;" class="TableStyle-Table_Num-Column-Column1"/>
      <thead>
        <tr class="TableStyle-Table_Num-Head-Header1">
          <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Property</th>
          <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>
                <span class="topicproperty">{productGroup}</span>
              </code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>A value based on an enumeration of possible product group types (beer, scotch, and so on). This property may be useful for actions taken on specific product groups, such as marketing actions on a certain group of products.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>
                <span class="topicproperty">{area}</span>
              </code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>The general region that an inventory manager is responsible for. This property may be useful for servicing multiple regions as delivery vehicles may only be interested in the orders in their region.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>
                <span class="topicproperty">{productID}</span>
              </code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>The specific item that is ordered (dark beer, light beer, ten-year old scotch, and so on). This property may be useful for actions taken on specific products, for example a promotion on one certain product.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
            <p>
              <span class="topicproperty">{customerID}</span>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
            <p>The customer identifier. This property may be useful for access control, because customers may only be able to place orders for their own ID.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
            <p>
              <code>
                <span class="topicproperty">{orderID}</span>
              </code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
            <p>The unique order identifier. This property may be useful to allow a customer to receive updates for a specific order.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p>Each new property is included when there is a routing, filtering, or access control use case. Each property should be ordered in the topic roughly by cardinality. In this example, there are more customers than there are products, and there are many more possible order IDs than there are customers. This leads to the following, complete topic: </p>
    <p>
      <code><span class="topicdomain">store</span>/<span class="topicnoun">order</span>/<span class="topicverb">created</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">{productGroup}</span>/<span class="topicproperty">{area}</span>/<span class="topicproperty">{productID}</span>/<span class="topicproperty">{customerID}</span>/<span class="topicproperty">{orderID}</span></code>
    </p>
    <p>You can take a similar approach for the updated and canceled actions.</p>
    <p>This topic taxonomy leads to many potential subscriber use cases. For example, the inventory management system may be set up to handle only specific regions. An inventory manager responsible for distribution in the Ottawa area would subscribe to the following topic:</p>
    <p>
      <code><span class="topicdomain">store</span>/<span class="topicnoun">order</span>/<span class="topicverb">created</span>/<span class="topicproperty">v1</span>/*/<span class="topicproperty">ottawa</span>/&gt;</code>
    </p>
    <p>Note the use of wildcards in the previous example indicates that the subscriber wants to receive messages with all possible values for that property. Here, the inventory manager is interested in orders for every product category (<code>productCategory</code>), so they use a wildcard (<code>*</code>) in the subscription to include all values.</p>
    <h3><a name="expand-catagory"/>Expanding the Event Catalog</h3>
    <p>In addition to processing orders, the Sol-Beer store processes payments and fulfills orders by local delivery. These events can be added to the catalog with similar topic roots as in the previous sample topics. For example:</p>
    <ul>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">billing</span>/<span class="topicverb">paid</span>/<span class="topicproperty">v1</span></code>
      </li>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">billing</span>/<span class="topicverb">nofunds</span>/<span class="topicproperty">v1</span></code>
      </li>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">delivery</span>/<span class="topicverb">enroute</span>/<span class="topicproperty">v1</span></code>
      </li>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">delivery</span>/<span class="topicverb">delivered</span>/<span class="topicproperty">v1</span></code>
      </li>
    </ul>
    <p>If all events in the order, delivery, and billing process carry through the <code>customerID</code> and <code>orderID</code>, the process allows tracing and message replay for a single order or customer. This functionality is key for event sourcing. For example, when the billing events contain the <code>customerID</code> and <code>orderID</code>, you can trace the billing events back to order events. The resulting billing topics in the event catalog would be:</p>
    <ul>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">billing</span>/<span class="topicverb">paid</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">{productGroup}</span>/<span class="topicproperty">{area}</span>/<span class="topicproperty">{deliveryMode}</span>/<span class="topicproperty">{productID}</span>/<span class="topicproperty">{customerID}</span>/<span class="topicproperty">{orderID}</span></code>
      </li>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">billing</span>/<span class="topicverb">nofunds</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">{productGroup}</span>/<span class="topicproperty">{area}</span>/<span class="topicproperty">{deliveryMode}</span>/<span class="topicproperty">{productID}</span>/<span class="topicproperty">{customerID}</span>/<span class="topicproperty">{orderID}</span></code>
      </li>
    </ul>
    <p>where the properties may look like:</p>
    <p>
      <code><span class="topicproperty">beer</span>/<span class="topicproperty">ottawa</span>/<span class="topicproperty">drone</span>/<span class="topicproperty">product456</span>/<span class="topicproperty">cust4321</span>/<span class="topicproperty">order12345</span></code>
    </p>
    <p>This rich topic taxonomy allows for many different use cases. For example, the inventory manager and the delivery vehicle that need to know when the billing has cleared for beer orders would subscribe to:</p>
    <p>
      <code><span class="topicdomain">store</span>/<span class="topicnoun">billing</span>/<span class="topicverb">enroute</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">beer</span>/<span class="topicproperty">ottawa</span>/<span class="topicproperty">drone</span>/<span class="topicproperty">product456</span>/<span class="topicproperty">customer4321</span>/<span class="topicproperty">order12345</span>&gt;</code>
    </p>
    <p>After the beer purchase has been authorized and the driver or drone assigned, the customer can track their delivery with live updates using delivery events. Some properties that may be helpful to include in the topic hierarchy are:</p>
    <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <thead>
        <tr class="TableStyle-Table_Num-Head-Header1">
          <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Property</th>
          <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>
                <span class="topicproperty">{vehicleType}</span>
              </code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>A value from an enumeration of vehicle type, such as a  car, drone, and so on.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>
                <span class="topicproperty">{latitude}</span>
              </code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>The latitude of the delivery vehicle position.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>
                <span class="topicproperty">{longitude}</span>
              </code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>The longitude of the delivery vehicle position.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
            <p>
              <code>
                <span class="topicproperty">{vehicleID}</span>
              </code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
            <p>The delivery vehicle identifier.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p>The resulting event catalog entries would be:</p>
    <ul>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">delivery</span>/<span class="topicverb">enroute</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">{vehicleType}</span>/<span class="topicproperty">{vehicleID}</span>/<span class="topicproperty">{customerID}</span>/<span class="topicproperty">{orderID}</span>/<span class="topicproperty">{latitude}</span>/<span class="topicproperty">{longitude}</span></code>
      </li>
      <li>
        <code><span class="topicdomain">store</span>/<span class="topicnoun">delivery</span>/<span class="topicverb">dispatched</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">{vehicleType}</span>/<span class="topicproperty">{vehicleID}</span>/<span class="topicproperty">{customerID}</span>/<span class="topicproperty">{orderID}</span></code>
      </li>
    </ul>
    <p>The event topic properties may look like this:</p>
    <p>
      <code><span class="topicdomain">store</span>/<span class="topicnoun">delivery</span>/<span class="topicverb">enroute</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">car</span>/<span class="topicproperty">vehicle4321</span>/<span class="topicproperty">order12345</span>/<span class="topicproperty">cust4321</span>/<span class="topicproperty">45.421532</span>/<span class="topicproperty">-75.697189</span></code>
    </p>
    <p>Some possible subscriptions for this event include:</p>
    <ul>
      <li>
        <p>a customer tracking the delivery of all of their orders could subscribe to:</p>
        <p>
          <code><span class="topicdomain">store</span>/<span class="topicnoun">delivery</span>/<span class="topicverb">enroute</span>/<span class="topicproperty">v1</span>/*/*/<span class="topicproperty">cust4321</span>/&gt;</code>
        </p>
      </li>
      <li>
        <p>A fleet manager tracking all their vehicles, regardless of type or current order, within a geographical area might subscribe to:</p>
        <p>
          <code><span class="topicdomain">store</span>/<span class="topicnoun">delivery</span>/<span class="topicverb">enroute</span>/<span class="topicproperty">v1</span>/*/*/*/*/<span class="topicproperty">45</span>*/<span class="topicproperty">-75</span>*</code>
        </p>
      </li>
    </ul>
    <p>Flexible subscriptions allow events to be reused in new ways as necessary. For example, if new regulations required commercial drones to be tracked and reported to the city, a reporting agent could subscribe to the geographical area that it is responsible for:</p>
    <p>
      <code><span class="topicdomain">store</span>/<span class="topicnoun">delivery</span>/<span class="topicverb">enroute</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">drone</span>/*/*/*/<span class="topicproperty">45</span>*/<span class="topicproperty">-75</span>*</code>
    </p>
    <p>
      <h2 class="with-rule"><a name="event-driven-asapio"/>Case Study 2: Event-Driven Integration with ASAPIO</h2>
      <p>In this example, we'll event-enable SAP with ASAPIO . This is an example of event driven integration, where the data transformation capabilities of an iPaaS is combined with the real-time dynamic choreography of an event broker and event mesh. As shown in the diagram below, when a new purchase order is created in an SAP system, ASAPIO can push an event notification out to an event mesh in <MadCap:variable name="Product-Names.pubsub_brand_only"/>, which streams that notification out to multiple interested applications (on-premises and in the cloud), such as applications used for billing, manufacturing and support. The value of this use case is that instead of each downstream application polling the system of record for changes, the system of record emits one event per change and all subscribing downstream applications have the ability to consume the event. This architecture reduces the workload on the system of record.</p>
      <p MadCap:conditions="SAP.SapHideFromOutput">For more information about this SAP-specific system of record use case, see <a href="https://solace.com/asapio/" target="_blank" class="link-offsite"><MadCap:variable name="Variables.CompanyName"/> with ASAPIO</a>.</p>
      <p>
        <img src="../Resources/Images/Topic-Architecture/solace-asapio-architecture.png" alt=""/>
      </p>
      <p>With ASAPIO, there can be different encodings (JSON, XML, etc.) of the same event. Because there can be only one event schema per event,  we need to treat each encoding as a separate event. In this case, we include a <code>HandlingInstruction</code> property in the event root. We also move the <code>HandlingInstruction</code> property before the version property so that if just a single encoding changes, we can version just the one event. The result is the following event topic template:</p>
      <p>
        <code><span class="topicdomain">Domain</span>/<span class="topicnoun">ObjectType</span>/<span class="topicverb">Verb</span>/<span class="topicproperty">HandlingInstruction</span>/<span class="topicproperty">Version</span>/<span class="topicproperty">Locality</span>/<span class="topicproperty">SourceId</span>/<span class="topicproperty">ObjectId</span></code>
      </p>
      <p>Let's see how a well-defined topic architecture helps data flow through this complex system.</p>
      <p>In this use case, an event is emitted each time certain business objects (BO) change in the SAP system.</p>
      <p>The events flowing from SAP to downstream applications have one of three different object types or <i>aspects</i>, each with progressively more information, which is controlled through ACLs. These aspects are described in the following table:</p>
      <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
        <col class="TableStyle-Table_Num-Column-Column1"/>
        <col class="TableStyle-Table_Num-Column-Column1"/>
        <thead>
          <tr class="TableStyle-Table_Num-Head-Header1">
            <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Aspect</th>
            <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>sap-bo-event</code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A notification that a particular business object has been created or updated. The topic and payload contain enough information for an application or user to retrieve the business object according to their SAP access rights.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>sap-bo-metadata</code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>Contains the information from <code>sap-bo-event</code> plus the IDs of the fields that have been updated. This allows an application to further filter by fields they are interested in before retrieving the business object.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
              <p>
                <code>sap-bo-data</code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
              <p>Contains the information from <code>sap-bo-event</code> plus the actual fields and the changed values. This allows an authorized application to instantly get the changes with their values.</p>
            </td>
          </tr>
        </tbody>
      </table>
      <p>For these SAP events the topic template would be:</p>
      <p>
        <code><span class="topicdomain">sap</span>/<span class="topicnoun">{resourceType}</span>/<span class="topicverb">{action}</span>/<span class="topicproperty">{representation}</span>/<span class="topicproperty">{version}</span>/<span class="topicproperty">{aspect}</span>/<span class="topicproperty">{siteID}</span>/<span class="topicproperty">{orgID}</span>/<span class="topicproperty">{systemID}</span>/<span class="topicproperty">{resourceID}</span></code>
      </p>
      <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
        <col class="TableStyle-Table_Num-Column-Column1" style="width: 175px;"/>
        <col class="TableStyle-Table_Num-Column-Column1"/>
        <thead>
          <tr class="TableStyle-Table_Num-Head-Header1">
            <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Item</th>
            <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicdomain">{sap}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A literal value specifying that these are SAP-originating events.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicnoun">{resourceType}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The business object type that the notification applies to. For example,<code><span class="topicdomain">BUS2032</span></code> is a sales order.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicverb">{action}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p> A value from an enumeration of actions, for example create or update.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{representation}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
              <p>The encoding of the event (e.g., XML, JSON).</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{version}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The version of the event.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{aspect}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of object types <code>sap-bo-event</code>, <code>sap-bo-metadata</code>, or <code>sap-bo-data</code>.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{siteID}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The <code>siteID</code>, <code>plantID</code>, or <code>locationID </code>where this BO is owned, where GLOBAL indicates a global entity, and EMPTY indicates that there is no siteID associated with the notification.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{orgID}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
              <p>The organization unit that owns the business object, where GLOBAL indicates a global entity, and EMPTY indicates that there is no orgID associated with the notification</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{systemID}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The SAP instance or system ID.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{resourceID}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
              <p>The business object ID.</p>
            </td>
          </tr>
        </tbody>
      </table>
      <p>The event catalog entries, which are derived from the event topic root, would look like:</p>
      <ul>
        <li>
          <code><span class="topicdomain">sap</span>/<span class="topicnoun">BUS2032</span>/<span class="topicverb">create</span>/<span class="topicproperty">JSON</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">sap</span>/<span class="topicnoun">BUS2032</span>/<span class="topicverb">update</span>/<code><span class="topicproperty">JSON</span>/<span class="topicproperty">v1</span></code></code>
        </li>
      </ul>
      <p>To see how this event topic root is used, consider the following event:</p>
      <p>
        <code><span class="topicdomain">sap</span>/<span class="topicnoun">BUS2032</span>/<span class="topicverb">update</span>/<code><span class="topicproperty">JSON</span>/<span class="topicproperty">v1</span></code>/<span class="topicproperty">sap-bo-data</span>/<span class="topicproperty">empty</span>/<span class="topicproperty">1000</span>/<span class="topicproperty">ERD100</span>/<span class="topicproperty">0000096852</span></code>
      </p>
      <p>As we read through the fields in the topic hierarchy, we see the following information:</p>
      <ul>
        <li>SAP event</li>
        <li>Business Object: BUS2032 (sales order)</li>
        <li>It's an update to a business object</li>
        <li>Encoded in JSON</li>
        <li>API version: 1</li>
        <li>Aspect: sap-bo-data (contains actual data)</li>
        <li>Site ID: none</li>
        <li>Organization ID: 1000</li>
        <li>SAP instance: ERD100</li>
        <li>Business Object ID: 96852</li>
      </ul>
      <p>A downstream application that wants to receive all sales order updates with their data from organization 1000 could subscribe to:</p>
      <p>
        <code><span class="topicdomain">sap</span>/<span class="topicnoun">BUS2032</span>/<span class="topicverb">update</span>/<span class="topicproperty">JSON</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">sap-bo-data</span>/*/<span class="topicproperty">1000</span>/&gt;</code>
      </p>
      <p>Note that this application would need the appropriate access permissions (via an administratively applied ACL) to allow it to subscribe to <code><span class="topicproperty">sap-bo-data</span></code> events from organization 1000.</p>
      <p>A downstream application that wants to receive all sales order updates (event only) from any SAP instance, any organization, at any site, could subscribe to:</p>
      <p>
        <code><span class="topicdomain">sap</span>/<span class="topicnoun">BUS2032</span>/*/<span class="topicproperty">JSON</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">sap-bo-event</span>/&gt;</code>
      </p>
      <p>Again, this application would need to have the appropriate access permissions to allow it to receive notification events of new sales orders.</p>
      <h2 class="with-rule"><a name="use-case-iot"/>Case Study 3: IoT Devices—Command, Control, and Analytics</h2>
      <p>Internet of Things (IoT) use cases traditionally involve data movement exclusively from field sensors into backend state capture or analytics systems. The initial goals created simple systems that could horizontally scale to handle millions of devices. IoT uses cases have evolved as the numbers and complexity of the devices have evolved. Security is now mandatory, and command and control of end devices is much more common within these systems. The events coming from IoT sensors are now counted on for more than simple statistics. They now also drive changes in upstream systems. Some critical sensor events might require human interactions, and it is important that the events are accurate and valid. For example, consider an air-bag deployment event on a mobile vehicle and the consequences if these events are spoofed or ignored. There are now also many use cases where IoT sensors receive data from backend systems, for example,  connected vehicles receiving weather and traffic updates.</p>
      <p>Modern industrial IoT use cases integrate a large number of components into a unified system. To effectively organize and route data across these systems, a unified namespace (UNS) is needed. A UNS is a single source of truth for the real-time state of an enterprise. It allows all components within the enterprise to communicate bidirectionally in a standard way. An event mesh provides this functionality, and a well-defined topic hierarchy is key to standardizing communication, particularly by making data identifiable across all components in the system. For instance, an event published from an IoT device may be consumed by a number of backend systems, from data lakes to analytics engines. Event topics must be well constructed to be useful in these backend systems and prevent data lakes from turning into data swamps. In particular, a device ID should be included in the topic properties so that all events for a particular device can be monitored in real time through the event mesh and viewed historically in backend systems. Including the device ID in topics also allows you to secure the data through<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"><a href="../Security/Granting-Clients-Access.htm" target="_blank" class="link-internal">ACL substitution expressions</a></MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="SAP.SapOnlyOutput"> ACL substitution expressions</MadCap:conditionalText>.</p>
      <p>
        <img src="../Resources/Images/Topic-Architecture/iot-diagram.png" style="max-width: 80%;" alt=""/>
      </p>
      <p MadCap:conditions="SAP.SapHideFromOutput">To learn more about the connected car use case, see the Solace <a href="https://solace.com/solutions/initiative/internet-of-things/" target="_blank" class="link-offsite">IoT Event Mesh article</a>.</p>
      <p>Let's see how a well-defined topic architecture helps authorize and route events from remote device to backend systems, and how backend systems can control remote devices.</p>
      <h3><a name="device-to-backend"/>Device to Backend Services</h3>
      <p>Events emitted by edge IoT devices consist mainly of sensor data.</p>
      <p>Starting with the topic event template of <code>Domain/ObjectType/Verb/Version/Properties</code>, we have a topic template of</p>
      <p>
        <code>fromVehicle/<span class="topicnoun">{vehicleComponent}</span>/<span class="topicverb">{action}</span>/<span class="topicproperty">{version}</span>/<span class="topicproperty">{severity}</span>/<span class="topicproperty">{username}</span>/<span class="topicproperty">{sensorID}</span></code>
      </p>
      <p>Using <code>fromVehicle</code> as the domain indicates that the information in the topic is coming from the sensors. The domain may need to include additional information if multiple vehicle generations are hosted on the same event mesh, for example,<code> myCar/myGeneration/fromVehicle</code>.</p>
      <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
        <col class="TableStyle-Table_Num-Column-Column1" style="width: 185px;"/>
        <col class="TableStyle-Table_Num-Column-Column1"/>
        <thead>
          <tr class="TableStyle-Table_Num-Head-Header1">
            <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Property</th>
            <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>
                <span class="topicdomain">fromVehicle</span>
              </code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A literal value specifying that these are events from the vehicle.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicnoun">{vehicleComponent}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The name of the controllers or apps within the vehicle (e.g.,TCU and MCU).</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicverb">{action}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of sensor actions (e.g., reset, update, and failure). Different vehicle components may have different actions.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{version}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
              <p>The version number for this release of <code>fromVehicle</code>.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{username}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of severity (e.g., error, warning, and info).</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{sensorID}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
              <p>The unique sensor that produced the event.</p>
            </td>
          </tr>
        </tbody>
      </table>
      <p>The event catalog entries derived from the event topic root, would look like:</p>
      <ul>
        <li>
          <code><span class="topicdomain">fromVehicle</span>/<span class="topicnoun">tcu</span>/<span class="topicverb">reset</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">fromVehicle</span>/<span class="topicnoun">tcu</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">fromVehicle</span>/<span class="topicnoun">tcu</span>/<span class="topicverb">failure</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">fromVehicle</span>/<span class="topicnoun">mcu</span>/<span class="topicverb">reset</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">fromVehicle</span>/<span class="topicnoun">mcu</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span></code>
        </li>
      </ul>
      <p>The properties of the topics provide more metadata for routing and filtering. For example, the location of the vehicle might affect event routing and the severity of the event might affect the number of applications interested in the event. Each topic should also include the sensor ID because it is crucial for access control restrictions to ensure that data from other sensors can't be spoofed.</p>
      <p>Let's say a vehicle has an accident and its airbag deploys. The vehicle might emit an event with topic:</p>
      <p>
        <code><span class="topicdomain">fromVehicle</span>/<span class="topicnoun">tcu</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">critical</span>/<span class="topicproperty">vin4321</span>/<span class="topicproperty">airbag</span></code>
      </p>
      <p>There could be an application listening to all critical severity events:</p>
      <p>
        <code><span class="topicdomain">fromVehicle</span>/*/<span class="topicverb">update</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">critical</span>/&gt;</code>
      </p>
      <p>In many cases, IoT devices are not in a secure location and can be subject to physical or software hacking. For this reason, the device must be authenticated on every connection, and the authenticated ID must be included and validated with each message to ensure the device only sends authorized events. This is the reason the MQTT username field is so important in this type of environment—it prevents one IoT device from pretending to be another IoT device.</p>
      <p>For example, verifying the username would prevent a hacked vehicle with username <code>vin4321</code> from sending an event as <code>vin1234</code>. The following update from username <code>vin4321</code> would be allowed:</p>
      <p>
        <code><span class="topicdomain">fromVehicle</span>/tcu/update/v1/critical/vin4321/airbag</code>
      </p>
      <p>However, the following update from username <code>vin4321 </code>would not be allowed:</p>
      <p>
        <code><span class="topicdomain">fromVehicle</span>/tcu/update/v1/critical/vin1234/airbag</code>
      </p>
      <h3><a name="backend-services"/>Backend Services to Device</h3>
      <p>The data sent from backend applications to vehicles could consist of multicast messages to several vehicles or unicast messages to a specific vehicle. Multicast messages could be based on location, on-board application, vehicle type, or other criteria. For unicast messages, the username ensures that only the intended vehicle receives the update.</p>
      <p>Consider a topic template of:</p>
      <p>
        <code><span class="topicdomain">toVehicle</span>/<span class="topicnoun">{vehicleComponent}</span>/<span class="topicverb">{action}</span>/<span class="topicproperty">{version}</span>/<span class="topicproperty">{location}</span>/<span class="topicproperty">{clientID}</span>/<span class="topicproperty">{sensorID}</span></code>
      </p>
      <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
        <col class="TableStyle-Table_Num-Column-Column1" style="width: 185px;"/>
        <col class="TableStyle-Table_Num-Column-Column1"/>
        <thead>
          <tr class="TableStyle-Table_Num-Head-Header1">
            <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Field</th>
            <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>
                <span class="topicdomain">toVehicle</span>
              </code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A literal value specifying that these are events sent to the vehicle.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicnoun">{vehicleComponent}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of the controllers or apps, for example TCU, MCU, and so on. An MCU could act as multiplexor to downstream subcomponents.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicverb">{action}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of actions (possibly dependent on the vehicle component).</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{version}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
              <p>The version number for this release of orders.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{location}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The Multicast area, group, or null.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{username}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The username or device identifier used to validate whether the sender is authorized to produce the event.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{endpointID}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
              <p>The identifier of the specific sub-component or app that should receive the control message.</p>
            </td>
          </tr>
        </tbody>
      </table>
      <p>The event catalog entries, which are derived from the event topic root, would look like:</p>
      <ul>
        <li>
          <code><span class="topicdomain">toVehicle</span>/<span class="topicnoun">tcu</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span></code>
        </li>
      </ul>
      <ul>
        <li>
          <code><span class="topicdomain">toVehicle</span>/<span class="topicnoun">mcu</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span></code>
        </li>
      </ul>
      <p>To differentiate multicast events that are available to all vehicles,  an <code>allVehicles</code> application domain could be used:</p>
      <ul>
        <li>
          <code><span class="topicdomain">allVehicles</span>/<span class="topicnoun">weather</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span></code>
        </li>
      </ul>
      <ul>
        <li>
          <code><span class="topicdomain">allVehicles</span>/<span class="topicnoun">traffic</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span></code>
        </li>
      </ul>
      <p>The properties of the topics would provide more information for routing, filtering, and access control.</p>
      <p>A vehicle would subscribe to all events directed specifically to it:</p>
      <p>
        <code><span class="topicdomain">toVehicle</span>/*/*/<span class="topicproperty">v1</span>/*/<span class="topicproperty">vin4321</span>/&gt;</code>
      </p>
      <p>The vehicle could also subscribe to weather updates in its region:</p>
      <p>
        <code><span class="topicdomain">allVehicles</span>/<span class="topicnoun">weather</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">ottawa</span>/<span class="topicproperty">weatherPlan4321</span>/&gt;</code>
      </p>
      <p>And it could subscribe to traffic updates for the current road and direction:</p>
      <p>
        <code><span class="topicdomain">allVehicles</span>/<span class="topicnoun">traffic</span>/<span class="topicverb">update</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">417east</span>/<span class="topicproperty">trafficPlan4321</span>/&gt;</code>
      </p>
      <p>As previously mentioned, the username is used to access policies and filtering. For example, the vehicle may only be allowed to subscribe to <code>toVehicle</code> domain updates where its VIN is included in the topic, preventing it from accessing information for other vehicles, whereas it may be allowed to consume any <code>allVehicle</code> updates.<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> For a detailed discussion about access control in IoT applications, see <a href="https://solace.com/blog/iot-security-acl-substitution-variables/" target="_blank" class="link-offsite">Improving IoT Security with Access Control List Substitution Variables</a>.</MadCap:conditionalText></p>
      <h2><a name="topic-bp-middle-office"/>Case Study 4: Data Ingestion and Distribution</h2>
      <p>In this example, we look at data sources throughout an enterprise that write data into distributed data stores. These data sources could be published transaction logs from a database, online purchases, market data orders, and so on.</p>
      <p>The following diagram illustrates an example of market data orders and post trade data, where the trade itself takes place in the Front Office and the post-trade activity takes place in the Middle Office. Here we can see that the client gateways produce events for the Front Office and the trading platform is the producer of events that flow to the Middle Office systems. We can also see the Middle Office is not a single-purpose consumer application, but a series of applications that each have specific tasks and data requirements.</p>
      <p>
        <img src="../Resources/Images/Topic-Architecture/middle-office-shock-absorber.png" alt=""/>
      </p>
      <p MadCap:conditions="SAP.SapHideFromOutput">For additional details about this use case, see <a href="https://solace.com/blog/investment-banking-middle-office-shock-absorber/" target="_blank" class="link-offsite">Investment Banking and the Middle Office Shock Absorber</a>.</p>
      <p>Without a properly designed event topic architecture that allows event re-use, you might have a very expensive trading platform publishing the same event multiple times in multiple formats to satisfy each Middle Office need.</p>
      <p>We start with the standard topic event template of <code><span class="topicdomain">Domain</span>/<span class="topicnoun">ObjectType</span>/<span class="topicverb">Verb</span>/<span class="topicproperty">Version</span>/<span class="topicproperty">Properties</span></code>.</p>
      <p>Let's see how a well-defined topic architecture helps data flow throughout this complex system.</p>
      <h3><a name="front-office"/>Front Office</h3>
      <p>The message exchange pattern in this phase of the interaction consists of a simple command message. As shown in the diagram above, the data flow for the Front Office system, works like this:</p>
      <ol>
        <li>A <b>Client</b> registers an intent to buy or sell a product with a <b>Client Gateway</b>.</li>
        <li> The <b>Client Gateway</b> turns this request into a <b>Client Order</b> and sends it to a <b>Trading Platform</b> system.</li>
        <li>The <b>Trading Platform</b> system determines the appropriate <b>Exchange</b> to use, and places the <b>Market Order</b>.</li>
        <li>The <b>Exchange</b> fulfills the <b>Market Order</b> and sends confirmation back to the <b>Trading Platform</b> system.</li>
        <li>On receipt of a <b>Fill</b> event from the <b>Exchange</b>, the <b>Trading Platform</b> notifies the <b>Client</b> (via the <b>Client Gateway</b>) that its order has been filled.</li>
      </ol>
      <p>For the Front Office, the topic template for client orders would be:</p>
      <p>
        <code><span class="topicdomain">orders</span>/<span class="topicnoun">{productGroup}</span>/<span class="topicverb">{action}</span>/<span class="topicproperty">{version}</span>/<span class="topicproperty">{market}</span>/<span class="topicproperty">{source}</span>/<span class="topicproperty">{product}</span></code>
      </p>
      <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
        <col style="width: 155px;" class="TableStyle-Table_Num-Column-Column1"/>
        <col style="width: 80%;" class="TableStyle-Table_Num-Column-Column1"/>
        <thead>
          <tr class="TableStyle-Table_Num-Head-Header1">
            <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Item</th>
            <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicdomain">orders</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The literal value specifying the topic describes the total of all orders events.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicnoun">{productGroup}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of possible product groups.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicverb">{action}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of order actions (e.g.,  <code>new</code>, <code>update</code>, and <code>cancel</code>).</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{version}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
              <p>The version number for this release of <code>orders</code></p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{market}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>General region or group of markets for which the trading platform is responsible.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{source}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The customer identifier.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{product}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
              <p>The specific item being ordered.</p>
            </td>
          </tr>
        </tbody>
      </table>
      <p>The event catalog entries, which are derived from the event topic root, would look like:</p>
      <ul>
        <li>
          <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/<span class="topicproperty">new</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/<span class="topicproperty">update</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/<span class="topicproperty">cancel</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">orders</span>/<span class="topicnoun">bond</span>/<span class="topicproperty">new</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">orders</span>/<span class="topicnoun">bond</span>/<span class="topicproperty">update</span>/<span class="topicproperty">v1</span></code>
        </li>
        <li>
          <code><span class="topicdomain">orders</span>/<span class="topicnoun">bond</span>/<span class="topicproperty">cancel</span>/<span class="topicproperty">v1</span></code>
        </li>
      </ul>
      <p>The event topic properties might look like:</p>
      <p>
        <code><span class="topicdomain">orders</span>/<span class="topicnoun">bond</span>/<span class="topicproperty">cancel</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/<span class="topicproperty">pri1</span>/<span class="topicproperty">customer1</span>/<span class="topicproperty">appl</span></code>
      </p>
      <p>Monitoring apps could track individual customers using the following subscription:</p>
      <p>
        <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/*/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/<span class="topicproperty">custID4321</span>/&gt;</code>
      </p>
      <p>Actions like cancellations could be monitored to flag unusual activity using the following subscription:</p>
      <p>
        <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/<span class="topicproperty">cancel</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/&gt;</code>
      </p>
      <h3><a name="horizontal-scale"/>Horizontal Scaling</h3>
      <p>A single application may not be able to keep up with large amounts of data. Horizontal scaling of consumers can be accomplished in many ways, such as nonexclusive queues or partitioned queues (see <MadCap:xref href="Guaranteed-Msg/Partitioned-Queue-Messaging.htm">Message Distribution With Partitioned Queues)</MadCap:xref>. However, if the load is too much for a single event broker to handle, the data may need to be sharded across multiple event brokers in the event mesh using topic partitions.</p>
      <p>In this use case, the properties of the topics provide more information for routing and filtering. The Smart Order Routers (SORs) could be sharded based on these properties and each process subsets of the products. This structure allows for horizontal scaling across multiple event brokers within the event mesh.</p>
      <p>In this example, the SORs split the traffic, first by <code>productGroup</code> and then at lower levels to handle shards or the product space.</p>
      <p>The first SOR instance could have the following subscriptions:</p>
      <p>
        <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/*/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/*/a*/&gt;</code>
      </p>
      <p>...</p>
      <p>
        <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/*/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/*/m*/&gt;</code>
      </p>
      <p>And the second instance could have the following subscriptions:</p>
      <p>
        <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/*/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/*/n*/&gt;</code>
      </p>
      <p>...</p>
      <p>
        <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/*/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/*/z*/&gt;</code>
      </p>
      <h4>Using Subscription Exceptions for Horizontal Scaling</h4>
      <p>Consider an expected high-volume event, such as an IPO for ACME Rideshare (ACME), where a large volume of trades on one specific symbol is expected for a limited period of time. To handle this situation, you could deploy a dedicated event broker to handle only the ACME Rideshare trade events, with an SOR instance subscribing to <code><span class="topicdomain">orders</span>/<span class="topicnoun">equity</span>/*/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/*/acme/&gt;</code>.</p>
      <p>To ensure that no ACME Rideshare events are propagated to other SOR instances, the SOR instance that handles the equities starting with "a" could add a negative subscription of <code>!/<span class="topicnoun">equity</span>/*/<span class="topicproperty">v1</span>/<span class="topicproperty">NA</span>/*/acme/&gt;</code>, allowing for dedicated handling of ACME orders by the other SOR instance.</p>
      <h3><a name="middle-office"/>Middle Office</h3>
      <p>After the Trading Platform system has completed a trade, it sends an event message into the Middle Office system. The Middle Office system includes several systems that must have a consistent view of the trades that happen, but where each needs specific data to perform its tasks. Because this is a separate domain, the SORs would publish to a topic under the transaction domain. The event includes the specific Exchange the trade should occur on, for example:</p>
      <p>
        <code><span class="topicdomain">transaction</span>/<span class="topicnoun">equity</span>/<span class="topicverb">new</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">NYSE</span>/<span class="topicproperty">traderID1234</span>/<span class="topicproperty">Order4321</span></code>
      </p>
      <p>The Middle Office exchange gateways would subscribe to the exchanges and pools they service, for example:</p>
      <p>
        <code><span class="topicdomain">transaction</span>/<span class="topicnoun">equity</span>/<span class="topicverb">new</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">NYSE</span>/&gt;</code>
      </p>
      <p>The full topic taxonomy of the Middle Office system would be:</p>
      <p>
        <code><span class="topicdomain">transaction</span>/<span class="topicnoun">{productGroup}</span>/<span class="topicverb">{action}</span>/<span class="topicproperty">{version}</span>/<span class="topicproperty">{venue}</span>/<span class="topicproperty">{source}</span>/<span class="topicproperty">{orderID}</span></code>
      </p>
      <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Table_Num.css');" class="TableStyle-Table_Num" cellspacing="0">
        <col style="width: 20%;" class="TableStyle-Table_Num-Column-Column1"/>
        <col style="width: 80%;" class="TableStyle-Table_Num-Column-Column1"/>
        <thead>
          <tr class="TableStyle-Table_Num-Head-Header1">
            <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Item</th>
            <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code><span class="topicdomain">transaction</span><![CDATA[
]]></code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The literal value specifying the topic describes the total of all orders events.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicnoun">{productGroup}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of possible product group types.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p><code><span class="topicverb">{action}</span></code><![CDATA[ 

]]></p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of transaction actions such as <code>new</code>, <code>updated</code>, <code>filled</code>, <code>canceled</code>.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{version}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
              <p>The version number for this release of <code>transaction</code>.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{venue}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>A value from an enumeration of the liquidity pools or exchanges where transactions can occur.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
              <code>
                <span class="topicproperty">{source}</span>
              </code>
            </td>
            <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
              <p>The customer identifier.</p>
            </td>
          </tr>
          <tr class="TableStyle-Table_Num-Body-Body1">
            <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
              <p>
                <code>
                  <span class="topicproperty">{orderID}</span>
                </code>
              </p>
            </td>
            <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
              <p>The identifier for the unique product order.</p>
            </td>
          </tr>
        </tbody>
      </table>
      <p>In this example, you could imagine that applications like Settlements and Risk systems would be interested only in successfully completed transactions, whereas a Reporting system may require access to every transaction including canceled ones, and Trade Data Capture system might consume both every order event and every transaction event, for either the entire set of data or again sharded by product type, region, venue, or product.</p>
      <p>For example, for the event:</p>
      <p>
        <code><span class="topicdomain">transaction</span>/<span class="topicnoun">equity</span>/<span class="topicverb">new</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">NYSE</span>/<span class="topicproperty">traderID1234</span>/<span class="topicproperty">Order4321</span></code>
      </p>
      <p>The Settlements system may subscribe to:</p>
      <p>
        <code><span class="topicdomain">transaction</span>/<span class="topicnoun">equity</span>/<span class="topicverb">filled</span>/<span class="topicproperty">v1</span>/&gt;</code>
      </p>
      <p>or:</p>
      <p>
        <code><span class="topicdomain">transaction</span>/<span class="topicnoun">equity</span>/<span class="topicverb">filled</span>/<span class="topicproperty">v1</span>/<span class="topicproperty">NYSE</span>/&gt;</code>
      </p>
      <p>While the Risk system might subscribe to the following topic to monitor the positions of a particular trader:</p>
      <p>
        <code><span class="topicdomain">transaction</span>/<span class="topicnoun">equity</span>/*/<span class="topicproperty">v1</span>/*/<span class="topicproperty">traderID1234</span>/&gt;</code>
      </p>
    </p>
  </body>
</html>
