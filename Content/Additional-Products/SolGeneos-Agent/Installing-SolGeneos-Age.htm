<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body><h1>Installing &amp; Upgrading Solace Geneos Agent</h1><p>This section describes how to install a Solace Geneos Agent on an event broker. The procedure can also be used to upgrade the version of a Solace Geneos Agent that is already installed on an event broker.</p><h2 class="with-rule"><a name="Prerequi"/>Prerequisites</h2><u>Solace PubSub+ appliances</u>:<ul><li>Perform the installation as root, with root user’s environment, on the target appliance.</li><li>As of appliance release <MadCap:variable name="Variables.Appliance Release Version"/>, operations below that state they can only be performed by root, can now also be performed by a Sysadmin User. For information on configuring Sysadmin Users, refer to <MadCap:xref href="../../Admin/Configuring-Multiple-Shell-Users.htm">Configuring Multiple Linux Shell Users</MadCap:xref>.</li><li>Stop any running instances of Solace Geneos Agent on the target appliance.</li><li>If SolGeneos is not currently using the pre-installed Java Runtime Environment (JRE) and is not using a JRE version 1.8 or newer, refer to <MadCap:xref href="#Updating">Updating a Java Runtime Environment</MadCap:xref>.</li></ul><u>Solace PubSub+ software event brokers</u>:<ul><li>Perform the installation and running of Solace Geneos, the JRE, and NetProbe  on the Linux host shell as the root user, which is accessible on ssh port 22 (port 2222 for software event broker releases prior to 8.5.0) as the <code>sysadmin</code> user.</li><li>For a default installation, create the <code>/usr/sw</code> directory if it does not exist.</li><li> This prerequisite applies to Solace PubSub+ software event broker 9.4.0 or higher only. As part of the Solace Geneos Agent upgrade and installation, <code>umask</code> must be set to 0022. For software event broker Machine image, permission settings must be configured to provide Solace Geneos Agent access to read the <code>system.log</code> file. See, <MadCap:xref href="#Preparin">Preparing Software Event Broker for Solace Geneos Agent Installation </MadCap:xref>for more information.</li><li>If SolGeneos is not currently using a JRE version 1.8 or newer,  refer to <MadCap:xref href="#Updating">Updating a Java Runtime Environment</MadCap:xref>.</li></ul><h2 class="with-rule"><a name="Updating"/>Updating a Java Runtime Environment</h2><p>For Solace PubSub+ appliances version 9.5.0 and older, if the JRE version used by SolGeneos is older than 1.8, perform the following steps as the root user to start using the pre-installed JRE:</p><ol><li><p> Remove the <code>/usr/sw/java</code> softlink.</p><p class="Code">rm -rf /usr/sw/java</p></li><li><p>Create a <code>/usr/sw/java</code> softlink to the pre-installed JRE.</p><p>Solace PubSub+ appliances version 9.0.1.7 and older:</p><p class="Code">ln -s /usr/java/latest /usr/sw/java </p><p>Solace PubSub+ appliances version 9.0.1.30 and newer:</p><p class="Code">ln -s /etc/alternatives/jre_1.8.0_openjdk /usr/sw/java</p></li></ol><p>For the software event broker, perform only step 1 above and continue to <MadCap:xref href="#Installi">Installing a Java Runtime Environment (JRE)</MadCap:xref>. </p><h2 class="with-rule"><a name="Installi"/>Installing a Java Runtime Environment</h2><p>A JRE is pre-installed on appliances, so installing a JRE is not required. For the software event broker, you should use JRE  1.8 or later.</p><p>The following example shows you how to install JRE on the software event broker. The example assumes JRE 1.8 is to be installed.</p><ol><li>Download the JRE  Linux archive file from <a href="http://www.oracle.com/technetwork/java/javase/downloads/">here</a>  and place it under the directory <code>/usr/sw</code>.</li><li>Change the permission of the file you downloaded to be executable.</li><li>Run the self-extracting binary from <code>/usr/sw</code>. For example:</li><p class="Code">tar -xzf ./jre-8u60-linux-i586.tar.gz</p><li>The JRE will be extracted under <code>/usr/sw/jre1.8.0_60</code>.</li><li>Create a <code>/usr/sw/java</code> softlink to the directory where JRE is installed:</li><p class="Code">ln -s /usr/sw/jre1.8.0_60 /usr/sw/java</p></ol><h2 class="with-rule"><a name="Preparin"/>Preparing Software Event Broker for Solace Geneos Agent Installation </h2><p>When installing or upgrading Solace Geneos Agent on PubSub+ software event broker 9.4.0 release or higher, <code>umask</code> must be set to 0022. By default, only the container user has read and write access to software event broker Docker container files. This permission setup works as long as no other processes require read access to those files. However, Solace Geneos Agent require read access to the software event broker's log files for log aggregation.</p><p>For the software event broker Docker image, you can set the<code> umask=0022</code> during container creation. If you are doing an instance replacement, you can use <code>cloud-init</code> to configure the <code>umask</code>. For software event broker Machine image, you will need to perform few additional steps described below.</p><p>To prepare your software event broker Machine image for Solace Geneos Agent installation, perform the following steps on the Linux Host shell:</p><ol><li>
               Disable the Solace PubSub+ service.
</li><p class="Code">solacectl service stop</p><li>Remove the Solace PubSub+ software message broker Docker container. </li><p class="Code">docker rm solace</p><li>In <code>solace-container.env.conf</code> file located in <code>/etc/solace/solace-container.env.conf</code>, add <code>umask=0022</code>.</li><li>Find host path to <code>jail </code>volume by running the<code> docker volume inspect jail</code> command. In the next step, we will use the host path to <code>jail</code> volume to set permissions for Solace Geneos Agent to access the <code>system.log</code> file.

<br/>				In the example below, the host path to the <code>jail</code> volumes are the <code>Mountpoint</code> and <code>device</code>directories.	If you have the <code>device</code> directory configured, use that as the host path to <code>jail</code> volume. If you don't have the <code>device</code> directory configured then use the<code> Mountpoint</code> directory.</li><p class="Code">docker volume inspect jail<br/>[<br/>      {<br/>            "CreatedAt": "2019-10-23T14:11:49Z",<br/>            "Driver": "local",<br/>            "Labels": {},<br/>            "Mountpoint": "/var/lib/docker/volumes/jail/_data",<br/>            "Name": "jail",<br/>            "Options": {<br/>            "device": "/mnt/vmr/jail",<br/>            "o": "bind",<br/>            "type": "none"<br/>            },<br/>            "Scope": "local"cons<br/>      }<br/>]</p><li>Run the following <code>chmod</code> command to update permissions for Solace Geneos Agent to access the software message broker's <code>system.log</code> file.</li><p class="Code">chmod -R u+rwX,go+rX &lt;host path of jail volume&gt;</p><li>
                Re-enable the Solace PubSub+ service.
                
            </li><p class="Code">solacectl service enable</p><li>
                Restart the Solace PubSub+ application.
                
              
            </li><p class="Code">solacectl service start</p></ol><p>You can now start the <a href="#Procedur" class="link-internal">procedure</a> to install and upgrade Solace Geneos Agent on your software event broker Machine image.</p><h2 class="with-rule"><a name="Procedur2"/>Procedure</h2><p>To install or upgrade a Solace Geneos Agent in PubSub+ software event broker, do the following:</p><ol><li>Copy <code>sol-geneosagent-&lt;version&gt;.tar.gz</code> to <code>/usr/sw</code> and extract it in the same directory.
                <p>If successful, a new directory <code>solgeneos</code> is created under <code>/usr/sw</code>. </p></li><li>Change directory to <code>/usr/sw/solgeneos/loads/solgeneos_&lt;version&gt;/bin</code>, and enter the following command to run the installation script:
                <p class="SWResultLineNHSCode"><code>./setup.sh install</code></p><p>Before the installation begins, the installation script stops and removes any existing Solace Geneos Agent service. The script will also add a <code>SysV</code> or <code>systemd</code> service definition compatible with the current Solace PubSub+ version.</p></li><li>If the installation script detects that the configuration directory is empty (which could be the case when upgrading from a version of Solace Geneos Agent earlier than 5.5.1), it provides an option to convert to the new configuration. In this case, when prompted to enter Managed Entity name, input the Managed Entity that has been configured on the NetProbe.
        <p>When the installation has successfully completed, a completion message displays at the command prompt.</p></li></ol></body>
</html>
