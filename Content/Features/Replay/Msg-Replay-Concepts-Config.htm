<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head>
    <link href="../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
    <link href="../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
    <script type="text/javascript" async="1" src="https://play.vidyard.com/embed/v4.js">
        </script>
  </head>
  <body>
    <h1>Message Replay Configuration</h1>
    <p>Message replay allows published Guaranteed messages, and Direct messages promoted to Guaranteed, that were not rejected to the publisher to be stored in a replay log. Storage of the messages occurs for an indefinite period after being received in case they need to be replayed at some later date. </p>
    <p>You can initiate replay log playback for an endpoint from either the event broker, or from clients who have at least consume privileges for the endpoint. The latter  causes a filtered subset of the logged messages to be sent to those clients.</p>
    <p MadCap:conditions="SAP.SapHideFromOutput">For more information about message replay, see:</p>
    <ul MadCap:conditions="SAP.SapHideFromOutput">
      <li>
        <MadCap:xref href="#Engineer">Deployment Notes</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Terminol">Terminology</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Types">Types of Replay Requests</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Life">Lifecycle of a Replayable Message</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Replayin">Replaying to an Endpoint</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Replay-States">Replay States</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Trimming">Trimming the Replay Log</MadCap:xref>
      </li>
      <li>
        <MadCap:xref href="#Direct">Direct Messages and Message Replay</MadCap:xref>
      </li>
    </ul>
    <p MadCap:conditions="SAP.SapHideFromOutput">For instructions for using  <MadCap:variable name="Product-Names.solace_cli"/> commands to configure and manage message replay, see:</p>
    <ul>
      <li MadCap:conditions="SAP.SapHideFromOutput">
        <MadCap:xref href="Msg-Replay-Config.htm">Configuring Message Replay</MadCap:xref>
      </li>
      <li MadCap:conditions="SAP.SapHideFromOutput">
        <MadCap:xref href="Msg-Replay-Playback.htm">Playing Back a Replay Log</MadCap:xref>
      </li>
      <li MadCap:conditions="SAP.SapHideFromOutput">
        <MadCap:xref href="Msg-Replay-Monitoring.htm">Monitoring Message Replay</MadCap:xref>
      </li>
    </ul>
    <p MadCap:conditions="SAP.SapHideFromOutput">For instructions to set up and use message replay in <MadCap:variable name="Product-Names.pubsubmanager_short"/>, see <MadCap:xref href="../../Cloud/Broker-Manager/configuring-message-replay.htm">Configuring Message Replay</MadCap:xref>.</p>
    <h4 MadCap:conditions="SAP.SapHideFromOutput">Next Steps</h4>
    <p MadCap:conditions="SAP.SapHideFromOutput">From here there are a few different paths you can take depending on what you want to learn:</p>
    <ul MadCap:conditions="SAP.SapHideFromOutput">
      <li>Take a look at some simple examples showing how to configure and use message replay with Solace CLI in the section <MadCap:xref href="Msg-Replay-Examples.htm">Message Replay Examples</MadCap:xref>.</li>
      <li>See the details of how to use each message replay <MadCap:variable name="Product-Names.solace_cli"/> command in these sections.</li>
      <ul>
        <li>
          <MadCap:xref href="Msg-Replay-Config.htm">Configuring Message Replay</MadCap:xref>
        </li>
        <li>
          <MadCap:xref href="Msg-Replay-Playback.htm">Playing Back a Replay Log</MadCap:xref>
        </li>
      </ul>
      <li>
        <p>Review the <a href="https://tutorials.solace.dev/jcsmp/message-replay/" target="_blank" class="link-offsite">Solace Message Replay with JCSMP tutorial</a> that shows you how a client can initiate and process a replay, and there's guidance on how a client can initiate <MadCap:xref href="../../API/API-Developer-Guide/Replay-from-Replay-Log.htm">Replaying from the Replay Log</MadCap:xref>.</p>
      </li>
      <li><a href="Msg-Replay-Video.htm#Video:" class="link-internal">Watch a video</a> that shows you how to get message replay up and running with <MadCap:variable name="Product-Names.pubsubmanager_long"/>.
			</li>
    </ul>
    <h2 class="with-rule" MadCap:conditions="SAP.SapHideFromOutput"><a name="Engineer"/>Deployment Notes</h2>
    <h3 MadCap:conditions="SAP.SapHideFromOutput"><a name="Supporte"/>Supported <MadCap:variable name="Product-Names.pubsub_brand_only"/> Products</h3>
    <p MadCap:conditions="SAP.SapHideFromOutput">Message replay is supported on the following <MadCap:variable name="Variables.CompanyName"/> <MadCap:variable name="Product-Names.pubsub_brand_only"/> products:</p>
    <ul MadCap:conditions="SAP.SapHideFromOutput">
      <li><MadCap:variable name="Variables.CompanyName"/><MadCap:variable name="Product-Names.pubsub_brand_only"/> 3530 and 3560 <MadCap:variable name="Product-Names.broker_appliance_short"/>s</li>
      <li><MadCap:variable name="Product-Names.pubsub_brand_only"/><MadCap:variable name="Product-Names.broker_sw_short"/>s</li>
      <li><MadCap:variable name="Product-Names.cloud_product_long"/> (Controlled Availability)</li>
    </ul>
    <h3><a name="Deployme"/>Advisories and Considerations When Using Message Replay</h3>
    <MadCap:snippetBlock src="../../Resources/Snippets/Features/Replay/replay-usage-advisories-considerations.flsnp"/>
    <h2 class="with-rule"><a name="Terminol"/>Terminology</h2>
    <MadCap:snippetBlock src="../../Resources/Snippets/Features/Replay/terminology.flsnp"/>
    <h2 class="with-rule"><a name="Types"/>Types of Replay Requests</h2>
    <MadCap:snippetBlock src="../../Resources/Snippets/Features/Replay/types-of-replay-requests.flsnp"/>
    <h2 class="with-rule"><a name="Life"/>Lifecycle of a Replayable Message</h2>
    <p>Let's walk though the lifecycle of a replayable message. A couple of points to keep in mind is that the lifecycle is the same for all <MadCap:xref href="#Types">Types of Replay Requests</MadCap:xref>, and in each of the following lifecycle phases the <u>underlined passages</u> correspond to terms in the <MadCap:xref href="#Terminol">Terminology</MadCap:xref> section.</p>
    <ol>
      <li>A <u>live message</u> is received on a Message VPN that has message replay enabled. This message is considered to be a <u>replayable message</u>.
			</li>
      <li>The message is successfully spooled to all its non-replaying destinations, gets added to the replay log, and is now considered to be a <u>logged message</u>.
		<![CDATA[            ]]></li>
      <li>
				At some time later the event broker receives a replay request with a start time that includes the <u>logged message</u>. Once the replay gets to the <u>logged message</u>, and successfully performs <u>replay to endpoint</u>, it's considered a <u>replayed message</u>.
			<ul><li>A more detailed discussion of the replay process is presented in <MadCap:xref href="#Replayin">Replaying to an Endpoint.</MadCap:xref></li><li>Instructions on how to initiate a replay with <MadCap:variable name="Product-Names.solace_cli"/> are shown in <MadCap:xref href="Msg-Replay-Playback.htm#start-re">start-replay</MadCap:xref>.</li></ul></li>
      <li>Finally, the <u>replayed message</u> is delivered to a consumer and is acknowledged, which removes it from the replaying endpoint; however, it's still in the replay log until it gets trimmed.
			<ul><li>For a little more discussion on automatic and manual replay log trimming, refer to <MadCap:xref href="#Trimming">Trimming the Replay Log</MadCap:xref>.</li><li>Instructions on how to manually initiate a replay log trimming with <MadCap:variable name="Product-Names.solace_cli"/> can be found in <MadCap:xref href="Msg-Replay-Playback.htm#trim-log">trim-logged-messages</MadCap:xref>.</li></ul></li>
    </ol>
    <h2 class="with-rule"><a name="Replayin"/>Replaying to an Endpoint</h2>
    <MadCap:snippetBlock src="../../Resources/Snippets/Features/Replay/replay-to-an-endpoint.flsnp"/>
    <h2 class="with-rule"><a name="Replay-States"/>Replay States</h2>
    <MadCap:snippetBlock src="../../Resources/Snippets/Features/replay-states.flsnp"/>
    <h2 class="with-rule"><a name="Trimming"/>Trimming the Replay Log</h2>
    <p>As the replay log grows larger and reaches the configured capacity, older logged messages are deleted to make room for new ones. This process is called replay log <i>trimming</i>. The event broker automatically performs trimming when the replay log exceeds 90% of its configured quota<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> for <code>max-spool-usage</code></MadCap:conditionalText>. <MadCap:conditionalText MadCap:conditions="Default.HideFromAllOutput">Trimming is performed in batches so the amount trimmed is based on the number of messages, size of messages, and the size of the replay log.</MadCap:conditionalText> </p>
    <p>It is possible for an endpoint to contain and successfully deliver replayed messages that were trimmed from the replay log. This is because if at least one other endpoint contains the message, the message is still considered spooled.</p>
    <p MadCap:conditions="SAP.SapHideFromOutput">You can also choose to manually trim the replay log using the <a href="Msg-Replay-Examples.htm#Trim" class="link-internal"><code>trim-logged-messages</code></a> command in addition to automatic trimming as part of your trimming strategy. </p>
    <p class="Note">Because trimming occurs in batches and is triggered based on factors, such as the  size of the replay log (configured quota), and the number and size of the messages, trimming may not immediately occur when the replay log is over 90% of its configured quota<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> for <code>max-spool-usage</code></MadCap:conditionalText>. For example, if the configured quota for the replay log is very small (such as less than 1000 MB), the target of 90% may not be perfectly maintained.</p>
    <h4><a name="trim-not-fast"/>Impacts of Slow Trimming</h4>
    <MadCap:snippetBlock src="../../Resources/Snippets/Features/Replay/impacts-of-slow-trimming.flsnp"/>
    <h4><a name="example-of-trimming"/>Determining a Log Trimming Strategy</h4>
    <MadCap:snippetBlock src="../../Resources/Snippets/Features/Replay/determine-log-trimming-strategy.flsnp"/>
    <h2 class="with-rule"><a name="Direct"/>Direct Messages and Message Replay</h2>
    <MadCap:snippetBlock src="../../Resources/Snippets/Features/Replay/direct-msg-and-replay.flsnp"/>
  </body>
</html>
