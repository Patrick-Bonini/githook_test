<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head>
    <link href="../../Resources/TableStyles/Table_Num.css" rel="stylesheet" MadCap:stylesheetType="table"/>
  </head>
  <body>
    <h1>Monitoring Message Replay</h1>
    <p><MadCap:variable name="Variables.CompanyName"/> recommends that you monitor the replay log to ensure that the replay log  does not exceed 90% of its configured quota<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> for <code>max-spool-usage</code></MadCap:conditionalText>.
            When message replay is configured correctly, the event broker automatically trims the oldest messages from the replay log to make room for new messages as they arrive. After you configure message replay, <MadCap:variable name="Variables.CompanyName"/> recommends that you monitor the replay log's configured quota<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> for <code>max-spool-usage</code></MadCap:conditionalText>.</p>
    <p>While monitoring, if you find that your replay log consistently exceeds 90% of its  configured quota<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> for <code>max-spool-usage</code></MadCap:conditionalText>, it indicates that ingress traffic to the replay log occurs faster than the event broker can perform trimming. In this situation, <MadCap:variable name="Variables.CompanyName"/> recommends that you  investigate<MadCap:conditionalText MadCap:conditions="SAP.SAPTempHide">. For more information, see <MadCap:xref href="Msg-Replay-Concepts-Config.htm#trim-not-fast">Impacts of Slow Trimming</MadCap:xref>.</MadCap:conditionalText></p>
    <p>To resolve this issue, you may need to take one or more of the following:</p>
    <ul>
      <li>Reduce the number of incoming messages to the replay log. For example, you may want to subscribe to fewer topics or use topic filtering on your replay log.<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> For more information, see <MadCap:xref href="Msg-Replay-Config.htm#topic-filters">Configuring the Messages Stored to the Message Replay Log Using Topic Filters</MadCap:xref> and <MadCap:xref href="../../Admin/Broker-Manager/configuring-message-replay.htm">Configuring Message Replay</MadCap:xref>.</MadCap:conditionalText> <MadCap:conditionalText MadCap:conditions="SAP.SapOnlyOutput">For more information, see <MadCap:xref href="../../Cloud/Broker-Manager/configuring-message-replay.htm">Configuring Message Replay</MadCap:xref>.</MadCap:conditionalText></li>
      <li>Increase the replay log's configured quota for <code>max-spool-usage</code>. <MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">For more information, see <MadCap:xref href="Msg-Replay-Config.htm#calc-replay-log-size">Determining the Required Value for max-spool-usage</MadCap:xref>.</MadCap:conditionalText> <MadCap:conditionalText MadCap:conditions="SAP.SapOnlyOutput">For more information, see <MadCap:xref href="../../Cloud/Broker-Manager/configuring-message-replay.htm">Configuring Message Replay</MadCap:xref>.</MadCap:conditionalText></li>
      <li>If trimming is occurring too slowly, <MadCap:variable name="Variables.CompanyName"/> recommends that you evaluate and adjust your log trimming strategy. <MadCap:conditionalText MadCap:conditions="SAP.SAPTempHide">For more information, see <MadCap:xref href="Msg-Replay-Concepts-Config.htm#example-of-trimming">Determining a Log Trimming Strategy</MadCap:xref>.</MadCap:conditionalText></li>
    </ul>
    <p> If you notice that there are <i>bursts</i> of messages, <MadCap:variable name="Variables.CompanyName"/> recommends that you characterize the burst pattern and then adjust the replay log size to absorb it. The latter can result in adequate time for the event broker to performing trimming. Contact <MadCap:variable name="Variables.CompanyName"/> if you require further assistance.</p>
    <p MadCap:conditions="SAP.SapHideFromOutput">See the following topics to understand how you can monitor message replay to ensure that it operates as expected:</p>
    <ul MadCap:conditions="SAP.SapHideFromOutput">
      <li>Any replay failures that may occur, see <MadCap:xref href="#Applicab">Applicable show Commands</MadCap:xref>.</li>
      <li>About the Queues for storing message replay logs, see <MadCap:xref href="#Queues">Queues</MadCap:xref>.</li>
      <li>Checking the state of message replay, see <MadCap:xref href="#">Monitoring Message Replay</MadCap:xref>.</li>
      <li>Example of how to calculate the usage , see <MadCap:xref href="#example-calculate-usage">Monitoring Usage of a Replay Log</MadCap:xref>.</li>
    </ul>
    <h2 class="with-rule" MadCap:conditions="SAP.SapHideFromOutput"><a name="Applicab"/>Applicable <code>show</code> Commands</h2>
    <p MadCap:conditions="SAP.SapHideFromOutput">You can use the follow commands to monitor message replay.</p>
    <p MadCap:conditions="SAP.SapHideFromOutput">The following table lists <MadCap:variable name="Product-Names.solace_cli"/> <code>show</code> commands that can be useful in monitoring message replay.</p>
    <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/Table_Num.css');margin-left: 0;margin-right: auto;" class="TableStyle-Table_Num" cellspacing="0" MadCap:conditions="SAP.SapHideFromOutput">
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <col class="TableStyle-Table_Num-Column-Column1"/>
      <thead>
        <tr class="TableStyle-Table_Num-Head-Header1">
          <th class="TableStyle-Table_Num-HeadE-Column1-Header1">Command</th>
          <th class="TableStyle-Table_Num-HeadD-Column1-Header1">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>show replay-log</code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p> Shows the number of messages logged, the space consumed by those messages, the value set for <code>max-spool-usage</code>, and the ingress and egress states. Details are shown in <MadCap:xref href="#show">show replay-log</MadCap:xref>.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>show queue &lt;replay-queue-name&gt; replay-state all</code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>Shows all queues in a user-specified replay-state for the queues for replay log queues. See <MadCap:xref href="#Queues">Understanding the  Message Replay Queues</MadCap:xref>.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <code>show queue &lt;replay-queue-name&gt; replay</code>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>Shows the replay state, last replayed message time, last replay start time, last replay complete time, last replay failure time, and last replay failure reason.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
            <code>show queue &lt;replay-queue-name&gt; stats</code>
          </td>
          <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
            <p>Shows the number of replays initiated, replays succeeded, replays failed, messages replayed, and replayed messages ACKed.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <p>
              <code>show topic-endpoint &lt;endpoint-name&gt; replay-state</code>
              <code>&lt;state&gt;</code>
            </p>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>Shows all topic-endpoints in a user specified replay-state.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <code>show topic-endpoint &lt;endpoint-name&gt; replay</code>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>Shows replay state, last replayed message time, last replay start time, last replay complete time, last replay failure time, and last replay failure reason.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
            <code>show topic-endpoint &lt;endpoint-name&gt; stats</code>
          </td>
          <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
            <p>Shows the number of replays initiated, replays succeeded, replays failed, messages replayed, and replayed messages ACKed.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyE-Column1-Body1">
            <code>show message-spool stats</code>
          </td>
          <td class="TableStyle-Table_Num-BodyD-Column1-Body1">
            <p>Shows the message-spool processing statistics and associated message replay processing statistics.</p>
          </td>
        </tr>
        <tr class="TableStyle-Table_Num-Body-Body1">
          <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
            <code>show message-spool message-vpn &lt;message-vpn-name&gt; stats</code>
          </td>
          <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
            <p>Shows the message-spool processing statistics for a specified Message VPN and associated message replay processing statistics.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p MadCap:conditions="SAP.SapHideFromOutput">For a detailed description of the above commands, see the <MadCap:xref href="../../Admin/Solace-CLI/Command-Line-Reference.htm">CLI Command Reference</MadCap:xref>.</p>
    <h2 class="with-rule"><a name="Queues"/>Understanding the  Message Replay Queues</h2>
    <p>When you configure a replay log on a Message VPN, two queues called <code>#REPLAY_LOG_&lt;replay-log-name&gt;</code> and <code>#REPLAY_TOPICS_&lt;replay-log-name&gt;</code> are created. The replay logs created are as follows:</p>
    <ul>
      <li>
        <code>#REPLAY_LOG_&lt;replay-log-name&gt;</code>
      </li>
      <ul>
        <li>
          <p>Holds all the logged messages.</p>
        </li>
        <li>
          <p>Messages in this queue are counted towards the Message VPN quota.</p>
        </li>
      </ul>
      <li>
        <code>#REPLAY_TOPICS_&lt;replay-log-name&gt;</code>
      </li>
      <ul>
        <li>
          <p>Holds the metadata about the logged messages (message ID, time spooled, topic string).</p>
        </li>
        <li>
          <p>Its contents are counted towards the Message VPN quota.</p>
        </li>
      </ul>
    </ul>
    <p MadCap:conditions="SAP.SapHideFromOutput"> You cannot configure these queues through the usual <MadCap:variable name="Product-Names.solace_cli"/> commands associated with queue configuration.</p>
    <h2 class="with-rule" MadCap:conditions="SAP.SapHideFromOutput"><a name="show"/>Checking the Status of Replay Using <code>show replay-log</code></h2>
    <p MadCap:conditions="SAP.SapHideFromOutput">For the replay logs identified in the <code>show replay-log</code> command you can show: </p>
    <ul>
      <li MadCap:conditions="SAP.SapHideFromOutput">the number of messages logged</li>
      <li MadCap:conditions="SAP.SapHideFromOutput"> the space consumed by those messages</li>
      <li MadCap:conditions="SAP.SapHideFromOutput">the value set for <code>max-spool-usage</code>, and the ingress and egress states</li>
    </ul>
    <p MadCap:conditions="SAP.SapHideFromOutput">For an example of using the command for monitoring usage, see <MadCap:xref href="#example-calculate-usage">Monitoring Usage of a Replay Log</MadCap:xref>.</p>
    <p class="Code" MadCap:conditions="SAP.SapHideFromOutput">solace&gt; show replay-log &lt;name&gt; [message-vpn &lt;vpn-name&gt;] [messages [oldest | newest] [msg-id &lt;msg-id&gt; | replication-group-msg-id &lt;replication-group-msg-id&gt; | priority &lt;priority&gt;] [detail] | topic-filters] [count &lt;num-elements&gt;]</p>
    <p MadCap:conditions="SAP.SapHideFromOutput"><u>Where</u>:</p>
    <ul MadCap:conditions="SAP.SapHideFromOutput">
      <li><code>&lt;name&gt;</code>—The name of the message replay log.</li>
      <li><code>&lt;vpn-name&gt;</code>— The name of the Message VPN.</li>
      <li><code>messages</code>—Specifies to show information on the  messages associated with the replay log.</li>
      <li><code>oldest</code>—Specifies to show the messages in the replay log in order from oldest to newest.</li>
      <li><code>newest</code>—Specifies to show  messages in the replay log in order from newest to oldest.</li>
      <li><code>msg-id &lt;msg-id&gt;</code>—Specifies to show the messages in the replay log starting from the message identifier number specified by <code>&lt;msg-id&gt;</code>. </li>
      <li><code>replication-group-msg-id &lt;replication-group-msg-id&gt;</code>— Specifies to show the  messages in the replay log starting from the replication group message ID specified by <code>&lt;replication-group-msg-id&gt;</code>. </li>
      <li><code>priority &lt;priority&gt;</code>—Specifies to show only the messages in the replay log with the  priority specified by <code>&lt;priority&gt;</code>. Valid values are 0 through 9.</li>
      <li><code>topic-filters</code>—Specifies to show subscriptions associated with the replay log. </li>
      <li><code>count &lt;num-elements&gt;</code>—Specifies the number of display elements to show. Valid values are 1 through 4294967295.</li>
    </ul>
    <h3><a name="example-calculate-usage"/>Monitoring the  Replay Log Usage</h3>
    <p>You can use the <MadCap:variable name="Product-Names.pubsubmanager_long"/> <MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">or <MadCap:variable name="Product-Names.solace_cli"/></MadCap:conditionalText> to monitor the replay log usage against its configured quota<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> for <code>max-spool-usage</code></MadCap:conditionalText>.</p>
    <p>To determine the usage for the replay log, you can either:</p>
    <ul>
      <li>
        <p>Log in to <MadCap:variable name="Product-Names.pubsubmanager_long"/>, select the Message VPN you want to view, and select <b>Replay</b> from the left navigation pane. <img src="../../Resources/Images/Replay/replay-usage-screenshot.png" alt=""/></p>
        <p>For more information about using  <MadCap:variable name="Product-Names.pubsubmanager_short"/>, see <MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"><MadCap:xref href="../../Admin/Broker-Manager/PubSub-Manager-Overview.htm">[%=Product-Names.pubsubmanager_long%]</MadCap:xref> (for <MadCap:variable name="Product-Names.broker_sw_short"/>) or</MadCap:conditionalText> <MadCap:xref href="../../Cloud/using-broker-manager-cloud.htm">Using [%=Product-Names.pubsubmanager_long%]</MadCap:xref><MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> (<MadCap:variable name="Product-Names.cloud_product_long"/>)</MadCap:conditionalText>.</p>
      </li>
      <li MadCap:conditions="SAP.SapHideFromOutput">
        <p>Run the <code>show replay-log &lt;replay-log-name&gt;</code> command in the <MadCap:variable name="Product-Names.solace_cli"/>. From the results, you use value of  <code>Log Usage(MB)</code> and divide it by the <code>Quota(MB)</code> to calculate the percentage of the configured quota. For example, this would be 1773.21/2000 which equals 89% usage.</p>
        <pre xml:space="preserve">
solace(configure/message-spool/replay-log)# show replay-log my-first-log

Flags Legend:
I - Ingress Admin State (U=Up, D=Down)
E - Egress  Admin State (U=Up, D=Down)
F - Topic Filter State (E=Enabled, D=Disabled)

Replay Log Name              Messages        Log            Status
Message VPN                    Logged  Usage(MB)  Quota(MB) I E F
------------------------- ----------- ---------- ---------- ------
My-first-replay-log
default                           928    1773.21       2000 U D E
</pre>
      </li>
    </ul>
  </body>
</html>
