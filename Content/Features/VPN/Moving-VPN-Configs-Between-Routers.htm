<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>Moving Message VPN Configurations Between Event Brokers</h1>
    <h2 class="with-rule"><a name="top"/>General Steps</h2>
    <p>To move an individual Message VPN configuration from one Solace PubSub+ event broker to another, follow these steps:</p>
    <div class="Caution">
      <p>This procedure deletes the existing Message VPN configuration and any  messages spooled in the Message VPN from the destination event broker. Messages are not moved from the source to the destination event broker. Only the configuration is moved.</p>
    </div>
    <ol>
      <li>On the first event broker, run the  <code>show current-config</code> User EXEC command to generate the sequence of CLI configuration commands needed to backup the specified Message VPN, redirecting the command output to a script file (for example, <code>mvpn1.cli</code>).</li>
      <li>Using a File Transfer user account (refer to <MadCap:xref href="../../Admin/Configuring-Internal-CLI-User-Accounts.htm">Configuring Internal CLI User Accounts</MadCap:xref> for more information), transfer the backup script generated in Step 1 from the first event broker to the second using the <code>copy</code> Privileged EXEC command. </li>
      <li>On the second event broker:<ol style="list-style-type: lower-alpha;"><li>Run the  <code>show current-config</code> User EXEC command, this time with the  remove attribute, to generate the sequence of CLI configuration commands needed to remove the specified Message VPN, redirecting the command output to a script file (for example, <code>tmp.cli</code>). </li><li>Using the remove script generated above, run the <code>source script</code> User EXEC command to remove the current Message VPN configuration and delete any messages spooled in the Message VPN from the second event broker.</li><li>Using the backup script transferred in Step 2, run the <code>source script</code> User EXEC command to restore the Message VPN configuration onto the second event broker. <p class="Note" MadCap:autonum="&lt;b&gt;Note:  &lt;/b&gt;">Always specify using the <code>source script</code> User EXEC command attributes <code>stop-on-error</code> and <code>no-prompt</code> so that the script stops running on encountering an error, and that the script also ignores yes/no confirmation prompting.</p></li></ol></li>
    </ol>
    <h2 class="with-rule"><a name="Example"/>Example</h2>
    <p>A sample session to move the configuration of Message VPN blue on event broker <code>solace1</code> to event broker <code>solace2</code> is: </p>
    <ol>
      <li>Generate the sequence of CLI commands needed to create the Message VPN blue configuration on <code>solace1</code> by running the following <code>show current-config</code> User EXEC command, redirecting the command output for creating Message VPN blue to script file <code>blue.cli</code>:
        <p class="Code">solace1&gt; show current-config message-vpn blue &gt; cliscripts/blue.cli</p><p class="Note" MadCap:autonum="&lt;b&gt;Note:  &lt;/b&gt;">CLI paging is automatically disabled for the duration of a redirected CLI command, but confirmation prompts, error and warning messages are not; they remain displayed on the CLI console.</p></li>
      <li>Using a File Transfer user account, transfer the script file  from <code>solace1</code> to <code>solace2</code> using the <code>copy</code> Privileged EXEC command:
        <p class="Code">solace1&gt; enable<br/>solace1# copy cliscripts/blue.cli sftp://sftp@192.168.128.69/cliscripts</p></li>
      <li>Generate the sequence of CLI commands needed to remove the Message VPN <code>blue</code> configuration on <code>solace2</code> (so that it can be replaced by the configuration from <code>solace1</code>) by running the following <code>show current-config</code> User EXEC command, redirecting the command output for removing Message VPN blue to script file <code>tmp.cli</code>:
        <p class="Code">solace2&gt; show current-config message-vpn blue remove &gt; cliscripts/tmp.cli</p></li>
      <li>Run the following <code>source script</code> User EXEC command to remove the current Message VPN <code>blue</code> configuration and delete any messages spooled in the Message VPN from <code>solace2</code> using script file <code>tmp.cli</code>, always specifying that the script stop running on encountering an error and also ignore yes/no confirmation prompting: 
			<p class="Code">solace2&gt; source script tmp.cli stop-on-error no-prompt </p></li>
      <li>Run the following <code>source script</code> User EXEC command to restore the configuration of Message VPN <code>blue</code> from <code>solace1</code> onto <code>solace2</code> using script file <code>blue.cli</code>, always specifying that the script stop running on encountering an error and also ignore yes/no confirmation prompting: 
			<p class="Code">solace2&gt; source script blue.cli stop-on-error no-prompt</p></li>
    </ol>
    <p class="Note" MadCap:autonum="&lt;b&gt;Note:  &lt;/b&gt;">For more information on running scripts from Solace CLI refer to <MadCap:xref href="../../Admin/Solace-CLI/Using-Solace-CLI.htm#using_the_solace_router_cli_2293357723_233911">Writing and Running Basic CLI Scripts</MadCap:xref>. </p>
  </body>
</html>
