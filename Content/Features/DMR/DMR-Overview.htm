<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
  <head/>
  <body>
    <h1>Dynamic Message Routing</h1>
    <p>The underlying technology for an event mesh is Dynamic Message Routing (DMR). As your enterprise grows, you may find that your individual <MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">event brokers and </MadCap:conditionalText><MadCap:variable name="Product-Names.broker_cloud_short"/>s (or nodes) are not sufficient to handle the demands of your business.  At some point even the largest, most generously provisioned node has its limits, but these can be overcome by networking several nodes together and spreading the load among the participants. In this way, multiple nodes can be connected together to service loads far in excess of that possible by a single one.</p>
    <p>Enterprise applications  also become distributed across multiple sites—which can include multiple public and private clouds <MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> as well as legacy data centers</MadCap:conditionalText>—driving the need for an easy way to intelligently share information between all these locations and interfaces. For example, your organization may have on-premises  applications using  <MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">event brokers and</MadCap:conditionalText> <MadCap:variable name="Product-Names.broker_cloud_short"/>s that need to connect to cloud services<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> such as AWS Lambda, Azure Event Hubs, or Google Functions</MadCap:conditionalText>.</p>
    <p>Dynamic Message Routing (DMR) is a mechanism that allows connected nodes to automatically determine how to forward event messages<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">. You use DMR to create a network, or <i>event mesh</i>, that connects individual brokers together</MadCap:conditionalText> within the same site (<i>horizontal scaling</i>) or between sites (<i>multi-site scaling</i>) to exchange subscription information. With an event mesh, clients don't need to know about other sites in the network. Once the relationships between <MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">event brokers and</MadCap:conditionalText> <MadCap:variable name="Product-Names.broker_cloud_short"/>s are established by the administrator, the event brokers  dynamically discover how to route messages. Client applications don't have to take any special action to publish or consume messages across the mesh. They simply go about their business of exchanging messages without considering how to get those messages where they need to go. With DMR, you can move any applications within the mesh, or change the interests of those applications, and the mesh automatically updates the routing—without any intervention.</p>
    <p class="Note">DMR supports two basic use cases: horizontal scaling and multi-site scaling. More complicated topologies are possible. If the use cases discussed here don't address your needs, <a href="../../get-support.htm" class="link-internal">contact <MadCap:variable name="Variables.CompanyName"/></a> for assistance with designing and implementing your DMR mesh.</p>
    <h2 class="with-rule"><a name="horizontal-scaling"/>Horizontal Scaling</h2>
    <p>For horizontal scaling, you connect brokers together to create a DMR <i>cluster</i>. Each node (<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">event broker or </MadCap:conditionalText><MadCap:variable name="Product-Names.broker_cloud_short"/>) in the cluster has a connection to every other node. These connections within the same cluster are called <i>internal links</i>; collectively, we refer to this as a "full mesh" of links. Within this fully-meshed cluster, each node is aware of all the others so that every event published in the network is seamlessly routed to the consuming applications. </p>
    <p>DMR clusters are typically used for software and hardware event brokers at the same site. <MadCap:variable name="Product-Names.cloud_product_firstuse_initialcase"/><MadCap:variable name="Product-Names.broker_cloud_short"/>s are usually set up as single-node cluster and don't use horizontal scaling.</p>
    <p>
      <img src="../../Resources/Images/Getting-Started/DMR-cluster.png" alt="Illustration depicting the concepts described in the surrounding text."/>
    </p>
    <p MadCap:conditions="SAP.SapHideFromOutput">For more details, see <MadCap:xref href="DMR-Subscription-Mgmt.htm">Configuring DMR</MadCap:xref> and the <MadCap:xref href="DMR-Examples-Scaling.htm">Horizontal Scaling</MadCap:xref> example.</p>
    <h2 class="with-rule"><a name="multi-site-scaling"/>Multi-Site Scaling</h2>
    <p>In multi-site scaling, you connect two or more clusters together. Connections between clusters are called <i>external links</i>. Each cluster is connected together via a gateway node in each cluster. <MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput">It is not necessary for each cluster to be connected to every other cluster; however, messages only propagate between directly-connected clusters. For example, if an external link was not configured between two cluster,  messages do not pass between them. As shown in the diagram below, messages won't pass between Cluster A and Cluster C because they are not connected.</MadCap:conditionalText></p>
    <p>
      <img src="../../Resources/Images/Getting-Started/DMR-multi-site.png" alt="Illustration depicting the concepts described in the surrounding text."/>
    </p>
    <p MadCap:conditions="SAP.SapHideFromOutput">For more details, see <MadCap:xref href="DMR-Subscription-Mgmt.htm">Configuring DMR</MadCap:xref> and the <MadCap:xref href="DMR-Examples-Multi-Site.htm">Multi-Site Connectivity</MadCap:xref> example.</p>
    <h2 class="with-rule"><a name="message-propagation"/>Message Flow in an Event Mesh</h2>
    <p>Let's take a look at how DMR works in a scenario. The diagram below shows  a horizontally-scaled cluster on-premises, which is connected to a DMR cluster in the public cloud (AWS in the example) and another cluster<MadCap:conditionalText MadCap:conditions="SAP.SapHideFromOutput"> in a platform-as-a-service (PaaS)</MadCap:conditionalText> (Kubernetes in the example).</p>
    <p>A publishing application (A) comes online and publishes to a topic, let's say <code>tools/orders</code>. A consuming application (B) in the <i>same cluster</i> comes online, binds to its queue, and subscribes to topic <code>tools/orders</code>. Events flow from application A to application B, preserving the quality of service (guaranteed or direct) of the publishing application A.</p>
    <p>In addition, all subscriptions are shared <i>between</i> connected clusters. This means that event messages published by an application in one cluster are seamlessly routed to consuming application in other clusters.</p>
    <p>In the example below, another consumer (C) comes online and subscribes to the same topic, <code>tools/orders</code>. Any event  with topic <code>tools/orders</code> is now routed to the new consumer. As more publishers and consumers connect and disconnect, the routing is dynamically updated in the mesh.</p>
    <p>
      <img src="../../Resources/Images/DMR/DMR-Tasks/message-propagation-example.png" alt=""/>
    </p>
    <h2 class="with-rule"><a name="dmr-or-vpn-bridge"/>DMR or a Message VPN Bridge?</h2>
    <p>DMR and VPN bridges are two alternate technologies that can be used to interconnect brokers. Both support <a href="../../Messaging/Guaranteed-Msg/Guaranteed-Messages.htm" class="link-internal">guaranteed</a> (persistent) and <a href="../../Messaging/Direct-Msg/Direct-Messages.htm" class="link-internal">direct</a> (non-persistent) messages. The advantage of DMR over VPN bridges is that with DMR you don’t need to statically configure topic subscriptions to define which events flow over the inter-broker links. DMR automatically routes your guaranteed and direct messages through your event mesh to all interested subscribers.</p>
    <p>The <a href="../../Admin/Broker-Manager/PubSub-Manager-Overview.htm" class="link-internal"><MadCap:variable name="Product-Names.pubsubmanager_long"/></a> includes a Click-to-Connect wizard that can easily create a DMR mesh in a few mouse clicks. Click-to-connect is also provided for VPN bridges, but you must then configure the topics that the bridges subscribe to.</p>
    <p>When you want to strictly control which events go over an inter-broker link, you should use VPN bridges. When you want to build a large event mesh with minimal configuration effort and dynamic propagation of subscriptions throughout the mesh, DMR is the recommended choice.</p>
    <h2 class="with-rule" MadCap:conditions="SAP.SapHideFromOutput"><a name="Feature"/>Feature Interactions</h2>
    <dl MadCap:conditions="SAP.SapHideFromOutput">
      <dt>Disaster Recovery (Replication)</dt>
      <dd>You can take advantage of disaster recovery (using replication and Config-Sync) within your DMR network (or event mesh). Replication provides business continuity and allows mission‑critical applications to continue to function during a major service outage to a data center. For more information, see <MadCap:xref href="../DR-Replication/Data-Center-Replication-Overview.htm">Replication Overview</MadCap:xref> and <MadCap:xref href="../DR-Replication/Replication-with-DMR.htm">Configuring Replication with a DMR Network</MadCap:xref>.</dd>
      <dt>Message VPN Bridging</dt>
      <dd>Bridging and DMR are compatible, and can be used at the same time. However, we recommend that you don't configure VPN bridge links and DMR links between the same event brokers because this configuration causes duplicate message delivery.</dd>
      <dt MadCap:conditions="SAP.SapHideFromOutput">Multi-Node Routing</dt>
      <dd MadCap:conditions="SAP.SapHideFromOutput"><MadCap:xref href="../MNR/Managing-Multi-Node-Routing-Links.htm" target="_blank">Multi-Node Routing</MadCap:xref> (MNR) and DMR cannot be used at the same time. They are mutually exclusive.<p class="Caution">If you want to migrate from MNR to DMR, <a href="../../get-support.htm" class="link-internal">contact <MadCap:variable name="Variables.CompanyName"/></a> for assistance.</p></dd>
    </dl>
    <h2 class="with-rule" MadCap:conditions="SAP.SapHideFromOutput"><a name="Next"/>Next Steps</h2>
    <ul MadCap:conditions="SAP.SapHideFromOutput">
      <li>To delve deeper into the specifics of how DMR works, see <MadCap:xref href="DMR-Subscription-Mgmt.htm">DMR Subscription Propagation and Data Forwarding</MadCap:xref>.</li>
      <li>For a high-level view of how to set up an event mesh, see <MadCap:xref href="DMR-Setup-Overview.htm">Setting up an Event Mesh Using DMR</MadCap:xref>.</li>
      <li>Take a look at the examples to see how to configure <MadCap:xref href="DMR-Examples-Scaling.htm">Horizontal Scaling</MadCap:xref> and <MadCap:xref href="DMR-Examples-Multi-Site.htm">Multi-Site Connectivity</MadCap:xref>.</li>
    </ul>
  </body>
</html>
