<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-toc-path="PubSub+ Software Event Broker|[%=System.LinkedTitle%]" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta http-equiv="Cache-control" content="no-cache" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Rootless Containers</title>
        <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" /> -->
        <!--style to display feedback button correctly in IE-->
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <!-- links to get the EDA styling to work -->
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Resources/Stylesheets/MainStyles.min.css" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <style>@media screen and (min-width: 0\0)
{
	.feedback-button
	{
		margin-right: -40px;
		top: 50%;
		border-radius: 9px 9px 0px 0px;
	}

	#canvas
	{
		position: relative;
	}
}

@media print
{
	#plugin
	{
		overflow: visible !important;
	}
}

</style>
        <link href="../../Resources/Stylesheets/eda_styles.css" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css" />
        <style>/*&lt;meta /&gt;*/

.button.print-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.button.previous-topic-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.button.next-topic-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../Resources/TableStyles/Table_Num.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <script src="../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script src="https://cmp.osano.com/AzZrhlTmT5f216Foa/84ba7dc4-a4e5-4b02-b120-977eb6f052d4/osano.js">
        </script>
        <script type="text/javascript">/*<![CDATA[*/(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-KLSDFH');
		/*]]>*/</script>
        <script type="text/javascript" src="../../Skins/Default/Scripts/TopicToolBar.js">
        </script>
    </head>
    <!-- Top Orange and Darkgrey header-->
    <!-- Div for EDA banner -->
    <div class="eda_banner">
        <p>Register Now for EDA Summit 2024 - Virtual Event <a href="https://edasummit.com/" target="_blank">Register for Free</a></p>
    </div>
    <!-- end Div for EDA banner -->
    <div class="top-nav">
        <div class="main_list">
            <ul class="top-navlinks">
                <li><a href="https://solace.com/support/" target="_blank">Support</a>
                </li>
                <li><a href="https://solace.com/contact/" target="_blank">Contact Us</a>
                </li>
            </ul>
        </div>
        <div class="container-fluid">
            <div class="src-li">
                <div id="srchWrapTwo">
                    <form class="search" action="#">
                        <div class="search-bar search-bar-container needs-pie">
                            <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search the docs" />
                            <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                </div>
                                <div class="search-filter-content" id="sf-content">
                                    <ul>
                                        <li>
                                            <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="search-submit-wrapper" dir="ltr">
                                <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div><span class="tool-tip" tooltip-position="left" tooltip="To search for CLI commands, events, or APIs, navigate to the related sections.">i</span>
            <!-- Sept. 28, 2022 - This is being moved to under div class= top-nav
			<div class="main_list">
				<ul class="top-navlinks">
					<li><a href="https://solace.com/support/" target="_blank">Support</a></li>
					<li><a href="https://solace.com/contact/" target="_blank">Contact Us</a></li>
				</ul>
			</div> -->
        </div>
        <!-- Sept. 27, 2022 - The commented out content below used to provide the products, company, etc., links in the top header, next to the search field. -->
        <!-- <div class="main_list"><ul class="top-navlinks"><li><a href="https://solace.com/products/" target="_blank">Products</a></li><li><a href="https://solace.com/company/" target="_blank">Company</a></li><li><a href="https://www.solace.dev/" target="_blank">Developers</a></li><li><a href="https://solace.com/support/" target="_blank">Support</a></li><li><a href="https://solace.com/contact/" target="_blank">Contact Us</a></li></ul></div> -->
    </div>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1000px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../index.html" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search the docs" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolBar mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic Print NextTopic;">
                                        <div class="button-group-container-left">
                                            <button class="button needs-pie print-button" title="Print">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Print">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                            <button class="button needs-pie previous-topic-button" title="Navigate previous topic" disabled="true">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Navigate previous">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                            <button class="button needs-pie next-topic-button" title="Navigate next topic" disabled="true">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Navigate next">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLSDFH" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <div id="content">
                                        <div id="contentBody">
                                            <div class="row collapse">
                                                <div class="ContentRow" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                    <div>
                                                        <div class="nocontent" xmlns="">
                                                            <div class="MCBreadcrumbsBox_MCBreadcrumbsSelf_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" / " data-mc-breadcrumbs-count="4" data-mc-toc="True"><span class="MCBreadcrumbsPrefix"> </span>
                                                            </div>
                                                        </div>
                                                        <div role="main" id="mc-main-content" xmlns="">
                                                            <h1 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Rootless_Containers" data-mc-generated-bookmark="TOC" xmlns=""></a>Rootless Containers</h1>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Rootless containers are containers that can be created, run, and otherwise managed by unprivileged users (as opposed to the root user). To be considered fully rootless, both the container runtime and the container must be running without root privileges.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">An advantage to using rootless containers is that they can mitigate the risk of  container-breakout vulnerabilities. The best way to prevent privilege-escalation attacks from within a container is to configure your container’s applications to run as unprivileged users. However, running in rootless mode introduces some additional complexity, especially concerning networking. For more details, see <a href="Config-Container-Networking.htm" class="MCXref xref">Container Networking</a>.</p>
                                                            <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="User_Namespaces" data-mc-generated-bookmark="TOC" xmlns=""></a><a name="user-namespaces"></a>User Namespaces</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Rootless containers make use of a feature of the Linux kernel called <a href="http://man7.org/linux/man-pages/man7/user_namespaces.7.html" target="_blank" class="link-offsite">user namespaces</a>. User namespaces isolate security-related identifiers and attributes, in particular, user IDs (UIDs) and group IDs (GIDs), credentials, the root directory, keys, and capabilities. A process's user and group IDs can be different inside and outside a user namespace. With user namespaces, a range of user and group IDs in the process's user namespace is mapped to a set of user and group IDs in the  parent namespace; this mapping is specified in the <code>/etc/subuid</code> and <code>/etc/subgid</code> files. </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The <code>/etc/subuid</code> file authorizes a user ID to map ranges of userIDs from its namespace into child namespaces; the <code>/etc/subgid</code> provides the same functionality for group IDs. Each line in <code>/etc/subuid</code> and <code>/etc/subgid</code> contains either a user name or group name, respectively, and a range of subordinate IDs that processes in the child namespace are allowed to use. The three fields delimited for each entry are:</p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li>user/group name or ID</li>
                                                                <li>numerical subordinate ID</li>
                                                                <li>numerical subordinate ID count</li>
                                                            </ul>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For example, this entry shows that for user Maria, the subordinate IDs start at 10001 and have a range of 65536:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">maria:10001:65536</pre>
                                                            <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="User_and_Group_ID_Translation" data-mc-generated-bookmark="TOC" xmlns=""></a><a name="uid-gid-translation"></a>User and Group ID Translation</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Rootless mode executes the processes for the container runtime and containers inside a user namespace. The user ID of the container maps to the user ID of host as follows:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"> &lt;start of subuid range&gt; + &lt;uid inside the container&gt; – 1</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Similarly, the group ID of the container user maps to:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">&lt;start of subgid range&gt; + &lt;GID inside the container&gt; - 1</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The exception to this is that the root user (UID=0) maps to the UID that owns the user namespace.</p>
                                                            <p class="Note" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">You must carefully consider this mapping when you are setting the ownership of the data volume directories.  Podman includes an <code>unshare</code> utility that makes setting the directory ownership less confusing (and does not require the user running the commands to use <code>sudo</code>). For more information, see <a href="Config-Container-Storage.htm" class="MCXref xref">Managing Storage for Container Images</a>.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For example, suppose Solly has a UID of 1000. His account has a mapping in <code>/etc/subuid</code> of <code>solly:12000:65536</code>. This means that user IDs inside Solly's user namespace can be mapped to a range of 65536 IDs on the host, starting with UID 12000:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">$ cat /etc/subuid
solly:120000:65536</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Solly is running Podman with this UID mapping. When he launches Bash inside his Podman container, and then examines the current user, he sees the following:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">$ podman run --rm -it ubuntu bash
root@bfda7167e840:/# id    
uid=0(root) gid=0(root) groups=0(root)</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">This shows that Bash is running as the root user (0) inside the user namespace.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">He then examines the <code>uid_map</code> file:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">

root@bfda7167e840:/# cat /proc/self/uid_map 
         0       1000          1
         1     120000      65536</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">This shows that:</p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li> the root user (0) in the user namespace is mapped to Solly's UID (1000) on the host</li>
                                                                <li>user ID 1 in the namespace is mapped to UID 120000 on the host</li>
                                                            </ul>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The following diagram shows another example where the container runtime is launched by Maria, who has user ID&#160;1600. The  <code>/etc/subuid</code> file contains the following mapping:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">maria:10001:65536</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">This means that processes within Maria's user namespace map to host UIDs starting at 10001. Because the container runtime launches the containers, the container processes also belong to Maria's user namespace.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <img src="../../Resources/Images/SW-Broker-Setup/Container/Rootless-Container-UID-Mapping.png" alt="" />
                                                            </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">In this example:</p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li> the root user (0) in the user namespace is mapped to Maria's UID (1600) on the host</li>
                                                                <li>user ID 1000 in the user namespace is mapped to UID 11000 on the host</li>
                                                            </ul>
                                                            <p class="Caution" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The default User ID in a Solace container is 1000001. That is, if you do not specify the <code>-u</code> parameter, the container runs with UID=1000001. In a rootless environment, the container will not run because the OS&#160;won't allocate a UID range that starts with 1000001 within the user namespace. To resolve this, specify a <code>-u</code> parameter with a smaller non-zero user ID when you start the container.</p>
                                                            <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Resource_Limit_Configuration" data-mc-generated-bookmark="TOC" xmlns=""></a><a name="resource-limits"></a>Resource Limit Configuration</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The resource constraints that an unprivileged user can impose on a container are limited by the constraints assigned to the user. Any changes in the limits assigned to the unprivileged user must be made by a privileged user.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For instance, on the WSL2 Ubuntu 20.04 LTS distribution, the default hard limit for the maximum number of concurrent open files for an unprivileged user (and therefore for a container created by an unprivileged user) is  4096. Using this default value means that the number of PubSub+ client connections is constrained to less than the configured maximum (because 4096 is less than the recommended limit for the <a href="../System-Scaling-Parameters.htm#max-client-connections" class="MCXref xref">Maximum Number of Client Connections</a>).</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To allow an unprivileged user to create a container with <code>--ulimit nofile=2448:42192</code>, the root user must modify the <code>nofile</code> hard limit configuration for the user in the <code>/etc/security/limits.conf</code> file.</p>
                                                            <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Directory_and_File_Ownership" data-mc-generated-bookmark="TOC" xmlns=""></a><a name="file-ownership"></a>Directory and File Ownership</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">A PubSub+ container is designed to work with directories and files that are owned by the container user and the root group.
As described in <a href="../Configuring-Storage.htm" class="MCXref xref">Managing Software Event Broker Storage</a>, the software broker makes use of a <code>storage-group</code> to maintain state information. We recommend that this <code>storage-group</code> be kept in external storage, and mounted to the container as a volume (preferred) or bind mount.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To ensure that the software broker container has the required permissions to access the <code>storage-group</code>, you must modify the ownership of the persistent storage using the <code>podman unshare</code> command on the host:</p><pre xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">podman unshare chown &lt;container user's uid&gt;:0 -R &lt;directory&gt;</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The <code>podman unshare</code> command lets you run a command (<code>chown</code> in this case) in the same user namespace as your containers. Because all rootless containers that are run by a given user run inside the same user namespace, you only need to run <code>podman unshare chown</code> once to allow all of a user's containers to access a directory.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For example, for a container user with UID 5 and a <code>storage-group</code> mounted as a volume, run <code>chown</code> with <code>podman unshare</code> to change the directory owner within the container's user namespace:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">$ podman unshare chown 5:0 -R /home/ec2-user/.local/share/containers/storage/volumes/solace/_data</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Now run <code>ls</code> with <code>podman unshare</code> to view the directory owner within the container's user namespace:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
$ podman unshare ls -laZ /home/ec2-user/.local/share/containers/storage/volumes/solace/_data
drwxrwxrwx. 9 <span style="color: #ff0000;">5 root</span> system_u:object_r:container_file_t:s0 165 Feb 24 14:40 _data</pre>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Run <code>ls</code> again, this time without <code>podman unshare</code>, to view the directory owner from the perspective of the host namespace:</p><pre xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
$ ls -laZ /home/ec2-user/.local/share/containers/storage/volumes/solace/_data
drwxrwxrwx. 9 <span style="color: #ff0000;">100004 ec2-user</span> system_u:object_r:container_file_t:s0 165 Feb 24 14:40 _data
</pre>
                                                            <p class="Note" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Podman resets the ownership of directories and files in volume mounts when it starts the rootless container for the first time, therefore, simply run the <code>podman unshare</code> command after you start the container for the first time. Alternatively, create an empty directory and bind mount it—in this case the correct directory/file ownership is automatically assigned.</p>
                                                            <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Rootful_Versus_Rootless_Containers" data-mc-generated-bookmark="TOC" xmlns=""></a><a name="rootful-vs-rootless"></a>Rootful Versus Rootless Containers</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">There are four possible variants for running containers with a combination of root and non-root users, as shown in the table below: </p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li>The container runtime is executed as root (left two scenarios) versus non-root (right two scenarios)</li>
                                                                <li>The user inside the container is root (top two scenarios) versus non-root (bottom two scenarios)</li>
                                                            </ul>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"> The most secure solution  is the bottom-right scenario, where the container is run as non-root, and the user inside the container is also non-root.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The examples in the table use Podman to illustrate the four scenarios:</p>
                                                            <table style="width: 100%;mc-table-style: url('../../Resources/TableStyles/Table_Num.css');border-left-style: solid;border-left-width: 1px;border-left-color: #e1e1e1;border-right-style: solid;border-right-width: 1px;border-right-color: #e1e1e1;border-top-style: solid;border-top-width: 1px;border-top-color: #e1e1e1;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #e1e1e1;margin-left: 0;margin-right: auto;" class="TableStyle-Table_Num" cellspacing="0" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <col class="TableStyle-Table_Num-Column-Column1" />
                                                                <col class="TableStyle-Table_Num-Column-Column1" />
                                                                <tbody>
                                                                    <tr class="TableStyle-Table_Num-Body-Body1">
                                                                        <td class="TableStyle-Table_Num-BodyH-Column1-Body1">
                                                                            <p style="font-weight: bold;font-size: 1.2rem;">Container Runtime Executed as Root</p>
                                                                            <p style="font-weight: bold;font-size: 1.2rem;">Processes in Container Executed as Root</p>
                                                                            <p>Launch Podman as root, and specify the root user (<code>-u 0</code>) within the container:</p><pre xml:space="preserve">brian@ubuntu:/$ sudo bash
root@ubuntu:/# whoami
&gt; root
root@ubuntu:/# podman run <span style="color: #ff0000;">-u 0</span> ... solace-container</pre>
                                                                            <p>Run bash inside the container:</p><pre xml:space="preserve">root@ubuntu:/# podman exec -it solace-container bash</pre>
                                                                            <p>Processes run as root inside the container:</p><pre xml:space="preserve"> whoami
&gt; root</pre><pre xml:space="preserve">
ps auxf
&gt; # Notice processes are running as root
</pre>
                                                                            <p>The same processes run as root outside the container from the perspective of the host:</p><pre xml:space="preserve">root@ubuntu:/# ps auxf
&gt; # Notice all container processes are running as root
</pre>
                                                                        </td>
                                                                        <td class="TableStyle-Table_Num-BodyG-Column1-Body1">
                                                                            <p style="font-weight: bold;font-size: 1.2rem;">Container Runtime Executed as Non-Root</p>
                                                                            <p style="font-weight: bold;font-size: 1.2rem;">Processes in Container Executed as Root</p>
                                                                            <p>Launch Podman as unprivileged user, and specify the root user (<code>-u 0</code>) within the container:</p><pre xml:space="preserve">brian@ubuntu:/$ whoami
&gt; brian (UID 1000)

brian@ubuntu:/$ podman run <span style="color: #ff0000;">-u 0</span> ... solace-container</pre>
                                                                            <p>Run bash inside the container:</p><pre xml:space="preserve">brian@ubuntu:/$ podman exec -it solace-container bash</pre>
                                                                            <p>Processes run as root inside the container</p><pre xml:space="preserve"> whoami
&gt; root</pre><pre xml:space="preserve"> ps auxf
&gt; # Notice processes are running as root
</pre>
                                                                            <p>The same processes run as UID 1000 (brian) outside the container from the perspective of the host (because of user namespace mapping)</p><pre xml:space="preserve">brian@ubuntu:/$ ps auxf
&gt; # Notice all container processes are running as user 1000 (brian)</pre>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="TableStyle-Table_Num-Body-Body1">
                                                                        <td class="TableStyle-Table_Num-BodyB-Column1-Body1">
                                                                            <p style="font-weight: bold;font-size: 1.2rem;">Container Runtime Executed as Root</p>
                                                                            <p style="font-weight: bold;font-size: 1.2rem;">Processes in Container Executed as Non-Root</p>
                                                                            <p>Launch Podman as root, and do not specify a user within the container:</p><pre xml:space="preserve">brian@ubuntu:/$ sudo bash
root@ubuntu:/# whoami
&gt; root
root@ubuntu:/# podman run ... solace-container</pre>
                                                                            <p>Run bash inside the container:</p><pre xml:space="preserve">root@ubuntu:/# podman exec -it solace-container bash</pre>
                                                                            <p>When you don't specify a user, container processes run as user 1000001  (the default User ID in a Solace container is 1000001):</p><pre xml:space="preserve">whoami
&gt; 1000001</pre><pre xml:space="preserve">
ps auxf
&gt; # Notice processes are running as user 1000001</pre>
                                                                            <p>The same processes run as user 1000001 outside the container from the perspective of the host (no user namespace mapping because the container runtime runs as root):</p><pre xml:space="preserve">root@ubuntu:/# ps auxf
&gt; # Notice all container processes are running as user 1000001</pre>
                                                                        </td>
                                                                        <td class="TableStyle-Table_Num-BodyA-Column1-Body1">
                                                                            <p style="font-weight: bold;font-size: 1.2rem;">Container Runtime Executed as Non-Root</p>
                                                                            <p style="font-weight: bold;font-size: 1.2rem;">Processes in Container Executed as Non-Root</p>
                                                                            <p>Launch Podman as non-root user, and specify a non-root user within the container:</p><pre xml:space="preserve">brian@ubuntu:/$ whoami
&gt; brian (UID 1000)

brian@ubuntu:/$ podman run <span style="color: #ff0000;">-u 5</span> ... solace-container</pre>
                                                                            <p>Run bash inside the container:</p><pre xml:space="preserve">brian@ubuntu:/$ podman exec -it solace-container bash</pre>
                                                                            <p>Processes run as user 5 inside the container</p><pre xml:space="preserve">
whoami
&gt; 5</pre><pre xml:space="preserve">
ps auxf
&gt; # Notice processes are running as user 5
</pre>
                                                                            <p>The same processes run as UID 100004 outside the container from the perspective of the host (because of user namespace mapping):</p><pre xml:space="preserve">brian@ubuntu:/$ ps auxf
&gt; # Notice all container processes are running as USER 100004</pre>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Prerequisites_for_Rootless_Containers" data-mc-generated-bookmark="TOC" xmlns=""></a><a name="rootless-prerequisites"></a>Prerequisites for Rootless Containers</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Rootless mode relies on the resource isolation mechanisms of the host operating system. Therefore, certain configurations must be in place before you attempt to launch a container  in rootless mode. For details about the requirements for Podman, see <a href="https://github.com/containers/podman/blob/main/docs/tutorials/rootless_tutorial.md" target="_blank" class="link-offsite">Basic Setup and Use of Podman in a Rootless environment</a>. Other container engines have similar requirements.</p>
                                                            <p class="Note" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">In RHEL 8 and other popular Linux distributions, the packages that include Podman also install all of the prerequisites. For example, if you have installed the RHEL 8 <code>container-tools</code> package, you do not need to install any additional packages.</p>
                                                            <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Next_Steps_..89" data-mc-generated-bookmark="TOC" xmlns=""></a><a name="next-steps"></a>Next Steps</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For more information about working with rootless containers, see the following:</p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li><a href="https://rootlesscontaine.rs/" target="_blank" class="link-offsite">Rootless Containers</a>
                                                                </li>
                                                                <li><a href="https://developers.redhat.com/blog/2020/09/25/rootless-containers-with-podman-the-basics" target="_blank" class="link-offsite">Rootless containers with Podman: The basics</a>
                                                                </li>
                                                                <li><a href="https://github.com/containers/podman/blob/main/docs/tutorials/rootless_tutorial.md" target="_blank" class="link-offsite">Basic Setup and Use of Podman in a Rootless environment.</a>
                                                                </li>
                                                                <li><a href="https://github.com/containers/podman/blob/main/rootless.md" target="_blank" class="link-offsite">Shortcomings of Rootless Podman</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="no-print">
                                            <div><a href="#" id="docsFeedbackTrigger" class="docs-issue-collector">Provide feedback</a>
                                            </div>
                                        </div>
                                        <footer class="my-4 pt-4 text-center no-print">
                                            <div class="footer-txt text-center no-print">
                                                <ul class="list-inline ">
                                                    <li class="list-inline-item text-muted"><a href="../../Resources/Documentation-Set.htm" class="doc-set-footer-link MCXref xref xrefdoc-set-footer-link">Documentation Coverage</a>: <span class="mc-variable Variables.DocumentSetNumber variable">2024.09.16.0001</span></li>
                                                    <li class="list-inline-item text-muted">Last Updated: <span class="mc-variable Variables.MonthDayYear variable">September 16, 2024</span></li>
                                                    <li class="list-inline-item text-muted" style="font-size:13px;"> ©  <span class="mc-variable Variables.CompanyNameLegal variable">Solace Corporation</span></li>
                                                </ul>
                                            </div>
                                            <div class="footer-icons">
                                                <ul class="list-inline">
                                                    <li class="list-inline-item"><a href="https://facebook.com/solacedotcom" target="_blank" class="social-media-icon"><img src="../../Resources/Images/Social-Media/facebook_22x21.png" class="Hyperlinked" alt="Facebook" title="Solace Facebook Page" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://www.linkedin.com/company/20219" target="_blank" class="social-media-icon"><img src="../../Resources/Images/Social-Media/LinkedIn_22x21.png" class="Hyperlinked" alt="LinkedIn" title="Solace LinkedIn Page" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://twitter.com/solacedotcom" target="_blank" class="social-media-icon"><img src="../../Resources/Images/Social-Media/Twitter_22x21.png" class="Hyperlinked" alt="Twitter" title="Solace Twitter Feed" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://www.youtube.com/user/SolaceSystems" target="_blank" class="social-media-icon"><img src="../../Resources/Images/Social-Media/youtube_22x21.png" class="Hyperlinked" alt="YouTube" title="Solace YouTube Channel" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://www.instagram.com/solacedotcom/" target="_blank" class="social-media-icon"><img src="../../Resources/Images/Social-Media/instagram_22x21.png" class="Hyperlinked" alt="Instagram" title="Solace Instagram Feed" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://medium.com/solacedotcom" target="_blank" class="social-media-icon"><img src="../../Resources/Images/Social-Media/medium_22x21.png" class="Hyperlinked" alt="Medium" title="Solace Medium Blog" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="footer_link_menu">
                                                <ul class="link_list">
                                                    <li class="link_list_item"><a href="https://solace.com/products/" target="_blank" class="footer-link">Products</a>
                                                    </li>
                                                    <li class="link_list_item"><a href="https://solace.com/company/" target="_blank" class="footer-link">Company</a>
                                                    </li>
                                                    <li class="link_list_item"><a href="https://www.solace.dev/" target="_blank" class="footer-link">Developers</a>
                                                    </li>
                                                    <li class="link_list_item"><a href="https://solace.com/support/" target="_blank" class="footer-link">Support</a>
                                                    </li>
                                                    <li class="link_list_item"><a href="https://solace.com/contact/" target="_blank" class="footer-link">Contact Us</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </footer>
                                    </div>
                                    <!-- JIRA issue collector -->
                                    <script>/*<![CDATA[*/// Requires jQuery!
jQuery.ajax({
    url: "https://sol-jira.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e-T/o2joag/b/24/e73395c53c3b10fde2303f4bf74ffbf6/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-US&collectorId=076e0808",
    type: "get",
    cache: true,
    dataType: "script"
});
window.ATL_JQ_PAGE_PROPS = {
"triggerFunction": function(showCollectorDialog) {
//Requires that jQuery is available!
$("#docsFeedbackTrigger").click(function(e) {
e.preventDefault();
showCollectorDialog();
});
},
fieldValues: {
recordWebInfo: '1', // field Name
recordWebInfoConsent: ['1'] // field Id
}
};
/*]]>*/</script>
                                    <script src="../../Resources/Scripts/thumbnail.js">
                                    </script>
                                    <!-- Script for Launching offsite links in new tab -->
                                    <script type="text/javascript">/*<![CDATA[*/$("a[href^='http']").attr("target","_blank");/*]]>*/</script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>