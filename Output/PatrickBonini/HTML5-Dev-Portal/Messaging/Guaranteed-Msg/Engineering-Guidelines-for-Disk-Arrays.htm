<?xml version="1.0"?>
<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-toc-path="[%=System.LinkedTitle%]|[%=System.LinkedTitle%]" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png"/>
    <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png"/>
    <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png"/>
    <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png"/>
    <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png"/>
    <meta charset="utf-8"/>
    <meta http-equiv="Cache-control" content="no-cache"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Engineering Guidelines for Disk Arrays</title>
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" /> -->
    <!--style to display feedback button correctly in IE-->
    <!-- Google Tag Manager -->
    <!-- End Google Tag Manager -->
    <!-- links to get the EDA styling to work -->
    <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Resources/Stylesheets/MainStyles.min.css" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <style>@media screen and (min-width: 0\0)
{
	.feedback-button
	{
		margin-right: -40px;
		top: 50%;
		border-radius: 9px 9px 0px 0px;
	}

	#canvas
	{
		position: relative;
	}
}

@media print
{
	#plugin
	{
		overflow: visible !important;
	}
}

</style>
    <link href="../../Resources/Stylesheets/eda_styles.css" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css"/>
    <style>/*&lt;meta /&gt;*/

.button.print-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.button.previous-topic-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.button.next-topic-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
    <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png"/>
    <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png"/>
    <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png"/>
    <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png"/>
    <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png"/>
    <script src="../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
    <script src="../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    <script src="https://cmp.osano.com/AzZrhlTmT5f216Foa/84ba7dc4-a4e5-4b02-b120-977eb6f052d4/osano.js">
        </script>
    <script type="text/javascript">/*<![CDATA[*/(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-KLSDFH');
		/*]]>*/</script>
    <script type="text/javascript" src="../../Skins/Default/Scripts/TopicToolBar.js">
        </script>
  </head>
  <!-- Top Orange and Darkgrey header-->
  <!-- Div for EDA banner -->
  <div class="eda_banner">
    <p>Register Now for EDA Summit 2024 - Virtual Event <a href="https://edasummit.com/" target="_blank">Register for Free</a></p>
  </div>
  <!-- end Div for EDA banner -->
  <div class="top-nav">
    <div class="main_list">
      <ul class="top-navlinks">
        <li>
          <a href="https://solace.com/support/" target="_blank">Support</a>
        </li>
        <li>
          <a href="https://solace.com/contact/" target="_blank">Contact Us</a>
        </li>
      </ul>
    </div>
    <div class="container-fluid">
      <div class="src-li">
        <div id="srchWrapTwo">
          <form class="search" action="#">
            <div class="search-bar search-bar-container needs-pie">
              <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search the docs"/>
              <div class="search-filter-wrapper">
                <span class="invisible-label" id="search-filters-label">Filter: </span>
                <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                </div>
                <div class="search-filter-content" id="sf-content">
                  <ul>
                    <li>
                      <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001">
                        <span id="filterSelectorLabel-00001">All Files</span>
                      </button>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="search-submit-wrapper" dir="ltr">
                <div class="search-submit" title="Search" role="button" tabindex="0">
                  <span class="invisible-label">Submit Search</span>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <span class="tool-tip" tooltip-position="left" tooltip="To search for CLI commands, events, or APIs, navigate to the related sections.">i</span>
      <!-- Sept. 28, 2022 - This is being moved to under div class= top-nav
			<div class="main_list">
				<ul class="top-navlinks">
					<li><a href="https://solace.com/support/" target="_blank">Support</a></li>
					<li><a href="https://solace.com/contact/" target="_blank">Contact Us</a></li>
				</ul>
			</div> -->
    </div>
    <!-- Sept. 27, 2022 - The commented out content below used to provide the products, company, etc., links in the top header, next to the search field. -->
    <!-- <div class="main_list"><ul class="top-navlinks"><li><a href="https://solace.com/products/" target="_blank">Products</a></li><li><a href="https://solace.com/company/" target="_blank">Company</a></li><li><a href="https://www.solace.dev/" target="_blank">Developers</a></li><li><a href="https://solace.com/support/" target="_blank">Support</a></li><li><a href="https://solace.com/contact/" target="_blank">Contact Us</a></li></ul></div> -->
  </div>
  <body>
    <div class="foundation-wrap off-canvas-wrapper">
      <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
        <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
          <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
        </aside>
        <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
          <div data-sticky-container="" class="title-bar-container">
            <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1000px)" data-mc-ignore="true">
              <a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
              <div class="middle title-bar-section outer-row clearfix">
                <div class="menu-icon-container relative clearfix">
                  <div class="central-account-wrapper">
                    <div class="central-dropdown">
                      <a class="central-account-drop">
                        <span class="central-account-image"/>
                        <span class="central-account-text">Account</span>
                      </a>
                      <div class="central-dropdown-content">
                        <a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                        <hr class="central-separator"/>
                        <a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                      </div>
                    </div>
                  </div>
                  <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas">
                    <span/>
                  </button>
                </div>
              </div>
              <div class="title-bar-layout outer-row">
                <div class="logo-wrapper">
                  <a class="logo" href="../../index.html" alt="Logo"/>
                </div>
                <div class="navigation-wrapper nocontent">
                  <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                    <li class="placeholder" style="visibility:hidden">
                      <a>placeholder</a>
                    </li>
                  </ul>
                </div>
                <div class="central-account-wrapper">
                  <div class="central-dropdown">
                    <a class="central-account-drop">
                      <span class="central-account-image"/>
                      <span class="central-account-text">Account</span>
                    </a>
                    <div class="central-dropdown-content">
                      <a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                      <hr class="central-separator"/>
                      <a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                    </div>
                  </div>
                </div>
                <div class="nav-search-wrapper">
                  <div class="nav-search row">
                    <form class="search" action="#">
                      <div class="search-bar search-bar-container needs-pie">
                        <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search the docs"/>
                        <div class="search-filter-wrapper">
                          <span class="invisible-label" id="search-filters-label">Filter: </span>
                          <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                          <div class="search-filter-content" id="sf-content">
                            <ul>
                              <li>
                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001">
                                  <span id="filterSelectorLabel-00001">All Files</span>
                                </button>
                              </li>
                            </ul>
                          </div>
                        </div>
                        <div class="search-submit-wrapper" dir="ltr">
                          <div class="search-submit" title="Search" role="button" tabindex="0">
                            <span class="invisible-label">Submit Search</span>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </nav>
          </div>
          <div class="main-section">
            <div class="row outer-row sidenav-layout">
              <nav class="sidenav-wrapper">
                <div class="sidenav-container">
                  <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                </div>
              </nav>
              <div class="body-container">
                <div data-mc-content-body="True">
                  <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolBar mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic Print NextTopic;">
                    <div class="button-group-container-left">
                      <button class="button needs-pie print-button" title="Print">
                        <div>
                          <div role="img" class="button-icon-wrapper" aria-label="Print">
                            <div class="button-icon"> </div>
                          </div>
                        </div>
                      </button>
                      <button class="button needs-pie previous-topic-button" title="Navigate previous topic" disabled="true">
                        <div>
                          <div role="img" class="button-icon-wrapper" aria-label="Navigate previous">
                            <div class="button-icon"> </div>
                          </div>
                        </div>
                      </button>
                      <button class="button needs-pie next-topic-button" title="Navigate next topic" disabled="true">
                        <div>
                          <div role="img" class="button-icon-wrapper" aria-label="Navigate next">
                            <div class="button-icon"> </div>
                          </div>
                        </div>
                      </button>
                    </div>
                  </div>
                  <!-- Google Tag Manager (noscript) -->
                  <noscript>
                    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLSDFH" height="0" width="0" style="display:none;visibility:hidden"/>
                  </noscript>
                  <!-- End Google Tag Manager (noscript) -->
                  <div id="content">
                    <div id="contentBody">
                      <div class="row collapse">
                        <div xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="ContentRow">
                          <div>
                            <div xmlns="" class="nocontent">
                              <div class="MCBreadcrumbsBox_MCBreadcrumbsSelf_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" / " data-mc-breadcrumbs-count="4" data-mc-toc="True">
                                <span class="MCBreadcrumbsPrefix"> </span>
                              </div>
                            </div>
                            <div xmlns="" role="main" id="mc-main-content">
                              <h1 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Engineering Guidelines for Disk Arrays</h1>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To attain maximum Guaranteed Messaging rates with Solace PubSub+ appliances, an appropriate external disk array that can support the expected messaging rates must be used. This section provides guidelines for measuring and configuring external disk arrays for use with Solace PubSub+ appliances so that maximum Guaranteed Messaging rates can be achieved.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">This section provides engineering guidelines for disk arrays used for Solace PubSub+ appliances.</p>
                              <div xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Note">
                                <ul>
                                  <li> For best performance and maximum data integrity, it is recommended you use an enterprise grade SSD which supports power loss data protection features.</li>
                                  <li>
                                    <p>As of Solace PubSub+ appliance release <span class="mc-variable Variables.Appliance_Release_Version variable">8.2.0</span>, operations below that state they can only be performed by root, can now also be performed by a Sysadmin User. For information on configuring Sysadmin Users, refer to <a href="../../Admin/Configuring-Multiple-Shell-Users.htm" class="MCXref xref">Configuring Multiple Linux Shell Users</a>.</p>
                                  </li>
                                </ul>
                              </div>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a name="managing_guaranteed_messaging_1810020758_1004477"/>Understanding Guaranteed Messaging Performance</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The maximum performance of the Guaranteed Messaging feature of appliances depends on two major factors:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>The maximum Guaranteed Messaging ingress rates the appliance offers. These rates depend on the appliance type that is used and (if applicable) the model of Assured Deliver Blade (ADB) model it uses. </li>
                                <li>The rate at which the appliance can write received Guaranteed messages to the disk array.</li>
                              </ul>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">When clients are offline or slow, the Guaranteed messages for those clients need to be written to the external disk array. The external disk array must be able to sustain the rate of Guaranteed messages destined for offline or slow clients. Otherwise, the external disk array will constrain Guaranteed Messaging performance.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The absolute maximum performance is limited by the capabilities of the ADB and event broker pairing that is used. If clients never go offline or are not slow, and messages are never written to disk, then the ADB and event broker pairing alone define the Guaranteed Messaging performance of the system. However, in real deployments clients do go offline and are slow. When this happens messages are written to the disk array, and the write performance of the disk array will affect the overall Guaranteed Messaging performance.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For example, if the ADB and appliance combination can support a maximum ingress rate of 4.5 Gbps (563 MBps), and 50% of the clients are offline or slow, then the external disk array must be able to support at least 2.25 Gbps (281 MBps) to achieve the rate provided by the ADB and appliance combination. If not, the external disk array becomes a performance bottleneck and impacts the maximum performance of the Guaranteed Messaging feature.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Using the same ADB and event broker combination, if 100% of the clients are offline or slow, then the disk array must be able to support at least 4.5 Gbps to achieve maximum performance.</p>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a name="managing_guaranteed_messaging_1810020758_1004486"/>Converting Guaranteed Message and Disk Write Rates</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Disk write performance is measured in terms of bandwidth (bytes per second). However, the message rate performance is an often-used performance metric. To calculate the message rate with a known disk write rate, use the following formula:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>messages per second = disk write rate bytes per second / (average message size + overhead)</li>
                              </ul>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The message overhead is typically 144 bytes per message. So, given a disk write rate of 100 MB per second (104,857,600 bytes per second) and a 1,024 average message size, the expected message rate when spooling to disk is the following:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>104,857,600 bytes / (144 bytes + 1,024 bytes) = 89,775 messages per second</li>
                              </ul>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Conversely, given a message rate you want to achieve, you can use the following formula to calculate the required disk write performance:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>disk write rate = messages per second * (average message size + overhead)</li>
                              </ul>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Therefore, if you want to spool 170,000 message per second to disk with an average size of 512 bytes, you need the following disk write rate:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>170,000 message per second * (512 bytes + 144 bytes) = 106 MB per second (111,520,000 bytes per second)</li>
                              </ul>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a name="Measuring"/>Measuring Disk Performance</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Solace provides a soldisktest tool so that you can measure the write performance of an external disk array and determine the available performance for spool to disk scenarios of Guaranteed Messaging. The soldisktest tool uses the same technique for writing messages to disk as the Guaranteed Messaging feature of Solace PubSub+. However, it only provides a simulation and should be regarded as an estimate of the maximum expected write performance. When engineering disk write performance, you should plan for performance at least 10% less than the value provided by soldisktest.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To measure the write performance to the disk array on a primary event broker do the following:</p>
                              <ol xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li value="1">To ensure that the disk array WWN is configured and the operational status is AD-Active, enter the <code>show message-spool</code> User EXEC command:</li>
                                <pre class="Code">solace1(admin-message-spool-vpn)# show message-spool
 
Config Status:                        Enabled (Primary)
Maximum Spool Usage:                    60000 MB
Spool While Charging:                     No
Spool Without Flash Card:                 No
Using Internal Disk:                      No<span style="color: #ff0000;">
Disk Array WWN:             60:06:01:60:4d:30:1c:00:e6:11:60:ec:d2:2e:e0:11
 
Operational Status:                       AD-Active</span>

. . .
</pre>
                                <p>For information on configuring the message spool, see <a href="Configuring-External-Disk-Arrays.htm" class="MCXref xref">Configuring an External Disk Array for Guaranteed Messaging</a>.</p>
                                <li value="2">To ensure that the primary disk partition has enough free space, enter the <code>show disk detail</code> User EXEC command. The <code>/dev/mapper</code> entry that ends with <code>p1</code> is the primary partition.</li>
                                <pre class="Code">solace1(admin-message-spool-vpn)# show disk detail 
Filesystem           1K-blocks      Used Available Use% Mounted on
/dev/md2              19236244   5966332  12292764  33% /
/dev/md1                101018     16769     79033  18% /boot
/dev/md6             199811600 170367716  19294028  90% /usr/sw
none                   7825944        16   7825928   1% /dev/shm<span style="color: #ff0000;">
/dev/mapper/3600601604d301c00e61160ecd22ee011p1
                      17358176    597404  15879008   4% /usr/sw/externalSpool/p1</span>
            
/dev/mapper/3600601604d301c00e61160ecd22ee011p2
                      17358176     77888  16398524   1% /usr/sw/externalSpool/p2
</pre>
                                <li value="3">At the shell prompt, as the root user, run the <code>soldisktest</code> utility, providing the average expected message size to the <code>--msgsize</code> parameter. (Do not account for overhead because it is automatically handled by soldisktest.)</li>
                              </ol>
                              <div xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Note">
                                <ul>
                                  <li>Depending on the performance of the disk array, the command may take several minutes to complete.</li>
                                  <li>The message spool must be configured and AD-Active for the test to run.</li>
                                  <li>By default, soldisktest measures the write performance on the primary disk partition (<code>/usr/sw/externalSpool/p1</code>). To measure the performance of the backup partition, run soldisktest on the backup event broker while in the AD-Active state and set the option <code>--dir=/usr/sw/externalSpool/p2</code>.</li>
                                  <li>By default, soldisktest writes 8 GB to the partition, so ensure that the partition has a sufficient amount of free space. To adjust the amount of data written, use the <code>--total-files</code> option. The test writes files with a size of 8 MB. The default number of files written is 1,000.</li>
                                  <li>To provide accurate results, the event broker must be idle (that is, not actively passing messages).</li>
                                </ul>
                              </div>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">In the following example, the performance for an average message size of 1024 bytes is measured. For this message size, the maximum write rate is 46 Mbps or 41,864 messages per second.</p>
                              <pre xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Code">[root@lab-129-80 support]# soldisktest --msgsize=1024
Using 7182 messages per file, file size = 8388592 bytes
done!
elapsed time = 171.553
bytes written per second = 48897961 = 47751 KBps = 46 MBps
Message rate: 41864 messages per second
Deleting test spool files created
All files deleted.</pre>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a name="managing_guaranteed_messaging_1810020758_1004542"/>Diagnosing External Disk Performance Issues</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">There are two ways to diagnose if the external disk array is a performance bottleneck:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>
                                  <a href="#monitor-IO" class="MCXref xref">Monitoring IO Statistics</a>
                                </li>
                                <li>
                                  <a href="#Monitor-ADB" class="MCXref xref">Monitoring ADB Usage</a>
                                </li>
                              </ul>
                              <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="monitor-IO"/>Monitoring IO Statistics</h3>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">When the external disk array is a bottleneck, the IO utilization for the device mapped to the LUN will be near 100%. You can interactively monitor the IO utilization using the iostat utility.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To use the iostat utility, first determine the name of the device mapped to the LUN using the multipath command while in root shell:</p>
                              <pre xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Code">[root@solace1 support]# multipath -ll
3600601604d301c00e61160ecd22ee011 dm-0 DGC,RAID 10
size=34G features='1 queue_if_no_path' hwhandler='1 emc' wp=rw
|-+- policy='round-robin 0' prio=1 status=active
| `- 8:0:1:0 sde 8:64 active ready running
`-+- policy='round-robin 0' prio=0 status=enabled
  `- 8:0:2:0 sdf 8:80 active ready running</pre>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">This command shows each path to the LUN. On the line that describes the path status (for, example "active"), the device name, which starts with "sd", will also be listed. You want to use the device name listed for the first path. In the example above, the device is "sde".</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To monitor the IO utilization, enter the following command in a root shell:</p>
                              <pre xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Code">iostat -d -x -k 1 &lt;device&gt;</pre>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><u>Where</u> : <code>&lt;device&gt;</code> is the value determined through the multipath command. Note that the first result of the command may not report an accurate utilization value and should be ignored.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The following example output displays a scenario where the disk is a bottleneck:</p>
                              <pre xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Code">[root@lab-129-80 support]#  iostat -d -x -k 1 sde

Linux 3.4.67.solos86 (lab-129-80)       05/16/2014

Device:    rrqm/s wrqm/s   r/s   w/s  rsec/s  wsec/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util
sde          0.00   0.00  0.17  2.42  107.23 1522.71    53.61   761.36   629.16     0.17   66.91   6.27   1.63

Device:    rrqm/s wrqm/s   r/s   w/s  rsec/s  wsec/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util
sde          0.00   0.00  0.00 117.82    0.00 101631.68     0.00 50815.84   862.59    15.92  150.89   8.40  99.01

Device:    rrqm/s wrqm/s   r/s   w/s  rsec/s  wsec/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util
sde          0.00   0.00  0.00 115.15    0.00 94351.52     0.00 47175.76   819.37    27.81  160.92   8.11  93.33

Device:    rrqm/s wrqm/s   r/s   w/s  rsec/s  wsec/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util
sde          0.00   0.00  0.00 99.01    0.00 83778.22     0.00 41889.11   846.16    17.88  261.31   9.24  91.49

Device:    rrqm/s wrqm/s   r/s   w/s  rsec/s  wsec/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util
sde          0.00   0.00  0.00 107.00    0.00 92448.00     0.00 46224.00   864.00    14.54  153.07   8.71  93.20

Device:    rrqm/s wrqm/s   r/s   w/s  rsec/s  wsec/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util
sde          0.00   0.00  0.00 120.20    0.00 99539.39     0.00 49769.70   828.10    16.33  122.27   8.28  99.49</pre>
                              <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Monitor-ADB"/>Monitoring ADB Usage</h3>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The amount of messages on the ADB can indicate a disk performance bottleneck. If the ADB is always full, it indicates that messages cannot be written to disk as fast as they are being put into the ADB. In a busy system without a disk performance bottleneck, the ADB will be approximately 50% full.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To determine if the ADB is full, enter the <b>show message-spool </b>User EXEC command to view Guaranteed Messaging message status and usage. </p>
                              <pre xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Code">solace# show message-spool

Config Status:                            Enabled (Primary)
Maximum Spool Usage:                      60000 MB

. . .
<span style="color: #ff0000;">
                                              ADB        Disk          Total
Current Persistent Store Usage (MB)     1093.8263   2435.9131      3529.7394
Number of Messages Currently Spooled        57348      127712         185060</span></pre>
                              <div xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Note">
                                <p>In the displayed output, examine the "Number of Messages Currently Spooled" and "Current Persistent Store Usage (MB)" entries in the ADB column (not the Disk column). When there is a disk-related bottleneck, one or both of these values will continuously be near their maximum values: </p>
                                <ul>
                                  <li>Maximum number of messages is approximately 4,200,000. For smaller message sizes, when the disk is a bottleneck the number of messages on the ADB will approach the maximum.</li>
                                  <li>Maximum persistent store usage is 3,300 MB for ADB-04210M and 1,100 MB for ADB-000000-01/ADB-000000-02. For larger message sizes, the current persistent store usage on the ADB will approach the maximum when the disk is a bottleneck.</li>
                                </ul>
                              </div>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a name="managing_guaranteed_messaging_1810020758_1004620"/>Considerations for Optimal Disk Array Performance</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">When configuring a disk array to use with a Solace PubSub+ event broker using Guaranteed Messaging, consider the following items:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>Disk Array Write Caching&#x2014;Disk arrays with built-in battery-backed write caches are able to perform at higher levels than disk arrays without write caches. </li>
                                <li>Disk RPMs&#x2014;The use of 10,000 RPM or 15,000 RPM disks is recommended because hard disks that spin at higher RPMs are better able to sustain high rates of messaging activity. Faster hard disks are generally more important when trying to improve unspooling performance than spool-to-disk performance. </li>
                                <li>RAID Levels&#x2014;The performance of LUNs using RAID 5/6 is significantly lower than RAID 1/10. Therefore, Solace strongly recommends using storage in RAID 10 mode to avoid performance degradation caused by partial writes to stripes in RAID 5/6 modes. </li>
                                <li>Number of Disks in the RAID Group&#x2014;Some disk arrays will experience performance degradation with additional disks in the RAID group for LUNs. The number of disks that an array can support without experiencing performance degradation varies widely from vendor to vendor. Consult the performance recommendation documents for your disk array for determining maximum performance. </li>
                                <li>Disk Partition Sector Alignment&#x2014;Misaligned disk partitions can significantly degrade performance with most disk arrays.
        <p>This issue can be diagnosed by examining the start and end sectors of the partition table using the gdisk command. That is, run the gdisk utility on the external disk device, enter the "p" command to view the partition table in sector units. </p><div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="#" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" aria-expanded="false"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open"/>Example: </a></span><div class="MCDropDownBody dropDownBody"><pre class="Code">[root@solace ~]# gdisk /dev/mapper/36001405f6bd73860d76412eab3a4a006
GPT fdisk (gdisk) version 0.8.9
Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.

Command (? for help): p
Disk /dev/mapper/36001405f6bd73860d76412eab3a4a006: 31251759104 sectors, 14.6 TiB
Logical sector size: 512 bytes
Disk identifier (GUID): A9717400-24DF-4D26-95FE-92F8BF4FBF7B
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 31251759070
Partitions will be aligned on 2048-sector boundaries
Total free space is 4061 sectors (2.0 MiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048     15625879552   7.3 TiB     8300  Linux filesystem
   2     15625881600     31251759070   7.3 TiB     8300  Linux filesystem

Command (? for help): q
[root@solace ~]#</pre></div></div><p>For information on how to partition a disk array with proper sector alignment, see <a href="Configuring-External-Disk-Arrays.htm" class="MCXref xref">Configuring an External Disk Array for Guaranteed Messaging</a>.</p></li>
                                <li>Host Bus Adapter Link Speed&#x2014;In high-performance configurations, sustained spool to disk activity requires an 8 Gbps fiber channel link. Host Bus Adapters that support 8 Gbps fiber channel links are available on some event broker models. To accommodate peak messaging rates, it is strongly recommended that you deploy 8 Gbps fiber channel links throughout.</li>
                                <li>Thin provisioning of the LUN&#xA0;from the appliance is currently not supported.</li>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="no-print">
                      <div>
                        <a href="#" id="docsFeedbackTrigger" class="docs-issue-collector">Provide feedback</a>
                      </div>
                    </div>
                    <footer class="my-4 pt-4 text-center no-print">
                      <div class="footer-txt text-center no-print">
                        <ul class="list-inline ">
                          <li class="list-inline-item text-muted"><a href="../../Resources/Documentation-Set.htm" class="doc-set-footer-link MCXref xref xrefdoc-set-footer-link">Documentation Coverage</a>: <span class="mc-variable Variables.DocumentSetNumber variable">2024.09.18.0001</span></li>
                          <li class="list-inline-item text-muted">Last Updated: <span class="mc-variable Variables.MonthDayYear variable">September 18, 2024</span></li>
                          <li class="list-inline-item text-muted" style="font-size:13px;"> &#xA9;  <span class="mc-variable Variables.CompanyNameLegal variable">Solace Corporation</span></li>
                        </ul>
                      </div>
                      <div class="footer-icons">
                        <ul class="list-inline">
                          <li class="list-inline-item">
                            <a href="https://facebook.com/solacedotcom" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/facebook_22x21.png" class="Hyperlinked" alt="Facebook" title="Solace Facebook Page" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://www.linkedin.com/company/20219" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/LinkedIn_22x21.png" class="Hyperlinked" alt="LinkedIn" title="Solace LinkedIn Page" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://twitter.com/solacedotcom" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/Twitter_22x21.png" class="Hyperlinked" alt="Twitter" title="Solace Twitter Feed" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://www.youtube.com/user/SolaceSystems" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/youtube_22x21.png" class="Hyperlinked" alt="YouTube" title="Solace YouTube Channel" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://www.instagram.com/solacedotcom/" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/instagram_22x21.png" class="Hyperlinked" alt="Instagram" title="Solace Instagram Feed" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://medium.com/solacedotcom" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/medium_22x21.png" class="Hyperlinked" alt="Medium" title="Solace Medium Blog" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                        </ul>
                      </div>
                      <div class="footer_link_menu">
                        <ul class="link_list">
                          <li class="link_list_item">
                            <a href="https://solace.com/products/" target="_blank" class="footer-link">Products</a>
                          </li>
                          <li class="link_list_item">
                            <a href="https://solace.com/company/" target="_blank" class="footer-link">Company</a>
                          </li>
                          <li class="link_list_item">
                            <a href="https://www.solace.dev/" target="_blank" class="footer-link">Developers</a>
                          </li>
                          <li class="link_list_item">
                            <a href="https://solace.com/support/" target="_blank" class="footer-link">Support</a>
                          </li>
                          <li class="link_list_item">
                            <a href="https://solace.com/contact/" target="_blank" class="footer-link">Contact Us</a>
                          </li>
                        </ul>
                      </div>
                    </footer>
                  </div>
                  <!-- JIRA issue collector -->
                  <script>/*<![CDATA[*/// Requires jQuery!
jQuery.ajax({
    url: "https://sol-jira.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e-T/o2joag/b/24/e73395c53c3b10fde2303f4bf74ffbf6/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-US&collectorId=076e0808",
    type: "get",
    cache: true,
    dataType: "script"
});
window.ATL_JQ_PAGE_PROPS = {
"triggerFunction": function(showCollectorDialog) {
//Requires that jQuery is available!
$("#docsFeedbackTrigger").click(function(e) {
e.preventDefault();
showCollectorDialog();
});
},
fieldValues: {
recordWebInfo: '1', // field Name
recordWebInfoConsent: ['1'] // field Id
}
};
/*]]>*/</script>
                  <script src="../../Resources/Scripts/thumbnail.js">
                                    </script>
                  <!-- Script for Launching offsite links in new tab -->
                  <script type="text/javascript">/*<![CDATA[*/$("a[href^='http']").attr("target","_blank");/*]]>*/</script>
                </div>
              </div>
            </div>
          </div>
          <a data-close="true"/>
        </div>
      </div>
    </div>
  </body>
</html>
