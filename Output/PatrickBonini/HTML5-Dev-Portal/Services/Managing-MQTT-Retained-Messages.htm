<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../" data-mc-has-content-body="True" data-mc-toc-path="[%=System.LinkedTitle%]|MQTT Messaging Management" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../Skins/Favicons/browserconfig.xml" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="apple-touch-icon" sizes="180x180" href="../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta http-equiv="Cache-control" content="no-cache" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Managing MQTT Retained Messages</title>
        <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" /> -->
        <!--style to display feedback button correctly in IE-->
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <!-- links to get the EDA styling to work -->
        <link href="../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/MainStyles.min.css" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <style>@media screen and (min-width: 0\0)
{
	.feedback-button
	{
		margin-right: -40px;
		top: 50%;
		border-radius: 9px 9px 0px 0px;
	}

	#canvas
	{
		position: relative;
	}
}

@media print
{
	#plugin
	{
		overflow: visible !important;
	}
}

</style>
        <link href="../Resources/Stylesheets/eda_styles.css" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css" />
        <style>/*&lt;meta /&gt;*/

.button.print-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.button.previous-topic-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.button.next-topic-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.needs-pie
{
	behavior: url('../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link rel="apple-touch-icon" sizes="180x180" href="../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/favicon-16x16.png" />
        <script src="../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script src="https://cmp.osano.com/AzZrhlTmT5f216Foa/84ba7dc4-a4e5-4b02-b120-977eb6f052d4/osano.js">
        </script>
        <script type="text/javascript">/*<![CDATA[*/(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-KLSDFH');
		/*]]>*/</script>
        <script type="text/javascript" src="../Skins/Default/Scripts/TopicToolBar.js">
        </script>
    </head>
    <!-- Top Orange and Darkgrey header-->
    <!-- Div for EDA banner -->
    <div class="eda_banner">
        <p>Register Now for EDA Summit 2024 - Virtual Event <a href="https://edasummit.com/" target="_blank">Register for Free</a></p>
    </div>
    <!-- end Div for EDA banner -->
    <div class="top-nav">
        <div class="main_list">
            <ul class="top-navlinks">
                <li><a href="https://solace.com/support/" target="_blank">Support</a>
                </li>
                <li><a href="https://solace.com/contact/" target="_blank">Contact Us</a>
                </li>
            </ul>
        </div>
        <div class="container-fluid">
            <div class="src-li">
                <div id="srchWrapTwo">
                    <form class="search" action="#">
                        <div class="search-bar search-bar-container needs-pie">
                            <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search the docs" />
                            <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                </div>
                                <div class="search-filter-content" id="sf-content">
                                    <ul>
                                        <li>
                                            <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="search-submit-wrapper" dir="ltr">
                                <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div><span class="tool-tip" tooltip-position="left" tooltip="To search for CLI commands, events, or APIs, navigate to the related sections.">i</span>
            <!-- Sept. 28, 2022 - This is being moved to under div class= top-nav
			<div class="main_list">
				<ul class="top-navlinks">
					<li><a href="https://solace.com/support/" target="_blank">Support</a></li>
					<li><a href="https://solace.com/contact/" target="_blank">Contact Us</a></li>
				</ul>
			</div> -->
        </div>
        <!-- Sept. 27, 2022 - The commented out content below used to provide the products, company, etc., links in the top header, next to the search field. -->
        <!-- <div class="main_list"><ul class="top-navlinks"><li><a href="https://solace.com/products/" target="_blank">Products</a></li><li><a href="https://solace.com/company/" target="_blank">Company</a></li><li><a href="https://www.solace.dev/" target="_blank">Developers</a></li><li><a href="https://solace.com/support/" target="_blank">Support</a></li><li><a href="https://solace.com/contact/" target="_blank">Contact Us</a></li></ul></div> -->
    </div>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1000px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../index.html" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search the docs" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolBar mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic Print NextTopic;">
                                        <div class="button-group-container-left">
                                            <button class="button needs-pie print-button" title="Print">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Print">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                            <button class="button needs-pie previous-topic-button" title="Navigate previous topic" disabled="true">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Navigate previous">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                            <button class="button needs-pie next-topic-button" title="Navigate next topic" disabled="true">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Navigate next">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLSDFH" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <div id="content">
                                        <div id="contentBody">
                                            <div class="row collapse">
                                                <div class="ContentRow" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                    <div>
                                                        <div class="nocontent" xmlns="">
                                                            <div class="MCBreadcrumbsBox_MCBreadcrumbsSelf_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" / " data-mc-breadcrumbs-count="4" data-mc-toc="True"><span class="MCBreadcrumbsPrefix"> </span>
                                                            </div>
                                                        </div>
                                                        <div role="main" id="mc-main-content" xmlns="">
                                                            <h1 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Managing MQTT&#160;Retained Messages</h1>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Using MQTT retained messages allows publishing MQTT clients to indicate that a message must be stored for later delivery to subscribing clients when those subscribing clients add subscriptions matching the retained message’s topic. For a given topic, the event broker preserves the last message published on that topic with the retain bit set. On <span class="mc-variable Variables.CompanyName variable">Solace</span> <span class="mc-variable Product-Names.pubsub_brand_only variable">PubSub+</span> event brokers, retained messages are preserved in special <a href="../Additional-Products/Solace-PubSub-Cache/PubSub-Cache-Overview.htm" class="MCXref xref">PubSub+ Cache</a> cache clusters called MQTT&#160;retain caches. </p>
                                                            <p class="Caution" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Support for&#160;MQTT Retained Messages is a Controlled Availability (CA) feature. Please <a href="../get-support.htm" class="link-internal">contact Solace</a> to find out if this feature is supported for your use case.</p>
                                                            <h2 class="with-rule" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Prerequisites"></a>Prerequisites </h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Before an event broker can process MQTT&#160;retained messages, the following is required:</p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li>The appropriate amount of  memory must be allocated to the event broker to support retained messages. For more information, see <a href="#Retain_Mem_Consider" class="MCXref xref">MQTT&#160;Retained Message Memory Usage Considerations</a>.</li>
                                                                <li>If the event broker is deployed in a redundant configuration, a pre-shared authentication key must be configured for all event brokers in the deployment. For more information, see <a href="../Features/HA-Redundancy/Pre-Shared-Keys-SMB.htm" class="MCXref xref">Pre-Shared Authentication Keys for Software Event Brokers</a> for the software event broker, or to <a href="../Features/HA-Redundancy/Pre-Shared-Keys-Appl.htm" class="MCXref xref">Pre-Shared Authentication Keys for Appliances</a> for the appliance.</li>
                                                                <li> Appliances that are configured in high-availability (HA) redundant pairs must have their redundancy role configured as <code>primary</code> or <code>backup</code>.For more information, see <a href="../Features/HA-Redundancy/Configuring-Appliance-Redundancy-Parameters.htm#assign-active-standby-role" class="MCXref xref">Assigning the Active/Standby Role</a>.</li>
                                                                <li>The message backbone must be enabled on the event broker.&#160;For more information, see <a href="Managing-Services.htm#Enable-All-Services" class="MCXref xref">Enabling All Messaging Services</a></li>
                                                                <li>The SMF service must be enabled on the event broker.  For more information, see <a href="Managing-Services.htm#Enable-SMF" class="MCXref xref">Enabling System-Level SMF Service</a>.</li>
                                                                <li>An MQTT&#160;retain cache must be created and enabled on the event broker. For more information, see  <a href="#Retain_Config" class="MCXref xref">MQTT Retain Cache Configuration</a>.</li>
                                                            </ul>
                                                            <h2 class="with-rule" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Limitations"></a>Limitations</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Solace PubSub+ event brokers support MQTT&#160;retained messages with the following limitations: </p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li>Using retained messages on an appliance requires chassis variant CHS-3560AC-06-A or later.</li>
                                                                <li>Retained messages are supported only for DMR and bridges.  MNR is not supported.</li>
                                                                <li>
                                                                    <p>The event broker's transport mechanism for retained messages is equivalent to QoS 0, although it has the ability to retain QoS 1 messages. This means:</p>
                                                                    <ul>
                                                                        <li>
                                                                            <p>QoS 1 messages can be retained even though the event broker did not accept the published message.</p>
                                                                        </li>
                                                                        <li>
                                                                            <p>QoS 1 messages sent by the retain cache to clients may be lost. The following is a list of factors that may contribute to QoS 1 retained messages loss:</p>
                                                                            <ul>
                                                                                <li>The burst size of retained messages directed towards the client due to large batches of subscriptions and/or addition of wildcard subscriptions covering a large number of retained messages.</li>
                                                                                <li>The available space remaining on the message-spool and/or the client's QoS 1 queue when a burst of retained messages is queued towards the client.</li>
                                                                                <li>The speed at which the client is able to receive messages. If the client can consume messages faster than the retained messages are queued to the client, little stress is placed on the message-spool and/or queue capacity limits in response to a burst of retained messages.</li>
                                                                            </ul>
                                                                        </li>
                                                                    </ul>
                                                                </li>
                                                            </ul>
                                                            <h2 class="with-rule" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Retain_Mem_Consider"></a>MQTT&#160;Retained Message Memory Usage Considerations</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Enabling a PubSub+ event broker to process retained messages consumes additional system memory beyond what is normally required.  The amount of additional  memory  depends on the number and length of topics, and the payload of the retained messages the event broker needs to support.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For any reasonable retained message use case, a PubSub+ software event broker requires a minimum of an extra 2 GB&#160;of memory to process retained messages. More memory may be required if the retained messages are large, or if the use case has a very large number of retained messages. Solace recommends that you test and monitor your deployment for memory use and adjust the allocation as necessary. </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For example, suppose you are creating a <span class="mc-variable Product-Names.pubsub_brand_only variable">PubSub+</span> software event broker  that would normally require 4 GB of memory (based on the maximum number of client connections). If this event broker needs to process retained messages, you must reserve an additional 2 GB of memory (at minimum) on the host  to process these messages. </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">After you've reserved this additional memory, you can allocate it by configuring a  maximum shared pool of memory for all retain caches on the event broker. For more information, see <![CDATA[  ]]><a href="#Retain_Mem_Config_Global" class="MCXref xref">MQTT&#160;Retain Cache Shared Memory Configuration</a>. </p>
                                                            <h2 class="with-rule" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Retain_Redundant"></a>MQTT&#160;Retained Messages in Redundant  Event Broker Deployments</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Consider the following when using retained messages in redundant event broker deployments:</p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li>Before you can use retained messages in redundant  deployments, you must set a pre-shared authentication key on each event broker. For more information, see <a href="../Features/HA-Redundancy/Pre-Shared-Keys-SMB.htm" class="MCXref xref">Pre-Shared Authentication Keys for Software Event Brokers</a> for the software event broker, or to <a href="../Features/HA-Redundancy/Pre-Shared-Keys-Appl.htm" class="MCXref xref">Pre-Shared Authentication Keys for Appliances</a> for the appliance.</li>
                                                                <li>Retained messages are not supported in active/active deployments.</li>
                                                                <li>In any scenario where the primary event broker goes offline, the act of re-establishing the connection to the network (now on the backup), results in re-delivery of all retained messages appropriate to the topic subscriptions for each client.  The failover process may also result in the potential for multiple deliveries of retained messages.</li>
                                                            </ul>
                                                            <h2 class="with-rule" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Retain_Mem_Config_Global"></a>MQTT&#160;Retain Cache Shared Memory Configuration</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"> You can configure the  global maximum allowed memory for all MQTT&#160;retain caches on the broker. If the maximum memory is reached, all arriving&#160;retained messages are discarded. By default, no memory is allocated for software event brokers, which means all arriving&#160;retained messages are discarded. 1024 MB is allocated for appliances.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To configure the global maximum allowed memory for retain caches, enter the following commands:</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">solace(configure)# mqtt<br />solace(configure/mqtt)# retain<br />solace(configure/mqtt/retain)# max-memory &lt;megabytes&gt;</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><u>Where</u>:</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;megabytes&gt;</code> is the  number of megabytes allocated as a shared pool for all&#160;retain caches on the broker. The no version of this command returns the value to the default. </p>
                                                            <h2 class="with-rule" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Retain_Config"></a>MQTT Retain Cache Configuration</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">MQTT&#160;retain caches are configured on a per Message VPN basis. Each retain cache processes all retained messages for the Message VPN. </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">When you create a retain cache, a number of ancillary <span class="mc-variable Product-Names.pubsub_cache variable">PubSub+ Cache</span> objects are also created. For more information, see <a href="../API/MQTT/Using-MQTT.htm#Retain_Cache_Objects" class="MCXref xref">Using MQTT</a>.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">On software event brokers, before you can enable a retain cache you must configure the global maximum allowed memory for all retain caches on the event broker. For more information, see  <a href="#Retain_Mem_Config_Global" class="MCXref xref">MQTT&#160;Retain Cache Shared Memory Configuration</a>. </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">You must disable a retain cache  before you can remove it. When you remove a  retain cache, all retained messages are lost and all in flight and subsequent  requests are ignored.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To create an MQTT&#160;retain cache, enter the following commands:</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">solace(configure)# message-vpn &lt;vpn-name&gt;<br />solace(configure/message-vpn)# mqtt<br />solace(configure/message-vpn/mqtt)# retain<br />solace(configure/message-vpn/mqtt/retain)# create cache &lt;retain-cache-name&gt;</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To modify an existing retain cache, enter the following command.</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">solace(configure/message-vpn/mqtt/retain)# cache &lt;cache-name&gt;</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To enable a&#160;retain cache, enter the following command:</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">solace(configure/message-vpn/mqtt/retain/cache)# no shutdown</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><u>Where</u>:</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;cache-name&gt;</code> is the name of the retain cache you want to configure. </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">The configuration tasks you can perform for an existing retain cache include:</p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li><a href="#Retain_TTL_Config_VPN" class="MCXref xref">Configuring the Retained Message Lifetime</a>
                                                                </li>
                                                            </ul>
                                                            <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Retain_TTL_Config_VPN"></a>Configuring the Retained Message Lifetime</h3>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">You can configure the length of time you want messages to persist in an MQTT&#160;retain cache.  If a message remains cached for the duration of its lifetime, the retain cache removes the message. By default, no limit is configured. </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To configure the retained message lifetime for a retain cache enter the following commands:</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">solace(configure/message-vpn/mqtt/retain/cache)# message-lifetime &lt;seconds&gt;</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><u>Where</u>:</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;seconds&gt;</code> is the lifetime of the message in seconds. A&#160;lifetime of 0 results in the message being retained indefinitely. The no version of this command returns the value to the default. </p>
                                                            <h2 class="with-rule" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Retain_Monitor"></a>Monitoring MQTT&#160;Retain Caches</h2>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">This section provides some examples showing how to monitor MQTT&#160;retain caches on your PubSub+ event broker.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">There are two ways to do this:</p>
                                                            <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                                                <li>The recommended way to monitor retain caches is with <a href="../Admin/Broker-Manager/PubSub-Manager-Overview.htm" class="MCXref xref">PubSub+ Broker Manager</a>. After logging in, select a Message VPN and navigate to <b>Caches</b> &gt; <b>MQTT&#160;Retain Cache</b>.</li>
                                                                <li>Alternatively, you can monitor retain caches via Solace CLI, for more information, see the following sections.</li>
                                                            </ul>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Because <span class="mc-variable Product-Names.pubsub_cache variable">PubSub+ Cache</span> is the underlying mechanism  used to manage retained messages, in addition to the sections below, see  <a href="../Additional-Products/Solace-PubSub-Cache/Monitoring-PubSub-Cache.htm" class="MCXref xref">Monitoring PubSub+ Cache</a> for general information about monitoring <span class="mc-variable Product-Names.pubsub_cache variable">PubSub+ Cache</span> components.</p>
                                                            <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Displayi"></a>Displaying General MQTT&#160;Retain Cache Information</h3>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To display general information about an MQTT&#160;retain cache, enter the following command:</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">show message-vpn &lt;message-vpn&gt; mqtt retain cache &lt;cache-name&gt; [detail]</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><u>Where</u>:</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;message-vpn&gt;</code> is the name of the Message VPN where the  retain cache resides.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;cache-name&gt;</code> is the name of the&#160;retain cache you want to monitor. </p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>detail</code> displays detailed information about the  retain cache, including the names of <span class="mc-variable Product-Names.pubsub_cache variable">PubSub+ Cache</span> objects created to support the retain cache. For more information about these objects, see <a href="../API/MQTT/Using-MQTT.htm#Retain_Cache_Objects" class="MCXref xref">Using MQTT</a>.</p>
                                                            <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Displaying Retain Cache  Statistics</h3>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To display statistics about an MQTT&#160;retain cache, including memory and CPU&#160;usage, enter the following command:</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">show cache-instance &lt;name&gt; message-vpn &lt;vpn-name&gt; remote status</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><u>Where</u>:</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;name&gt;</code> is the name of the <span class="mc-variable Product-Names.pubsub_cache variable">PubSub+ Cache</span> instance created to support the retain cache. For more information, see <a href="../API/MQTT/Using-MQTT.htm#Retain_Cache_Objects" class="MCXref xref">Using MQTT</a>.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;vpn-name&gt;</code> is the name of the Message VPN where the  retain cache resides.</p>
                                                            <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Displaying Retain Cache Topics</h3>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To display the list of topics a MQTT&#160;retain cache is subscribed to, enter the following command:</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">show cache-instance &lt;name&gt; message-vpn &lt;vpn-name&gt; remote topics</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><u>Where</u>:</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;name&gt;</code> is the name of the <span class="mc-variable Product-Names.pubsub_cache variable">PubSub+ Cache</span> instance created to support the retain cache. For more information, see <a href="../API/MQTT/Using-MQTT.htm#Retain_Cache_Objects" class="MCXref xref">Using MQTT</a>.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;vpn-name&gt;</code> is the name of the Message VPN where the  retain cache resides.</p>
                                                            <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Clearing Retain Cache Statistics</h3>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To clear MQTT&#160;retain cache statistics, enter the following command:</p>
                                                            <p class="Code" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">clear cache-instance &lt;name&gt; message-vpn &lt;vpn-name&gt; stats</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><u>Where</u>:</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;name&gt;</code> is the name of the <span class="mc-variable Product-Names.pubsub_cache variable">PubSub+ Cache</span> instance created to support the retain cache. For more information, see <a href="../API/MQTT/Using-MQTT.htm#Retain_Cache_Objects" class="MCXref xref">Using MQTT</a>.</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><code>&lt;vpn-name&gt;</code> is the name of the Message VPN where the  retain cache resides.</p>
                                                            <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Retain Cache Events</h3>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">For a complete list of MQTT&#160;retain cache events, see the <i>PubSub+ Cache syslog Message</i> section in the <a href="../Monitoring/PubSub-Event-Reference.htm" class="MCXref xref">Syslog Event Reference</a>.</p>
                                                            <h3 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a name="Verify_Caches_Sync"></a>Verifying Retain Cache Redundancy</h3>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To verify that a retain cache is redundant (for example, to make sure no messages are lost on upgrade), you must verify that the corresponding primary and backup cache instances are synchronized. This must be verified for all message VPNs on which a retain cache has been configured (and is expected to be operational).</p>
                                                            <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To verify that the primary and backup cache instances are synchronized, enter the following command and confirm that each cache instance is operational:</p><pre class="Code" xml:space="preserve" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">show message-vpn * mqtt retain cache * detail
		</pre>
                                                            <div class="MCDropDown MCDropDown_Closed dropDown" xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><span class="MCDropDownHead dropDownHead"><a href="#" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" aria-expanded="false"><img class="MCDropDown_Image_Icon" src="../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example Output</a></span>
                                                                <div class="MCDropDownBody dropDownBody"><pre class="Code">
Name                            : default
Message VPN                     : default
Enabled                         : yes
Operational                     : yes
Failure Reason                : N/A
Uptime                        : 42s

Primary
Cache Instance                : #retain-cache-instance-solace-primary
<b>Operational                   : yes</b>         
Failure Reason                : N/A
Uptime                        : 42s
Backup
Cache Instance                : #retain-cache-instance-solace-backup
<b>Operational                   : yes</b><![CDATA[         ]]>
Failure Reason                : N/A
Uptime                        : 40s

Distributed Cache               : #retain-cache-solace
Cache Cluster                   : #retain-cache-cluster

Message Lifetime (s)            : Unlimited</pre>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="no-print">
                                            <div><a href="#" id="docsFeedbackTrigger" class="docs-issue-collector">Provide feedback</a>
                                            </div>
                                        </div>
                                        <footer class="my-4 pt-4 text-center no-print">
                                            <div class="footer-txt text-center no-print">
                                                <ul class="list-inline ">
                                                    <li class="list-inline-item text-muted"><a href="../Resources/Documentation-Set.htm" class="doc-set-footer-link MCXref xref xrefdoc-set-footer-link">Documentation Coverage</a>: <span class="mc-variable Variables.DocumentSetNumber variable">2024.09.16.0001</span></li>
                                                    <li class="list-inline-item text-muted">Last Updated: <span class="mc-variable Variables.MonthDayYear variable">September 16, 2024</span></li>
                                                    <li class="list-inline-item text-muted" style="font-size:13px;"> ©  <span class="mc-variable Variables.CompanyNameLegal variable">Solace Corporation</span></li>
                                                </ul>
                                            </div>
                                            <div class="footer-icons">
                                                <ul class="list-inline">
                                                    <li class="list-inline-item"><a href="https://facebook.com/solacedotcom" target="_blank" class="social-media-icon"><img src="../Resources/Images/Social-Media/facebook_22x21.png" class="Hyperlinked" alt="Facebook" title="Solace Facebook Page" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://www.linkedin.com/company/20219" target="_blank" class="social-media-icon"><img src="../Resources/Images/Social-Media/LinkedIn_22x21.png" class="Hyperlinked" alt="LinkedIn" title="Solace LinkedIn Page" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://twitter.com/solacedotcom" target="_blank" class="social-media-icon"><img src="../Resources/Images/Social-Media/Twitter_22x21.png" class="Hyperlinked" alt="Twitter" title="Solace Twitter Feed" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://www.youtube.com/user/SolaceSystems" target="_blank" class="social-media-icon"><img src="../Resources/Images/Social-Media/youtube_22x21.png" class="Hyperlinked" alt="YouTube" title="Solace YouTube Channel" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://www.instagram.com/solacedotcom/" target="_blank" class="social-media-icon"><img src="../Resources/Images/Social-Media/instagram_22x21.png" class="Hyperlinked" alt="Instagram" title="Solace Instagram Feed" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                    <li class="list-inline-item"><a href="https://medium.com/solacedotcom" target="_blank" class="social-media-icon"><img src="../Resources/Images/Social-Media/medium_22x21.png" class="Hyperlinked" alt="Medium" title="Solace Medium Blog" style="width: 22;height: 21;" /></a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="footer_link_menu">
                                                <ul class="link_list">
                                                    <li class="link_list_item"><a href="https://solace.com/products/" target="_blank" class="footer-link">Products</a>
                                                    </li>
                                                    <li class="link_list_item"><a href="https://solace.com/company/" target="_blank" class="footer-link">Company</a>
                                                    </li>
                                                    <li class="link_list_item"><a href="https://www.solace.dev/" target="_blank" class="footer-link">Developers</a>
                                                    </li>
                                                    <li class="link_list_item"><a href="https://solace.com/support/" target="_blank" class="footer-link">Support</a>
                                                    </li>
                                                    <li class="link_list_item"><a href="https://solace.com/contact/" target="_blank" class="footer-link">Contact Us</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </footer>
                                    </div>
                                    <!-- JIRA issue collector -->
                                    <script>/*<![CDATA[*/// Requires jQuery!
jQuery.ajax({
    url: "https://sol-jira.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e-T/o2joag/b/24/e73395c53c3b10fde2303f4bf74ffbf6/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-US&collectorId=076e0808",
    type: "get",
    cache: true,
    dataType: "script"
});
window.ATL_JQ_PAGE_PROPS = {
"triggerFunction": function(showCollectorDialog) {
//Requires that jQuery is available!
$("#docsFeedbackTrigger").click(function(e) {
e.preventDefault();
showCollectorDialog();
});
},
fieldValues: {
recordWebInfo: '1', // field Name
recordWebInfoConsent: ['1'] // field Id
}
};
/*]]>*/</script>
                                    <script src="../Resources/Scripts/thumbnail.js">
                                    </script>
                                    <!-- Script for Launching offsite links in new tab -->
                                    <script type="text/javascript">/*<![CDATA[*/$("a[href^='http']").attr("target","_blank");/*]]>*/</script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>