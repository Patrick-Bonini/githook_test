<?xml version="1.0"?>
<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-toc-path="[%=System.LinkedTitle%]|Procedures for Switching Replication Service Between Sites" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png"/>
    <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png"/>
    <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png"/>
    <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png"/>
    <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png"/>
    <meta charset="utf-8"/>
    <meta http-equiv="Cache-control" content="no-cache"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Performing an Uncontrolled Failover</title>
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" /> -->
    <!--style to display feedback button correctly in IE-->
    <!-- Google Tag Manager -->
    <!-- End Google Tag Manager -->
    <!-- links to get the EDA styling to work -->
    <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True"/>
    <link href="../../Resources/Stylesheets/MainStyles.min.css" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <style>@media screen and (min-width: 0\0)
{
	.feedback-button
	{
		margin-right: -40px;
		top: 50%;
		border-radius: 9px 9px 0px 0px;
	}

	#canvas
	{
		position: relative;
	}
}

@media print
{
	#plugin
	{
		overflow: visible !important;
	}
}

</style>
    <link href="../../Resources/Stylesheets/eda_styles.css" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css"/>
    <style>/*&lt;meta /&gt;*/

.button.print-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.button.previous-topic-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.button.next-topic-button
{
	-pie-background: linear-gradient(#ffffff, transparent);
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
    <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png"/>
    <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png"/>
    <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png"/>
    <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png"/>
    <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png"/>
    <script src="../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
    <script src="../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
    <script src="../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    <script src="https://cmp.osano.com/AzZrhlTmT5f216Foa/84ba7dc4-a4e5-4b02-b120-977eb6f052d4/osano.js">
        </script>
    <script type="text/javascript">/*<![CDATA[*/(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
			})(window,document,'script','dataLayer','GTM-KLSDFH');
		/*]]>*/</script>
    <script type="text/javascript" src="../../Skins/Default/Scripts/TopicToolBar.js">
        </script>
  </head>
  <!-- Top Orange and Darkgrey header-->
  <!-- Div for EDA banner -->
  <div class="eda_banner">
    <p>Register Now for EDA Summit 2024 - Virtual Event <a href="https://edasummit.com/" target="_blank">Register for Free</a></p>
  </div>
  <!-- end Div for EDA banner -->
  <div class="top-nav">
    <div class="main_list">
      <ul class="top-navlinks">
        <li>
          <a href="https://solace.com/support/" target="_blank">Support</a>
        </li>
        <li>
          <a href="https://solace.com/contact/" target="_blank">Contact Us</a>
        </li>
      </ul>
    </div>
    <div class="container-fluid">
      <div class="src-li">
        <div id="srchWrapTwo">
          <form class="search" action="#">
            <div class="search-bar search-bar-container needs-pie">
              <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search the docs"/>
              <div class="search-filter-wrapper">
                <span class="invisible-label" id="search-filters-label">Filter: </span>
                <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                </div>
                <div class="search-filter-content" id="sf-content">
                  <ul>
                    <li>
                      <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001">
                        <span id="filterSelectorLabel-00001">All Files</span>
                      </button>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="search-submit-wrapper" dir="ltr">
                <div class="search-submit" title="Search" role="button" tabindex="0">
                  <span class="invisible-label">Submit Search</span>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <span class="tool-tip" tooltip-position="left" tooltip="To search for CLI commands, events, or APIs, navigate to the related sections.">i</span>
      <!-- Sept. 28, 2022 - This is being moved to under div class= top-nav
			<div class="main_list">
				<ul class="top-navlinks">
					<li><a href="https://solace.com/support/" target="_blank">Support</a></li>
					<li><a href="https://solace.com/contact/" target="_blank">Contact Us</a></li>
				</ul>
			</div> -->
    </div>
    <!-- Sept. 27, 2022 - The commented out content below used to provide the products, company, etc., links in the top header, next to the search field. -->
    <!-- <div class="main_list"><ul class="top-navlinks"><li><a href="https://solace.com/products/" target="_blank">Products</a></li><li><a href="https://solace.com/company/" target="_blank">Company</a></li><li><a href="https://www.solace.dev/" target="_blank">Developers</a></li><li><a href="https://solace.com/support/" target="_blank">Support</a></li><li><a href="https://solace.com/contact/" target="_blank">Contact Us</a></li></ul></div> -->
  </div>
  <body>
    <div class="foundation-wrap off-canvas-wrapper">
      <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
        <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
          <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
        </aside>
        <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
          <div data-sticky-container="" class="title-bar-container">
            <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1000px)" data-mc-ignore="true">
              <a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
              <div class="middle title-bar-section outer-row clearfix">
                <div class="menu-icon-container relative clearfix">
                  <div class="central-account-wrapper">
                    <div class="central-dropdown">
                      <a class="central-account-drop">
                        <span class="central-account-image"/>
                        <span class="central-account-text">Account</span>
                      </a>
                      <div class="central-dropdown-content">
                        <a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                        <hr class="central-separator"/>
                        <a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                      </div>
                    </div>
                  </div>
                  <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas">
                    <span/>
                  </button>
                </div>
              </div>
              <div class="title-bar-layout outer-row">
                <div class="logo-wrapper">
                  <a class="logo" href="../../index.html" alt="Logo"/>
                </div>
                <div class="navigation-wrapper nocontent">
                  <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                    <li class="placeholder" style="visibility:hidden">
                      <a>placeholder</a>
                    </li>
                  </ul>
                </div>
                <div class="central-account-wrapper">
                  <div class="central-dropdown">
                    <a class="central-account-drop">
                      <span class="central-account-image"/>
                      <span class="central-account-text">Account</span>
                    </a>
                    <div class="central-dropdown-content">
                      <a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                      <hr class="central-separator"/>
                      <a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                    </div>
                  </div>
                </div>
                <div class="nav-search-wrapper">
                  <div class="nav-search row">
                    <form class="search" action="#">
                      <div class="search-bar search-bar-container needs-pie">
                        <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search the docs"/>
                        <div class="search-filter-wrapper">
                          <span class="invisible-label" id="search-filters-label">Filter: </span>
                          <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                          <div class="search-filter-content" id="sf-content">
                            <ul>
                              <li>
                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001">
                                  <span id="filterSelectorLabel-00001">All Files</span>
                                </button>
                              </li>
                            </ul>
                          </div>
                        </div>
                        <div class="search-submit-wrapper" dir="ltr">
                          <div class="search-submit" title="Search" role="button" tabindex="0">
                            <span class="invisible-label">Submit Search</span>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </nav>
          </div>
          <div class="main-section">
            <div class="row outer-row sidenav-layout">
              <nav class="sidenav-wrapper">
                <div class="sidenav-container">
                  <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                </div>
              </nav>
              <div class="body-container">
                <div data-mc-content-body="True">
                  <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolBar mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic Print NextTopic;">
                    <div class="button-group-container-left">
                      <button class="button needs-pie print-button" title="Print">
                        <div>
                          <div role="img" class="button-icon-wrapper" aria-label="Print">
                            <div class="button-icon"> </div>
                          </div>
                        </div>
                      </button>
                      <button class="button needs-pie previous-topic-button" title="Navigate previous topic" disabled="true">
                        <div>
                          <div role="img" class="button-icon-wrapper" aria-label="Navigate previous">
                            <div class="button-icon"> </div>
                          </div>
                        </div>
                      </button>
                      <button class="button needs-pie next-topic-button" title="Navigate next topic" disabled="true">
                        <div>
                          <div role="img" class="button-icon-wrapper" aria-label="Navigate next">
                            <div class="button-icon"> </div>
                          </div>
                        </div>
                      </button>
                    </div>
                  </div>
                  <!-- Google Tag Manager (noscript) -->
                  <noscript>
                    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLSDFH" height="0" width="0" style="display:none;visibility:hidden"/>
                  </noscript>
                  <!-- End Google Tag Manager (noscript) -->
                  <div id="content">
                    <div id="contentBody">
                      <div class="row collapse">
                        <div xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="ContentRow">
                          <div>
                            <div xmlns="" class="nocontent">
                              <div class="MCBreadcrumbsBox_MCBreadcrumbsSelf_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" / " data-mc-breadcrumbs-count="4" data-mc-toc="True">
                                <span class="MCBreadcrumbsPrefix"> </span>
                              </div>
                            </div>
                            <div xmlns="" role="main" id="mc-main-content">
                              <h1 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a xmlns="" name="Performing_an_Uncontrolled_Failover" data-mc-generated-bookmark="TOC"/>Performing an Uncontrolled Failover</h1>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">In the event of an unplanned failure of an active data center or network isolation, there will not be an opportunity to gracefully release activity from the Message VPNs at that replication site.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">There are three types of uncontrolled failovers:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>
                                  <b>Short -Term Outage</b>
                                  <p>The Active site is out-of-service or isolated for a short duration (for example, minutes or hours). The replication queue has enough capacity to store all replicated messages and transactions during the outage.</p>
                                </li>
                                <li>
                                  <b>Long-Term Outage</b>
                                  <p>The Active site is out-of-service or isolated for a long duration (for example, days or weeks). The replication queue does not have enough capacity to store all replicated messages and transactions during the outage.</p>
                                </li>
                                <li>
                                  <b>Complete Failure</b>
                                  <p>The Active site goes out of service and cannot be recovered. A&#xA0;critical component (the event broker, region connectivity, etc.) has been lost, or data on the external disk has been lost.</p>
                                </li>
                              </ul>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"> In all these types of failovers, the following general steps must be taken:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>
                                  <a href="#Recover_from_Uncontrolled_Make_Active" class="MCXref xref">Step 1: Make Message VPNs at Standby Site Replication Active to Restore Service</a>
                                </li>
                                <li>
                                  <a href="#Recover_from_Uncontrolled_no_connect" class="MCXref xref">Step 2: Ensure Clients Cannot Connect to the Failed Site </a>
                                </li>
                                <li>
                                  <a href="#Recover_from_Uncontrolled_suspend_replication" class="MCXref xref">Step 3: If Necessary, Suspend Replication</a>
                                </li>
                                <li>
                                  <a href="#Recover_from_Uncontrolled_bring_back" class="MCXref xref">Step 4: Bring Message VPNs at the Failed Site Back Online as Replication Standby</a>
                                </li>
                              </ul>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">In the provided example, the New York replication site has experienced the failure, and its mate Boston site takes over activity until the New York site has been restored. For simplicity, only a single Message VPN (<code>Trading_VPN</code>) is presented in the example. When the failure occurred, <code>Trading_VPN</code> had a replication active state at the New York site and a replication standby state at the Boston  site.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Note">While these simple examples only show replication sites with a single Message VPN, in real-world scenarios, these steps must be performed for each Message VPN involved in a replication site failover.</p>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a xmlns="" name="Consequences_of_an_Uncontrolled_Failover" data-mc-generated-bookmark="TOC"/><a name="Conseque"/>Consequences of an Uncontrolled Failover</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">There are potential consequences  of an uncontrolled failover that include:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>The build-up of messages on the replication queue for the duration of the  outage at the Active site.</li>
                                <li>The replication queue becoming full.</li>
                                <li>The loss of one or more event brokers at the failed site prior to restoring operation at the failed site.</li>
                                <li>The possibility of lost messages and transactions  being replicated asynchronously.</li>
                                <li>An increased probability and volume of duplicate message delivery.</li>
                              </ul>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="Note">We recommend that you <a href="../../get-support.htm" class="link-internal">Contact Solace</a> for help resolving any issues that may be present in the circumstances of a specific uncontrolled failover.</p>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a xmlns="" name="Step_1__Make_Message_VPNs_at_Standby_Site_Replication_Active_to_Restore_Service" data-mc-generated-bookmark="TOC"/><a name="Recover_from_Uncontrolled_Make_Active"/>Step 1: Make Message VPNs at Standby Site Replication Active to Restore Service</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">This procedure should be followed after it has been determined that an uncontrolled failure has occurred for a data center site.</p>
                              <h4 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a xmlns="" name="Make_a_Replication_Standby_Message_VPN_Replication_Active" data-mc-generated-bookmark="TOC"/>Make a Replication Standby Message VPN Replication Active</h4>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To restore service, change the replication state of the Message VPN to active.</p>
                              <h4 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><a xmlns="" name="Boston_Data_Center" data-mc-generated-bookmark="TOC"/>Boston Data Center</h4>
                              <pre xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">BOS_EventBroker(configure)# message-vpn Trading_VPN
BOS_EventBroker(configure/message-vpn)# replication state active</pre>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Clients will now be able to connect to the Message VPN.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Since a standby site is not available, asynchronous messages and transactions will be stored in the replication queue. By default, synchronous replication will switch to asynchronous, causing those messages and transactions to also be stored in replication queue. If reject-msg-when-sync ineligible is set on the Message VPN, synchronous replication will be blocked until the standby Message VPN is restored.</p>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a xmlns="" name="Step_2__Ensure_Clients_Cannot_Connect_to_the_Failed_Site" data-mc-generated-bookmark="TOC"/><a name="Recover_from_Uncontrolled_no_connect"/>Step 2: Ensure Clients Cannot Connect to the Failed Site </h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">It is important that the failed site does not come up with its replication Message VPNs in active state. If both sites have an active replication state at the same time, proper operation cannot be guaranteed. Since the failed event broker was configured with replication state active when it failed or became unreachable, when it recovers that will be its default state. Note that if the failed site cannot be recovered, and its configuration has to be restored from a backup, that backup configuration may have been saved with an active replication state, so this step applies in that case as well.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">In this step, the goal is to allow the failed event broker to be brought back up, but also prevent clients from connecting. To do that, you should block ports that allow client connectivity, while still allowing the event broker to be managed through the management ports.</p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">There may be a number of ways to accomplish this step; the specific actions to perform should be tested before an uncontrolled failure occurs so it is clear what to do in an actual failure scenario.</p>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a xmlns="" name="Step_3__If_Necessary,_Suspend_Replication" data-mc-generated-bookmark="TOC"/><a name="Recover_from_Uncontrolled_suspend_replication"/>Step 3: If Necessary, Suspend Replication</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">If the failed site takes a long time to recover, there is risk that the replication queue will fill up. If this happens, messages published to replicated topics (in or out of transactions will be rejected), since no replication service can be provided. If you know that there will be a prolonged outage or the replication queue is getting close to filling up (high event log has been triggered on the replication queue), it may be necessary to suspend the replication service to continue to provide non-replicated service to the replicated topics. </p>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">To suspend replication, disable the reject-msg-to-send behavior on the replication queue using the following CONFIG command:</p>
                              <pre xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">solace(configure/message-vpn/replication/queue)# no reject-msg-to-sender-on-discard</pre>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Note that with this setting, replicated service will continue until the replication queue gets full. Once it is full, only local, non-replicated service is provided.</p>
                              <h2 xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="with-rule"><a xmlns="" name="Step_4__Bring_Message_VPNs_at_the_Failed_Site_Back_Online_as_Replication_Standby" data-mc-generated-bookmark="TOC"/><a name="Recover_from_Uncontrolled_bring_back"/>Step 4: Bring Message VPNs at the Failed Site Back Online as Replication Standby</h2>
                              <p xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Once the failed site has been recovered with management access by no client access (see <a href="#Recover_from_Uncontrolled_no_connect" class="MCXref xref">Step 2: Ensure Clients Cannot Connect to the Failed Site </a>), then it can be prepared to be the standby site. Here the steps for preparing the recovered event broker to be the standby site:</p>
                              <ul xmlns="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
                                <li>
                                  <a href="#StepConfigAllStandby" class="MCXref xref">Step 4-1: Configure All Message VPNs as Standby</a>
                                </li>
                                <li>
                                  <a href="#StepVerifyMsgSpool" class="MCXref xref">Step 4-2: Verify the Message Spool</a>
                                </li>
                                <li>
                                  <a href="#StepHeur_Complete" class="MCXref xref">Step 4-3: Heuristically Complete Transactions</a>
                                </li>
                                <li>
                                  <a href="#StepAllowClientConnects" class="MCXref xref">Step 4-4: Allow Clients to Connect</a>
                                </li>
                                <li>
                                  <a href="#StepWait_forSyncElig" class="MCXref xref">Step 4-5: Wait For Synchronous Replication to be Eligible</a>
                                </li>
                                <li>
                                  <a href="#StepReenable_Replic" class="MCXref xref">Step 4-6: If Necessary, Re-enable Replication</a>
                                </li>
                                <li>
                                  <a href="#Step" class="MCXref xref">Step 4-7: Retrieving Replication Queue Spooled Messages from the Failed Site</a>
                                </li>
                                <h3><a xmlns="" name="Step_4-1__Configure_All_Message_VPNs_as_Standby" data-mc-generated-bookmark="TOC"/><a name="StepConfigAllStandby"/>Step 4-1: Configure All Message VPNs as Standby</h3>
                                <p>Configure all Message VPNs on the restored Replication site with a standby Replication state. In this example, the Message VPN <code>Trading VPN</code> at the New York site is configured with a standby Replication state:</p>
                                <p style="font-family: Helvetica;font-weight: bold;font-style: normal;letter-spacing: 0em;text-decoration: none;">
                                  <b>NY Data Center</b>
                                </p>
                                <pre>NY_EventBroker1(configure)# message-vpn Trading_VPN
NY_EventBroker1(configure/message-vpn)# replication state standby</pre>
                                <p>The Config-Sync facility propagates this setting to the <code>Trading_VPN</code> Message VPN on <code>Ny-Appliance2</code>.</p>
                                <h3><a xmlns="" name="Step_4-2__Verify_the_Message_Spool" data-mc-generated-bookmark="TOC"/><a name="StepVerifyMsgSpool"/>Step 4-2: Verify the Message Spool</h3>
                                <p>You should verify that the message spool for the event brokers at the failed Replication site are now capable of providing service. </p>
                                <p>Before continuing, ensure that the message spool on the recovered site is active for the primary virtual router. In the sample output below (which may vary by event broker type and version), the <code>Activity Status</code> of <code>Local Inactive</code> and the <code>Message Spool Status</code> of <code>AD-Not Ready</code> indicates that the event broker and the message spool it uses are not active.</p>
                                <pre>NY_EventBroker1# show redundancy
Configuration Status     : Enabled
Auto Revert              : No
Redundancy Mode          : Active/Active
Mate Router Name         : solaceBackup
ADB Link To Mate         : Up
ADB Hello To Mate        : Down

Primary Virtual Router  Backup Virtual Router
                               ----------------------  ----------------------

Activity Status                Local Inactive          Local Active
Routing Interface              1/1/lag1:1              1/1/lag1:3
VRRP VRID                      33                      34
Routing Interface Status       Up                      Up
VRRP Status                    Master                  Master
VRRP Priority                  75                      250
Message Spool Status           AD-NotReady             AD-Disabled
Priority Reported By Mate      Backup-Reconcile        Primary-Reconcile</pre>
                                <p>In this situation, you must resolve the issue preventing failed event broker to become active. If you cannot resolve the issue, <a href="../../get-support.htm" class="link-internal">contact Solace</a>.</p>
                                <h3><a xmlns="" name="Step_4-3__Heuristically_Complete_Transactions" data-mc-generated-bookmark="TOC"/><a name="StepHeur_Complete"/>Step 4-3: Heuristically Complete Transactions</h3>
                                <p>If applicable, heuristically commit or heuristically rollback any prepared transactions on the failed site. Once heuristically completed, delete them to free up the resources.</p>
                                <p>To commit, rollback or delete a transaction, enter the appropriate  ADMIN commands on the failed site:</p>
                                <p style="font-weight: bold;">NY Data Center</p>
                                <pre>solace(admin/message-spool) commit-transaction xid &lt;xid&gt;</pre>
                                <p>and/or</p>
                                <pre>solace(admin/message-spool) rollback-transaction xid &lt;xid&gt;</pre>
                                <p>and then</p>
                                <pre>solace(admin/message-spool) delete-transaction xid &lt;xid&gt;</pre>
                                <p><u>Where</u>:</p>
                                <p><code>xid</code> specifies the XID of the transaction to be committed, rolled back, or deleted.</p>
                                <h3><a xmlns="" name="Step_4-4__Allow_Clients_to_Connect" data-mc-generated-bookmark="TOC"/><a name="StepAllowClientConnects"/>Step 4-4: Allow Clients to Connect</h3>
                                <p>You previously had blocked traffic to prevent client connectivity (<a href="#Recover_from_Uncontrolled_no_connect" class="MCXref xref">Step 2: Ensure Clients Cannot Connect to the Failed Site </a>). You now must unblock the ports to allow client connectivity. This step allows clients to connect as well as to the replication bridge, which allows data to be synchronized from the active site (Boston  site to the New York site in the example). </p>
                                <h3><a xmlns="" name="Step_4-5__Wait_For_Synchronous_Replication_to_be_Eligible" data-mc-generated-bookmark="TOC"/><a name="StepWait_forSyncElig"/>Step 4-5: Wait For Synchronous Replication to be Eligible</h3>
                                <p>Once connectivity is restored between the recovered site and the active site, the replication bridge will connect from the standby site to the active site and drain the replication queue in order to synchronize the two sites. Depending on how much message and transaction data is in the replication queue and the available bandwidth between the sites, this process may take a long time. When this process is complete, the Replication service will no longer be degraded and the Message VPN will become eligible for synchronous replication.</p>
                                <p> In the following example, the information is shown for the Boston  site, which is acting as active for the recently failed New York site.</p>
                                <pre>BOS_EventBroker# show message-vpn Trading_VPN replication

Flags Legend:
A - Admin State (U=Up, D=Down)
C - Config State (A=Active, S=Standby)
B - Local Bridge State (U=Up, Q=Queue Unbound, D=Down, -=N/A)
R - Remote Bridge State (U=Up, D=Down, -=N/A)
Q - Queue State (U=Up, D=Down, -=N/A)
S - Sync Replication Eligible (Y=Yes, N=No, -=N/A)
M - Reject Msg When Sync Ineligible (Y=Yes, N=No)
T - Transaction Replication Mode (A=Async, S=Sync, -=N/A)
Message VPN                      A C W B R Q S M T
-------------------------------- - - - - - - - - -
Trading_VPN                      U A N - U U - N A
BOS_EventBroker# 
</pre>
                                <p>The &#x2018;Y&#x2019; under the &#x2018;S&#x2019; column indicates that synchronous Replication is eligible for the Message VPN <code>Trading_VPN</code>.</p>
                                <h3><a xmlns="" name="Step_4-6__If_Necessary,_Re-enable_Replication" data-mc-generated-bookmark="TOC"/><a name="StepReenable_Replic"/>Step 4-6: If Necessary, Re-enable Replication</h3>
                                <p>If you previously had to suspend replication because the replication queue overflowed, re-enable it. Enter the following CONFIG command:</p>
                                <pre>solace(configure/message-vpn/replication/queue)# reject-msg-to-sender-on-discard</pre>
                                <h3><a xmlns="" name="Step_4-7__Retrieving_Replication_Queue_Spooled_Messages_from_the_Failed_Site" data-mc-generated-bookmark="TOC"/><a name="Step"/>Step 4-7: Retrieving Replication Queue Spooled Messages from the Failed Site</h3>
                                <p>Asynchronously spooled messages on the formerly active site (NY)  can only be consumed when the activity is failed back to the formerly active state site (NY).</p>
                                <p>In order to retrieve these messages, fail back to the formerly active state site (NY) in the next maintenance window.</p>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="no-print">
                      <div>
                        <a href="#" id="docsFeedbackTrigger" class="docs-issue-collector">Provide feedback</a>
                      </div>
                    </div>
                    <footer class="my-4 pt-4 text-center no-print">
                      <div class="footer-txt text-center no-print">
                        <ul class="list-inline ">
                          <li class="list-inline-item text-muted"><a href="../../Resources/Documentation-Set.htm" class="doc-set-footer-link MCXref xref xrefdoc-set-footer-link">Documentation Coverage</a>: <span class="mc-variable Variables.DocumentSetNumber variable">2024.09.18.0001</span></li>
                          <li class="list-inline-item text-muted">Last Updated: <span class="mc-variable Variables.MonthDayYear variable">September 18, 2024</span></li>
                          <li class="list-inline-item text-muted" style="font-size:13px;"> &#xA9;  <span class="mc-variable Variables.CompanyNameLegal variable">Solace Corporation</span></li>
                        </ul>
                      </div>
                      <div class="footer-icons">
                        <ul class="list-inline">
                          <li class="list-inline-item">
                            <a href="https://facebook.com/solacedotcom" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/facebook_22x21.png" class="Hyperlinked" alt="Facebook" title="Solace Facebook Page" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://www.linkedin.com/company/20219" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/LinkedIn_22x21.png" class="Hyperlinked" alt="LinkedIn" title="Solace LinkedIn Page" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://twitter.com/solacedotcom" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/Twitter_22x21.png" class="Hyperlinked" alt="Twitter" title="Solace Twitter Feed" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://www.youtube.com/user/SolaceSystems" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/youtube_22x21.png" class="Hyperlinked" alt="YouTube" title="Solace YouTube Channel" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://www.instagram.com/solacedotcom/" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/instagram_22x21.png" class="Hyperlinked" alt="Instagram" title="Solace Instagram Feed" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                          <li class="list-inline-item">
                            <a href="https://medium.com/solacedotcom" target="_blank" class="social-media-icon">
                              <img src="../../Resources/Images/Social-Media/medium_22x21.png" class="Hyperlinked" alt="Medium" title="Solace Medium Blog" style="width: 22;height: 21;"/>
                            </a>
                          </li>
                        </ul>
                      </div>
                      <div class="footer_link_menu">
                        <ul class="link_list">
                          <li class="link_list_item">
                            <a href="https://solace.com/products/" target="_blank" class="footer-link">Products</a>
                          </li>
                          <li class="link_list_item">
                            <a href="https://solace.com/company/" target="_blank" class="footer-link">Company</a>
                          </li>
                          <li class="link_list_item">
                            <a href="https://www.solace.dev/" target="_blank" class="footer-link">Developers</a>
                          </li>
                          <li class="link_list_item">
                            <a href="https://solace.com/support/" target="_blank" class="footer-link">Support</a>
                          </li>
                          <li class="link_list_item">
                            <a href="https://solace.com/contact/" target="_blank" class="footer-link">Contact Us</a>
                          </li>
                        </ul>
                      </div>
                    </footer>
                  </div>
                  <!-- JIRA issue collector -->
                  <script>/*<![CDATA[*/// Requires jQuery!
jQuery.ajax({
    url: "https://sol-jira.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e-T/o2joag/b/24/e73395c53c3b10fde2303f4bf74ffbf6/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-US&collectorId=076e0808",
    type: "get",
    cache: true,
    dataType: "script"
});
window.ATL_JQ_PAGE_PROPS = {
"triggerFunction": function(showCollectorDialog) {
//Requires that jQuery is available!
$("#docsFeedbackTrigger").click(function(e) {
e.preventDefault();
showCollectorDialog();
});
},
fieldValues: {
recordWebInfo: '1', // field Name
recordWebInfoConsent: ['1'] // field Id
}
};
/*]]>*/</script>
                  <script src="../../Resources/Scripts/thumbnail.js">
                                    </script>
                  <!-- Script for Launching offsite links in new tab -->
                  <script type="text/javascript">/*<![CDATA[*/$("a[href^='http']").attr("target","_blank");/*]]>*/</script>
                </div>
              </div>
            </div>
          </div>
          <a data-close="true"/>
        </div>
      </div>
    </div>
  </body>
</html>
